<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Hierarchical Models | Doing Bayesian Data Analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in Kruschke’s (2014) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Hierarchical Models | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is an attempt to re-express the code in Kruschke’s (2014) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Hierarchical Models | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in Kruschke’s (2014) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2019-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="jags-brms.html">
<link rel="next" href="model-comparison-and-hierarchical-modeling.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html"><i class="fa fa-check"></i><b>1</b> What’s in This Book (Read This First!)</a><ul>
<li class="chapter" data-level="1.1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#real-people-can-read-this-book"><i class="fa fa-check"></i><b>1.1</b> Real people can read this book</a></li>
<li class="chapter" data-level="1.2" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-in-this-book"><i class="fa fa-check"></i><b>1.2</b> What’s in this book</a></li>
<li class="chapter" data-level="1.3" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-new-in-the-second-edition"><i class="fa fa-check"></i><b>1.3</b> What’s new in the second edition</a></li>
<li class="chapter" data-level="1.4" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#gimme-feedback-be-polite"><i class="fa fa-check"></i><b>1.4</b> Gimme feedback (be polite)</a></li>
<li class="chapter" data-level="1.5" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#thank-you"><i class="fa fa-check"></i><b>1.5</b> Thank you!</a></li>
<li class="chapter" data-level="" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="part"><span><b>I THE BASICS: MODELS, PROBABILITY, BAYES’ RULE, AND R</b></span></li>
<li class="chapter" data-level="2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html"><i class="fa fa-check"></i><b>2</b> Introduction: Credibility, Models, and Parameters</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#bayesian-inference-is-reallocation-of-credibility-across-possibilities"><i class="fa fa-check"></i><b>2.1</b> Bayesian inference is reallocation of credibility across possibilities</a><ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#data-are-noisy-and-inferences-are-probabilistic."><i class="fa fa-check"></i><b>2.1.1</b> Data are noisy and inferences are probabilistic.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#possibilities-are-parameter-values-in-descriptive-models"><i class="fa fa-check"></i><b>2.2</b> Possibilities are parameter values in descriptive models</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#the-steps-of-bayesian-data-analysis"><i class="fa fa-check"></i><b>2.3</b> The steps of Bayesian data analysis</a></li>
<li class="chapter" data-level="" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#reference-1"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html"><i class="fa fa-check"></i><b>3</b> The R Programming Language</a><ul>
<li class="chapter" data-level="3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-software"><i class="fa fa-check"></i><b>3.1</b> Get the software</a><ul>
<li class="chapter" data-level="3.1.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-look-at-rstudio."><i class="fa fa-check"></i><b>3.1.1</b> A look at RStudio.</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-simple-example-of-r-in-action"><i class="fa fa-check"></i><b>3.2</b> A simple example of R in action</a><ul>
<li class="chapter" data-level="3.2.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-programs-used-with-this-book."><i class="fa fa-check"></i><b>3.2.1</b> Get the programs used with this book.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#basic-commands-and-operators-in-r"><i class="fa fa-check"></i><b>3.3</b> Basic commands and operators in R</a><ul>
<li class="chapter" data-level="3.3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#getting-help-in-r."><i class="fa fa-check"></i><b>3.3.1</b> Getting help in R.</a></li>
<li class="chapter" data-level="3.3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#arithmetic-and-logical-operators."><i class="fa fa-check"></i><b>3.3.2</b> Arithmetic and logical operators.</a></li>
<li class="chapter" data-level="3.3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#assignment-relational-operators-and-tests-of-equality."><i class="fa fa-check"></i><b>3.3.3</b> Assignment, relational operators, and tests of equality.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-types"><i class="fa fa-check"></i><b>3.4</b> Variable types</a><ul>
<li class="chapter" data-level="3.4.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#vector."><i class="fa fa-check"></i><b>3.4.1</b> Vector.</a></li>
<li class="chapter" data-level="3.4.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#factor."><i class="fa fa-check"></i><b>3.4.2</b> Factor.</a></li>
<li class="chapter" data-level="3.4.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#matrix-and-array."><i class="fa fa-check"></i><b>3.4.3</b> Matrix and array.</a></li>
<li class="chapter" data-level="3.4.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#list-and-data-frame."><i class="fa fa-check"></i><b>3.4.4</b> List and data frame.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#loading-and-saving-data"><i class="fa fa-check"></i><b>3.5</b> Loading and saving data</a><ul>
<li class="chapter" data-level="3.5.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#the-read.csv-read_csv-and-read.table-read_table-functions."><i class="fa fa-check"></i><b>3.5.1</b> The <del>read.csv</del> <code>read_csv()</code> and <del>read.table</del> <code>read_table()</code> functions.</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#saving-data-from-r."><i class="fa fa-check"></i><b>3.5.2</b> Saving data from R.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#some-utility-functions"><i class="fa fa-check"></i><b>3.6</b> Some utility functions</a></li>
<li class="chapter" data-level="3.7" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-in-r"><i class="fa fa-check"></i><b>3.7</b> Programming in R</a><ul>
<li class="chapter" data-level="3.7.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-names-in-r."><i class="fa fa-check"></i><b>3.7.1</b> Variable names in R.</a></li>
<li class="chapter" data-level="3.7.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#running-a-program."><i class="fa fa-check"></i><b>3.7.2</b> Running a program.</a></li>
<li class="chapter" data-level="3.7.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-a-function."><i class="fa fa-check"></i><b>3.7.3</b> Programming a function.</a></li>
<li class="chapter" data-level="3.7.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#conditions-and-loops."><i class="fa fa-check"></i><b>3.7.4</b> Conditions and loops.</a></li>
<li class="chapter" data-level="3.7.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#measuring-processing-time."><i class="fa fa-check"></i><b>3.7.5</b> Measuring processing time.</a></li>
<li class="chapter" data-level="3.7.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#debugging."><i class="fa fa-check"></i><b>3.7.6</b> Debugging.</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#graphical-plots-opening-and-saving"><i class="fa fa-check"></i><b>3.8</b> Graphical plots: Opening and saving</a></li>
<li class="chapter" data-level="" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#reference-2"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html"><i class="fa fa-check"></i><b>4</b> What is This Stuff Called Probability?</a><ul>
<li class="chapter" data-level="4.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#the-set-of-all-possible-events"><i class="fa fa-check"></i><b>4.1</b> The set of all possible events</a></li>
<li class="chapter" data-level="4.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-outside-or-inside-the-head"><i class="fa fa-check"></i><b>4.2</b> Probability: Outside or inside the head</a><ul>
<li class="chapter" data-level="4.2.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#outside-the-head-long-run-relative-frequency."><i class="fa fa-check"></i><b>4.2.1</b> Outside the head: Long-run relative frequency.</a></li>
<li class="chapter" data-level="4.2.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#inside-the-head-subjective-belief."><i class="fa fa-check"></i><b>4.2.2</b> Inside the head: Subjective belief.</a></li>
<li class="chapter" data-level="4.2.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probabilities-assign-numbers-to-possibilities."><i class="fa fa-check"></i><b>4.2.3</b> Probabilities assign numbers to possibilities.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-distributions"><i class="fa fa-check"></i><b>4.3</b> Probability distributions</a><ul>
<li class="chapter" data-level="4.3.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#discrete-distributions-probability-mass."><i class="fa fa-check"></i><b>4.3.1</b> Discrete distributions: Probability mass.</a></li>
<li class="chapter" data-level="4.3.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#continuous-distributions-rendezvous-with-density."><i class="fa fa-check"></i><b>4.3.2</b> Continuous distributions: Rendezvous with density.</a></li>
<li class="chapter" data-level="4.3.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#mean-and-variance-of-a-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Mean and variance of a distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#highest-density-interval-hdi."><i class="fa fa-check"></i><b>4.3.4</b> Highest density interval (HDI).</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#two-way-distributions"><i class="fa fa-check"></i><b>4.4</b> Two-way distributions</a></li>
<li class="chapter" data-level="" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#reference-3"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayes-rule.html"><a href="bayes-rule.html"><i class="fa fa-check"></i><b>5</b> Bayes’ Rule</a><ul>
<li class="chapter" data-level="5.1" data-path="bayes-rule.html"><a href="bayes-rule.html#bayes-rule-1"><i class="fa fa-check"></i><b>5.1</b> Bayes’ rule</a><ul>
<li class="chapter" data-level="5.1.1" data-path="bayes-rule.html"><a href="bayes-rule.html#derived-from-definitions-of-conditional-probability."><i class="fa fa-check"></i><b>5.1.1</b> Derived from definitions of conditional probability.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bayes-rule.html"><a href="bayes-rule.html#applied-to-parameters-and-data"><i class="fa fa-check"></i><b>5.2</b> Applied to parameters and data</a></li>
<li class="chapter" data-level="5.3" data-path="bayes-rule.html"><a href="bayes-rule.html#complete-examples-estimating-bias-in-a-coin"><i class="fa fa-check"></i><b>5.3</b> Complete examples: Estimating bias in a coin</a><ul>
<li class="chapter" data-level="5.3.1" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-sample-size-on-the-posterior."><i class="fa fa-check"></i><b>5.3.1</b> Influence of sample size on the posterior.</a></li>
<li class="chapter" data-level="5.3.2" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-prior-on-the-posterior."><i class="fa fa-check"></i><b>5.3.2</b> Influence of prior on the posterior.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="bayes-rule.html"><a href="bayes-rule.html#why-bayesian-inference-can-be-difficult"><i class="fa fa-check"></i><b>5.4</b> Why Bayesian inference can be difficult</a></li>
<li class="chapter" data-level="" data-path="bayes-rule.html"><a href="bayes-rule.html#reference-4"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="bayes-rule.html"><a href="bayes-rule.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="part"><span><b>II ALL THE FUNDAMENTALS APPLIED TO INFERRING A BINOMIAL PROBABILITY</b></span></li>
<li class="chapter" data-level="6" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><i class="fa fa-check"></i><b>6</b> Inferring a Binomial Probability via Exact Mathematical Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-likelihood-function-the-bernoulli-distribution"><i class="fa fa-check"></i><b>6.1</b> The likelihood function: The Bernoulli distribution</a></li>
<li class="chapter" data-level="6.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#a-description-of-credibilities-the-beta-distribution"><i class="fa fa-check"></i><b>6.2</b> A description of credibilities: The beta distribution</a><ul>
<li class="chapter" data-level="6.2.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#specifying-a-beta-prior."><i class="fa fa-check"></i><b>6.2.1</b> Specifying a beta prior.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-posterior-beta"><i class="fa fa-check"></i><b>6.3</b> The posterior beta</a><ul>
<li class="chapter" data-level="6.3.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#posterior-is-compromise-of-prior-and-likelihood."><i class="fa fa-check"></i><b>6.3.1</b> Posterior is compromise of prior and likelihood.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#examples"><i class="fa fa-check"></i><b>6.4</b> Examples</a><ul>
<li class="chapter" data-level="6.4.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.1</b> Prior knowledge expressed as a beta distribution.</a></li>
<li class="chapter" data-level="6.4.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-that-cannot-be-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.2</b> Prior knowledge that cannot be expressed as a beta distribution.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#summary"><i class="fa fa-check"></i><b>6.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#reference-5"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>7</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="7.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#approximating-a-distribution-with-a-large-sample"><i class="fa fa-check"></i><b>7.1</b> Approximating a distribution with a large sample</a></li>
<li class="chapter" data-level="7.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-simple-case-of-the-metropolis-algorithm"><i class="fa fa-check"></i><b>7.2</b> A simple case of the Metropolis algorithm</a><ul>
<li class="chapter" data-level="7.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-politician-stumbles-upon-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.2.1</b> A politician stumbles upon the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-random-walk."><i class="fa fa-check"></i><b>7.2.2</b> A random walk.</a></li>
<li class="chapter" data-level="7.2.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#general-properties-of-a-random-walk."><i class="fa fa-check"></i><b>7.2.3</b> General properties of a random walk.</a></li>
<li class="chapter" data-level="7.2.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#why-we-care."><i class="fa fa-check"></i><b>7.2.4</b> Why we care.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-metropolis-algorithm-more-generally"><i class="fa fa-check"></i><b>7.3</b> The Metropolis algorithm more generally</a><ul>
<li class="chapter" data-level="7.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithm-applied-to-bernoulli-likelihood-and-beta-prior."><i class="fa fa-check"></i><b>7.3.1</b> Metropolis algorithm applied to Bernoulli likelihood and beta prior.</a></li>
<li class="chapter" data-level="7.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#summary-of-metropolis-algorithm."><i class="fa fa-check"></i><b>7.3.2</b> Summary of Metropolis algorithm.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#toward-gibbs-sampling-estimating-two-coin-biases"><i class="fa fa-check"></i><b>7.4</b> Toward Gibbs sampling: Estimating two coin biases</a><ul>
<li class="chapter" data-level="7.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#prior-likelihood-and-posterior-for-two-biases."><i class="fa fa-check"></i><b>7.4.1</b> Prior, likelihood and posterior for two biases.</a></li>
<li class="chapter" data-level="7.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-exact-formal-analysis."><i class="fa fa-check"></i><b>7.4.2</b> The posterior via exact formal analysis.</a></li>
<li class="chapter" data-level="7.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.4.3</b> The posterior via the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-hamiltonian-monte-carlo-sampling."><i class="fa fa-check"></i><b>7.4.4</b> <del>Gibbs</del> Hamiltonian Monte Carlo sampling.</a></li>
<li class="chapter" data-level="7.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#is-there-a-difference-between-biases"><i class="fa fa-check"></i><b>7.4.5</b> Is there a difference between biases?</a></li>
<li class="chapter" data-level="7.4.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#terminology-mcmc."><i class="fa fa-check"></i><b>7.4.6</b> Terminology: MCMC.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness-accuracy-and-efficiency"><i class="fa fa-check"></i><b>7.5</b> MCMC representativeness, accuracy, and efficiency</a><ul>
<li class="chapter" data-level="7.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness."><i class="fa fa-check"></i><b>7.5.1</b> MCMC representativeness.</a></li>
<li class="chapter" data-level="7.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-accuracy."><i class="fa fa-check"></i><b>7.5.2</b> MCMC accuracy.</a></li>
<li class="chapter" data-level="7.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-efficiency."><i class="fa fa-check"></i><b>7.5.3</b> MCMC efficiency.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#reference-6"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="jags-brms.html"><a href="jags-brms.html"><i class="fa fa-check"></i><b>8</b> <del>JAGS</del> brms</a><ul>
<li class="chapter" data-level="8.1" data-path="jags-brms.html"><a href="jags-brms.html#jags-brms-and-its-relation-to-r"><i class="fa fa-check"></i><b>8.1</b> <del>JAGS</del> brms and its relation to R</a></li>
<li class="chapter" data-level="8.2" data-path="jags-brms.html"><a href="jags-brms.html#a-complete-example"><i class="fa fa-check"></i><b>8.2</b> A complete example</a><ul>
<li class="chapter" data-level="8.2.1" data-path="jags-brms.html"><a href="jags-brms.html#load-data."><i class="fa fa-check"></i><b>8.2.1</b> Load data.</a></li>
<li class="chapter" data-level="8.2.2" data-path="jags-brms.html"><a href="jags-brms.html#specify-model."><i class="fa fa-check"></i><b>8.2.2</b> Specify model.</a></li>
<li class="chapter" data-level="8.2.3" data-path="jags-brms.html"><a href="jags-brms.html#initialize-chains."><i class="fa fa-check"></i><b>8.2.3</b> Initialize chains.</a></li>
<li class="chapter" data-level="8.2.4" data-path="jags-brms.html"><a href="jags-brms.html#generate-chains."><i class="fa fa-check"></i><b>8.2.4</b> Generate chains.</a></li>
<li class="chapter" data-level="8.2.5" data-path="jags-brms.html"><a href="jags-brms.html#examine-chains."><i class="fa fa-check"></i><b>8.2.5</b> Examine chains.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="jags-brms.html"><a href="jags-brms.html#simplified-scripts-for-frequently-used-analyses"><i class="fa fa-check"></i><b>8.3</b> Simplified scripts for frequently used analyses</a></li>
<li class="chapter" data-level="8.4" data-path="jags-brms.html"><a href="jags-brms.html#example-difference-of-biases"><i class="fa fa-check"></i><b>8.4</b> Example: Difference of biases</a></li>
<li class="chapter" data-level="8.5" data-path="jags-brms.html"><a href="jags-brms.html#sampling-from-the-prior-distribution-in-jags-brms"><i class="fa fa-check"></i><b>8.5</b> Sampling from the prior distribution in <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="8.6" data-path="jags-brms.html"><a href="jags-brms.html#probability-distributions-available-in-jags-brms"><i class="fa fa-check"></i><b>8.6</b> Probability distributions available in <del>JAGS</del> brms</a><ul>
<li class="chapter" data-level="8.6.1" data-path="jags-brms.html"><a href="jags-brms.html#defining-new-likelihood-functions."><i class="fa fa-check"></i><b>8.6.1</b> Defining new likelihood functions.</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="jags-brms.html"><a href="jags-brms.html#faster-sampling-with-parallel-processing-in-runjags-brmsbrm"><i class="fa fa-check"></i><b>8.7</b> Faster sampling with parallel processing in <del>runjags</del> <code>brms::brm()</code></a></li>
<li class="chapter" data-level="8.8" data-path="jags-brms.html"><a href="jags-brms.html#tips-for-expanding-jags-brms-models"><i class="fa fa-check"></i><b>8.8</b> Tips for expanding <del>JAGS</del> brms models</a></li>
<li class="chapter" data-level="" data-path="jags-brms.html"><a href="jags-brms.html#reference-7"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="jags-brms.html"><a href="jags-brms.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>9</b> Hierarchical Models</a><ul>
<li class="chapter" data-level="9.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-single-coin-from-a-single-mint"><i class="fa fa-check"></i><b>9.1</b> A single coin from a single mint</a><ul>
<li class="chapter" data-level="9.1.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation."><i class="fa fa-check"></i><b>9.1.1</b> Posterior via grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#multiple-coins-from-a-single-mint"><i class="fa fa-check"></i><b>9.2</b> Multiple coins from a single mint</a><ul>
<li class="chapter" data-level="9.2.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation.-1"><i class="fa fa-check"></i><b>9.2.1</b> Posterior via grid approximation.</a></li>
<li class="chapter" data-level="9.2.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-realistic-model-with-mcmc."><i class="fa fa-check"></i><b>9.2.2</b> A realistic model with MCMC.</a></li>
<li class="chapter" data-level="9.2.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#doing-it-with-jags-brms."><i class="fa fa-check"></i><b>9.2.3</b> Doing it with <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="9.2.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-therapeutic-touch."><i class="fa fa-check"></i><b>9.2.4</b> Example: Therapeutic touch.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#shrinkage-in-hierarchical-models"><i class="fa fa-check"></i><b>9.3</b> Shrinkage in hierarchical models</a></li>
<li class="chapter" data-level="9.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#speeding-up-jags-brms"><i class="fa fa-check"></i><b>9.4</b> Speeding up <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="9.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#extending-the-hierarchy-subjects-within-categories"><i class="fa fa-check"></i><b>9.5</b> Extending the hierarchy: Subjects within categories</a><ul>
<li class="chapter" data-level="9.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-baseball-batting-abilities-by-position."><i class="fa fa-check"></i><b>9.5.1</b> Example: Baseball batting abilities by position.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hierarchical-models.html"><a href="hierarchical-models.html#reference-8"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="hierarchical-models.html"><a href="hierarchical-models.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html"><i class="fa fa-check"></i><b>10</b> Model Comparison and Hierarchical Modeling</a><ul>
<li class="chapter" data-level="10.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#general-formula-and-the-bayes-factor"><i class="fa fa-check"></i><b>10.1</b> General formula and the Bayes factor</a></li>
<li class="chapter" data-level="10.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#example-two-factories-of-coins"><i class="fa fa-check"></i><b>10.2</b> Example: Two factories of coins</a><ul>
<li class="chapter" data-level="10.2.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-formal-analysis."><i class="fa fa-check"></i><b>10.2.1</b> Solution by formal analysis.</a></li>
<li class="chapter" data-level="10.2.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-grid-approximation."><i class="fa fa-check"></i><b>10.2.2</b> Solution by grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-mcmc"><i class="fa fa-check"></i><b>10.3</b> Solution by MCMC</a><ul>
<li class="chapter" data-level="10.3.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#nonhierarchical-mcmc-computation-of-each-models-marginal-likelihood."><i class="fa fa-check"></i><b>10.3.1</b> Nonhierarchical MCMC computation of each model’s marginal likelihood.</a></li>
<li class="chapter" data-level="10.3.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#hierarchical-mcmc-computation-of-relative-model-probability-is-not-available-in-brms-well-cover-information-criteria-instead."><i class="fa fa-check"></i><b>10.3.2</b> Hierarchical MCMC computation <del>of relative model probability</del> is not available in brms: We’ll cover information criteria instead.</a></li>
<li class="chapter" data-level="10.3.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#models-with-different-noise-distributions-in-jags-brms."><i class="fa fa-check"></i><b>10.3.3</b> Models with different “noise” distributions in <del>JAGS</del> brms.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#prediction-model-averaging"><i class="fa fa-check"></i><b>10.4</b> Prediction: Model averaging</a></li>
<li class="chapter" data-level="10.5" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#model-complexity-naturally-accounted-for"><i class="fa fa-check"></i><b>10.5</b> Model complexity naturally accounted for</a><ul>
<li class="chapter" data-level="10.5.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#caveats-regarding-nested-model-comparison."><i class="fa fa-check"></i><b>10.5.1</b> Caveats regarding nested model comparison.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#extreme-sensitivity-to-the-prior-distribution"><i class="fa fa-check"></i><b>10.6</b> Extreme sensitivity to the prior distribution</a><ul>
<li class="chapter" data-level="10.6.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#priors-of-different-models-should-be-equally-informed."><i class="fa fa-check"></i><b>10.6.1</b> Priors of different models should be equally informed.</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#bonus-theres-danger-ahead"><i class="fa fa-check"></i><b>10.7</b> Bonus: There’s danger ahead</a></li>
<li class="chapter" data-level="" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#reference-9"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Doing Bayesian Data Analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="hierarchical-models" class="section level1">
<h1><span class="header-section-number">9</span> Hierarchical Models</h1>
<p>As Kruschke put it, “There are many realistic situations that involve meaningful hierarchical structure. Bayesian modeling software makes it straightforward to specify and analyze complex hierarchical models” (p. 221). IMO, <strong>brms</strong> makes it even easier than JAGS.</p>
<div id="a-single-coin-from-a-single-mint" class="section level2">
<h2><span class="header-section-number">9.1</span> A single coin from a single mint</h2>
<p>Recall from the last chapter that our likelihood is the Bernoulli distribution,</p>
<p><span class="math display">\[y_i \sim \operatorname{Bernoulli} (\theta).\]</span></p>
<p>We’ll use the Beta density for our prior distribution for <span class="math inline">\(\theta\)</span>,</p>
<p><span class="math display">\[\theta \sim \operatorname{Beta} (\alpha, \beta).\]</span></p>
<p>And we can re-express <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> in terms of the mode <span class="math inline">\(\omega\)</span> and concentration <span class="math inline">\(\kappa\)</span>, such that</p>
<p><span class="math display">\[\alpha = \omega(\kappa - 2) + 1 \textrm{ and } \beta = (1 - \omega)(\kappa - 2) + 1.\]</span></p>
<p>The consequence of this is that we can re-express <span class="math inline">\(\theta\)</span> as</p>
<p><span class="math display">\[\theta \sim \operatorname{Beta} (\omega(\kappa - 2) + 1, (1 - \omega)(\kappa - 2) + 1).\]</span></p>
<p>On page 224, Kruschke wrote: “The value of <span class="math inline">\(\kappa\)</span> governs how near <span class="math inline">\(\theta\)</span> is to <span class="math inline">\(\omega\)</span>, with larger values of <span class="math inline">\(\kappa\)</span> generating values of <span class="math inline">\(\theta\)</span> more concentrated near <span class="math inline">\(\omega\)</span>.” To give a sense of that, we’ll simulate 20 beta distributions, all with <span class="math inline">\(\omega = .25\)</span> but with <span class="math inline">\(\theta\)</span> increasing from 10 to 200, by 10.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb591-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb591-2" data-line-number="2"><span class="kw">library</span>(ggridges)</a>
<a class="sourceLine" id="cb591-3" data-line-number="3"></a>
<a class="sourceLine" id="cb591-4" data-line-number="4">beta_by_k &lt;-<span class="st"> </span><span class="cf">function</span>(k){</a>
<a class="sourceLine" id="cb591-5" data-line-number="5">  w &lt;-<span class="st"> </span><span class="fl">.25</span></a>
<a class="sourceLine" id="cb591-6" data-line-number="6">  <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">1000</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb591-7" data-line-number="7"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">theta =</span> <span class="kw">dbeta</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb591-8" data-line-number="8">                         <span class="dt">shape1 =</span> w <span class="op">*</span><span class="st"> </span>(k <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb591-9" data-line-number="9">                         <span class="dt">shape2 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>w) <span class="op">*</span><span class="st"> </span>(k <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb591-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb591-11" data-line-number="11"></a>
<a class="sourceLine" id="cb591-12" data-line-number="12"><span class="kw">tibble</span>(<span class="dt">k =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">10</span>, <span class="dt">to =</span> <span class="dv">200</span>, <span class="dt">by =</span> <span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb591-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">theta =</span> <span class="kw">map</span>(k, beta_by_k)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb591-14" data-line-number="14"><span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb591-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb591-16" data-line-number="16"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> k,</a>
<a class="sourceLine" id="cb591-17" data-line-number="17">             <span class="dt">height =</span> theta,</a>
<a class="sourceLine" id="cb591-18" data-line-number="18">             <span class="dt">group =</span> k, <span class="dt">fill =</span> k)) <span class="op">+</span></a>
<a class="sourceLine" id="cb591-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.25</span>, <span class="fl">.5</span>), <span class="dt">color =</span> <span class="st">&quot;grey85&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb591-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_ridgeline</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">scale =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb591-21" data-line-number="21"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="kw">expression</span>(kappa), <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb591-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="kw">expression</span>(kappa), <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">10</span>, <span class="dt">to =</span> <span class="dv">200</span>, <span class="dt">by =</span> <span class="dv">10</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb591-23" data-line-number="23"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(theta)) <span class="op">+</span></a>
<a class="sourceLine" id="cb591-24" data-line-number="24"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-1-1.png" /><!-- --></p>
<p>Holding <span class="math inline">\(\omega\)</span> constant, the density gets more concentrated around <span class="math inline">\(\omega\)</span> as <span class="math inline">\(\kappa\)</span> increases.</p>
<div id="posterior-via-grid-approximation." class="section level3">
<h3><span class="header-section-number">9.1.1</span> Posterior via grid approximation.</h3>
<p>Given <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, we can compute the corresponding mode <span class="math inline">\(\omega\)</span>. To foreshadow, consider <span class="math inline">\(\text{Beta} (2, 2)\)</span>.</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb592-1" data-line-number="1">alpha &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb592-2" data-line-number="2">beta  &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb592-3" data-line-number="3"></a>
<a class="sourceLine" id="cb592-4" data-line-number="4">(alpha <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>(alpha <span class="op">+</span><span class="st"> </span>beta <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 0.5</code></pre>
<p>That is, the mode of <span class="math inline">\(\text{Beta} (2, 2) = .5\)</span>.</p>
<p>We won’t be able to make the wireframe plots on the left of Figure 9.2, but we can make the others. We’ll make the initial data following Kruschke’s (p. 226) formulas.</p>
<p><span class="math display">\[p(\theta, \omega) = p(\theta | \omega) p(\omega) = \operatorname{Beta} (\theta | \omega (100 - 2) + 1, (1 - \omega) (100 - 2) + 1) \operatorname{Beta} (\omega | 2, 2)\]</span></p>
<p>First, we’ll make a custom function, <code>make_prior()</code> based on the formulas.</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb594-1" data-line-number="1">make_prior &lt;-<span class="st"> </span><span class="cf">function</span>(theta, omega, alpha, beta, kappa) {</a>
<a class="sourceLine" id="cb594-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb594-3" data-line-number="3">  <span class="co"># p(theta | omega)</span></a>
<a class="sourceLine" id="cb594-4" data-line-number="4">  t &lt;-<span class="st"> </span><span class="kw">dbeta</span>(<span class="dt">x =</span> theta,</a>
<a class="sourceLine" id="cb594-5" data-line-number="5">             <span class="dt">shape1 =</span>      omega  <span class="op">*</span><span class="st"> </span>(kappa <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb594-6" data-line-number="6">             <span class="dt">shape2 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>omega) <span class="op">*</span><span class="st"> </span>(kappa <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb594-7" data-line-number="7">  <span class="co"># p(omega)</span></a>
<a class="sourceLine" id="cb594-8" data-line-number="8">  o &lt;-<span class="st"> </span><span class="kw">dbeta</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb594-9" data-line-number="9">             <span class="dt">shape1 =</span> alpha,</a>
<a class="sourceLine" id="cb594-10" data-line-number="10">             <span class="dt">shape2 =</span> beta)</a>
<a class="sourceLine" id="cb594-11" data-line-number="11">  <span class="co"># p(theta, omega) = p(theta | omega) * p(omega)</span></a>
<a class="sourceLine" id="cb594-12" data-line-number="12">  <span class="kw">return</span>(t <span class="op">*</span><span class="st"> </span>o)</a>
<a class="sourceLine" id="cb594-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb594-14" data-line-number="14">}</a></code></pre></div>
<p>Next we’ll define the parameter space as a tightly-spaced sequence of values ranging from 0 to 1.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb595-1" data-line-number="1">parameter_space &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.01</span>)</a></code></pre></div>
<p>Now we’ll use <code>parameter_space</code> to define the ranges for the two variables, <code>theta</code> and <code>omega</code>, which we’ll save in a tibble. We’ll then sequentially feed those <code>theta</code> and <code>omega</code> values into our <code>make_prior()</code> while manually specifying the desired values for <code>alpha</code>, <code>beta</code>, and <code>kappa</code>.</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb596-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb596-2" data-line-number="2"><span class="st">  </span><span class="co"># these first two functions define the grid for our grid approximation</span></a>
<a class="sourceLine" id="cb596-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">theta =</span> parameter_space,</a>
<a class="sourceLine" id="cb596-4" data-line-number="4">         <span class="dt">omega =</span> parameter_space) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb596-5" data-line-number="5"><span class="st">  </span><span class="kw">expand</span>(theta, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb596-6" data-line-number="6"><span class="st">  </span><span class="co"># compute the joint prior</span></a>
<a class="sourceLine" id="cb596-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="kw">make_prior</span>(theta, omega, <span class="dt">alpha =</span> <span class="dv">2</span>, <span class="dt">beta =</span> <span class="dv">2</span>, <span class="dt">kappa =</span> <span class="dv">100</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb596-8" data-line-number="8"><span class="st">  </span><span class="co"># convert the prior from the density metric to the probability metric</span></a>
<a class="sourceLine" id="cb596-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> prior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(prior))</a>
<a class="sourceLine" id="cb596-10" data-line-number="10"></a>
<a class="sourceLine" id="cb596-11" data-line-number="11"><span class="kw">head</span>(d)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   theta omega prior
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0  0        0
## 2     0  0.01     0
## 3     0  0.02     0
## 4     0  0.03     0
## 5     0  0.04     0
## 6     0  0.05     0</code></pre>
<p>Now we’re ready to plot the top middle panel of Figure 9.2.</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb598-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb598-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta, <span class="dt">y =</span> omega, <span class="dt">fill =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb598-6" data-line-number="6">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb598-7" data-line-number="7"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb598-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb598-9" data-line-number="9">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-6-1.png" /><!-- --></p>
<p>Note, you could also make this with <code>geom_tile()</code>. But <code>geom_raster()</code> with the <code>interpolate = T</code> argument smooths the color transitions.</p>
<p>If we collapse “the joint prior across <span class="math inline">\(\theta\)</span>” (i.e., <code>group_by(omega)</code> and then <code>sum(prior)</code>), we plot the marginal distribution for <span class="math inline">\(p(\omega)\)</span> as seen in the top right panel.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb599-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb599-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb599-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb599-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb599-6" data-line-number="6">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb599-7" data-line-number="7">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb599-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb599-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(omega),</a>
<a class="sourceLine" id="cb599-10" data-line-number="10">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Marginal p(&quot;</span>, omega, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb599-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_flip</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.03</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb599-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-7-1.png" /><!-- --></p>
<p>We’ll follow a similar procedure to get the marginal probability distribution for <code>theta</code>.</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb600-1" data-line-number="1">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb600-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(theta) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb600-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb600-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb600-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta,</a>
<a class="sourceLine" id="cb600-6" data-line-number="6">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb600-7" data-line-number="7">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb600-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb600-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb600-10" data-line-number="10">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Marginal p(&quot;</span>, theta, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb600-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.03</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb600-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-8-1.png" /><!-- --></p>
<p>We’ll use the <code>filter()</code> function to take the two slices from the posterior grid. Since we’re taking slices, we’re no longer working with the joint probability distribution. As such, our two marginal prior distributions for <code>theta</code> no longer sum to 1, which means they’re no longer in a probability metric. No worries. After we group by <code>omega</code>, we can simply divide <code>prior</code> by the <code>sum()</code> of <code>prior</code> which renormalizes the two slices “so that they are individually proper probability densities that sum to 1.0 over <span class="math inline">\(\theta\)</span>” (p. 226).</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb601-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(omega <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(.<span class="dv">25</span>, <span class="fl">.75</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> prior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;omega == &quot;</span>, omega), </a>
<a class="sourceLine" id="cb601-6" data-line-number="6">                        <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;omega == 0.75&quot;</span>, <span class="st">&quot;omega == 0.25&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb601-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb601-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta,</a>
<a class="sourceLine" id="cb601-9" data-line-number="9">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb601-10" data-line-number="10">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb601-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb601-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb601-13" data-line-number="13">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta, <span class="st">&quot;|&quot;</span>, omega, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb601-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb601-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb601-16" data-line-number="16"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-9-1.png" /><!-- --></p>
<p>As Kruschke pointed out at the top of page 228, these are indeed Beta densities. Here’s proof.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb602-1" data-line-number="1"><span class="co"># we&#39;ll want this for the annotation</span></a>
<a class="sourceLine" id="cb602-2" data-line-number="2">text &lt;-</a>
<a class="sourceLine" id="cb602-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">theta =</span> <span class="kw">c</span>(.<span class="dv">75</span>, <span class="fl">.25</span>),</a>
<a class="sourceLine" id="cb602-4" data-line-number="4">         <span class="dt">y =</span> <span class="fl">10.5</span>,</a>
<a class="sourceLine" id="cb602-5" data-line-number="5">         <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;Beta(74.5, 25.5)&quot;</span>, <span class="st">&quot;Beta(25.5, 74.5)&quot;</span>),</a>
<a class="sourceLine" id="cb602-6" data-line-number="6">         <span class="dt">omega =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>])</a>
<a class="sourceLine" id="cb602-7" data-line-number="7"></a>
<a class="sourceLine" id="cb602-8" data-line-number="8"><span class="co"># here&#39;s the primary data for the plot</span></a>
<a class="sourceLine" id="cb602-9" data-line-number="9"><span class="kw">tibble</span>(<span class="dt">theta =</span> <span class="kw">rep</span>(parameter_space, <span class="dt">times =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb602-10" data-line-number="10">       <span class="dt">alpha =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="fl">74.5</span>, <span class="fl">25.5</span>),   <span class="dt">each =</span> <span class="dv">101</span>),</a>
<a class="sourceLine" id="cb602-11" data-line-number="11">       <span class="dt">beta  =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="fl">25.5</span>, <span class="fl">74.5</span>),   <span class="dt">each =</span> <span class="dv">101</span>),</a>
<a class="sourceLine" id="cb602-12" data-line-number="12">       <span class="dt">omega =</span> <span class="kw">rep</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>],    <span class="dt">each =</span> <span class="dv">101</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb602-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb602-14" data-line-number="14"><span class="st">  </span><span class="co"># the plot</span></a>
<a class="sourceLine" id="cb602-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta, <span class="dt">fill =</span> omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb602-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin  =</span> <span class="dv">0</span>, <span class="dt">ymax  =</span> <span class="kw">dbeta</span>(<span class="dt">x =</span> theta, <span class="dt">shape1 =</span> alpha, <span class="dt">shape2 =</span> beta))) <span class="op">+</span></a>
<a class="sourceLine" id="cb602-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> text,</a>
<a class="sourceLine" id="cb602-18" data-line-number="18">            <span class="kw">aes</span>(<span class="dt">y =</span> y, <span class="dt">label =</span> label, <span class="dt">color =</span> omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb602-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">begin =</span> <span class="fl">.3</span>, <span class="dt">end =</span> <span class="fl">.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb602-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">begin =</span> <span class="fl">.3</span>, <span class="dt">end =</span> <span class="fl">.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb602-21" data-line-number="21"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb602-22" data-line-number="22">       <span class="dt">y =</span> <span class="st">&quot;density&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb602-23" data-line-number="23"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">12</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb602-24" data-line-number="24"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb602-25" data-line-number="25">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-10-1.png" /><!-- --></p>
<p>But back on track, we need the Bernoulli likelihood function for the lower three rows of Figure 9.2.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" data-line-number="1">bernoulli_likelihood &lt;-<span class="st"> </span><span class="cf">function</span>(theta, data) {</a>
<a class="sourceLine" id="cb603-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(data)</a>
<a class="sourceLine" id="cb603-3" data-line-number="3">  z &lt;-<span class="st"> </span><span class="kw">sum</span>(data)</a>
<a class="sourceLine" id="cb603-4" data-line-number="4">  <span class="kw">return</span>(theta<span class="op">^</span>z <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>theta)<span class="op">^</span>(n <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(data)))</a>
<a class="sourceLine" id="cb603-5" data-line-number="5">  }</a></code></pre></div>
<p>Time to feed <code>theta</code> and our data into the <code>bernoulli_likelihood()</code> function, which will allow us to make the 2-dimensional density plot in the middle of Figure 9.2.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb604-1" data-line-number="1"><span class="co"># define the data</span></a>
<a class="sourceLine" id="cb604-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb604-3" data-line-number="3">z &lt;-<span class="st"> </span><span class="dv">9</span></a>
<a class="sourceLine" id="cb604-4" data-line-number="4"></a>
<a class="sourceLine" id="cb604-5" data-line-number="5">trial_data &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">times =</span> <span class="kw">c</span>(n <span class="op">-</span><span class="st"> </span>z, z))</a>
<a class="sourceLine" id="cb604-6" data-line-number="6"></a>
<a class="sourceLine" id="cb604-7" data-line-number="7"><span class="co"># compute the likelihood</span></a>
<a class="sourceLine" id="cb604-8" data-line-number="8">d &lt;-</a>
<a class="sourceLine" id="cb604-9" data-line-number="9"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb604-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">likelihood =</span> <span class="kw">bernoulli_likelihood</span>(<span class="dt">theta =</span> theta, </a>
<a class="sourceLine" id="cb604-11" data-line-number="11">                                           <span class="dt">data  =</span> trial_data))</a>
<a class="sourceLine" id="cb604-12" data-line-number="12"></a>
<a class="sourceLine" id="cb604-13" data-line-number="13"><span class="co"># plot</span></a>
<a class="sourceLine" id="cb604-14" data-line-number="14">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb604-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta, <span class="dt">y =</span> omega, <span class="dt">fill =</span> likelihood)) <span class="op">+</span></a>
<a class="sourceLine" id="cb604-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb604-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb604-18" data-line-number="18"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb604-19" data-line-number="19">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb604-20" data-line-number="20"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb604-21" data-line-number="21"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb604-22" data-line-number="22">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-12-1.png" /><!-- --></p>
<p>Note how this plot demonstrates how the likelihood is solely dependent on <span class="math inline">\(\theta\)</span>; it’s orthogonal to <span class="math inline">\(\omega\)</span>. This is the visual consequence of Kruschke’s Formula 9.6,</p>
<p><span class="math display">\[\begin{align*}
p (\theta, \omega | y) &amp; = \frac{p (y | \theta, \omega) \; p (\theta, \omega)}{p (y)} \\
                       &amp; = \frac{p (y | \theta) \; p (\theta | \omega) \; p (\omega)}{p (y)}.
\end{align*}\]</span></p>
<p>That is, in the second line of the equation, the probability of <span class="math inline">\(y\)</span> was only conditional on <span class="math inline">\(\theta\)</span>. But the reason we call this a hierarchical model is because the probability of <span class="math inline">\(\theta\)</span> itself is conditioned on <span class="math inline">\(\omega\)</span>. The prior itself had a prior.</p>
<p>From Formula 9.1, the posterior <span class="math inline">\(p(\theta, \omega | D)\)</span> is proportional to <span class="math inline">\(p(D | \theta) \; p(\theta | \omega) \; p(\omega)\)</span>. Divide that by the normalizing constant and we’ll have it in a proper probability metric. Recall that we’ve already saved the results of <span class="math inline">\(p(\theta | \omega) \; p(\omega)\)</span> in the <code>prior</code> column. So we just need to multiply <code>prior</code> by <code>likelihood</code> and divide by their sum.</p>
<p>Our first depiction will be the middle panel of the second row from the bottom.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb605-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb605-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">posterior =</span> (likelihood <span class="op">*</span><span class="st"> </span>prior) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(likelihood <span class="op">*</span><span class="st"> </span>prior)) </a>
<a class="sourceLine" id="cb605-4" data-line-number="4"></a>
<a class="sourceLine" id="cb605-5" data-line-number="5">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb605-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta, <span class="dt">y =</span> omega, <span class="dt">fill =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb605-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb605-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb605-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb605-10" data-line-number="10">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb605-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb605-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb605-13" data-line-number="13">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-13-1.png" /><!-- --></p>
<p>Although the likelihood was orthogonal to <span class="math inline">\(\omega\)</span>, conditioning the prior for <span class="math inline">\(\theta\)</span> on <span class="math inline">\(\omega\)</span> resulted in a posterior that was conditioned on both <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\omega\)</span>.</p>
<p>Making the marginal plots for <code>posterior</code> is much like when making them for <code>prior</code>, above.</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb606-1" data-line-number="1"><span class="co"># for omega</span></a>
<a class="sourceLine" id="cb606-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb606-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb606-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb606-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb606-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb606-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb606-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb606-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb606-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(omega),</a>
<a class="sourceLine" id="cb606-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Marginal p(&quot;</span>, omega, <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb606-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb606-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-14-1.png" /><!-- --></p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" data-line-number="1"><span class="co"># for theta</span></a>
<a class="sourceLine" id="cb607-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb607-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb607-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb607-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb607-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta,</a>
<a class="sourceLine" id="cb607-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb607-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb607-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb607-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb607-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Marginal p(&quot;</span>, theta, <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb607-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb607-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-14-2.png" /><!-- --></p>
<p>Note that after we slice with <code>filter()</code>, the next two wrangling lines renormalize those posterior slices into probability metrics. That is, when we take a slice through the joint posterior at a particular value of <span class="math inline">\(\omega\)</span>, and renormalize by dividing the sum of discrete probability masses in that slice, we get the conditional distribution <span class="math inline">\(p(\theta | \omega, D)\)</span>.</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb608-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb608-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(omega <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(.<span class="dv">25</span>, <span class="fl">.75</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb608-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb608-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">posterior =</span> posterior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb608-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;omega == &quot;</span>, omega),</a>
<a class="sourceLine" id="cb608-6" data-line-number="6">                        <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;omega == 0.75&quot;</span>, <span class="st">&quot;omega == 0.25&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb608-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb608-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta,</a>
<a class="sourceLine" id="cb608-9" data-line-number="9">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb608-10" data-line-number="10">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb608-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb608-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb608-13" data-line-number="13">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta, <span class="st">&quot;|&quot;</span>, omega, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb608-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb608-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">labeller =</span> label_parsed, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-15-1.png" /><!-- --></p>
<p>To repeat the process for Figure 9.3, we’ll first compute the new joint prior.</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb609-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">theta =</span> parameter_space,</a>
<a class="sourceLine" id="cb609-3" data-line-number="3">         <span class="dt">omega =</span> parameter_space) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb609-4" data-line-number="4"><span class="st">  </span><span class="kw">expand</span>(theta, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb609-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="kw">make_prior</span>(theta, omega, <span class="dt">alpha =</span> <span class="dv">20</span>, <span class="dt">beta =</span> <span class="dv">20</span>, <span class="dt">kappa =</span> <span class="dv">6</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb609-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> prior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(prior))</a></code></pre></div>
<p>Here’s the initial data and the 2-dimensional density plot for the prior, the middle plot in the top row of Figure 9.3.</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb610-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb610-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta, <span class="dt">y =</span> omega, <span class="dt">fill =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb610-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb610-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb610-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb610-6" data-line-number="6">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb610-7" data-line-number="7"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb610-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb610-9" data-line-number="9">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-17-1.png" /><!-- --></p>
<p>That higher certainty in <span class="math inline">\(\omega\)</span> resulted in a two-dimensional density plot where the values on the y-axis were concentrated near .5. This will have down-the-road consequences for the posterior. But before we get there, we’ll average over <code>omega</code> and <code>theta</code> to plot their marginal prior distributions.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb611-1" data-line-number="1"><span class="co"># for omega</span></a>
<a class="sourceLine" id="cb611-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb611-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb611-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb611-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb611-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb611-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb611-8" data-line-number="8">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb611-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb611-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(omega),</a>
<a class="sourceLine" id="cb611-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Marginal p(&quot;</span>, omega, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb611-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb611-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-18-1.png" /><!-- --></p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb612-1" data-line-number="1"><span class="co"># for theta</span></a>
<a class="sourceLine" id="cb612-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb612-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb612-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb612-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb612-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta,</a>
<a class="sourceLine" id="cb612-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb612-8" data-line-number="8">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb612-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb612-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb612-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Marginal p(&quot;</span>, theta, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb612-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.03</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb612-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-18-2.png" /><!-- --></p>
<p>Here are the two short plots in the right panel of the second row from the top of Figure 9.3.</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb613-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb613-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(omega <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(.<span class="dv">25</span>, <span class="fl">.75</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb613-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb613-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> prior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb613-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;omega == &quot;</span>, omega), </a>
<a class="sourceLine" id="cb613-6" data-line-number="6">                        <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;omega == 0.75&quot;</span>, <span class="st">&quot;omega == 0.25&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb613-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb613-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta,</a>
<a class="sourceLine" id="cb613-9" data-line-number="9">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb613-10" data-line-number="10">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb613-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb613-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb613-13" data-line-number="13">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta, <span class="st">&quot;|&quot;</span>, omega, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb613-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.0375</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb613-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb613-16" data-line-number="16"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-19-1.png" /><!-- --></p>
<p>Now we’re ready for the likelihood.</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb614-1" data-line-number="1"><span class="co"># compute</span></a>
<a class="sourceLine" id="cb614-2" data-line-number="2">d &lt;-</a>
<a class="sourceLine" id="cb614-3" data-line-number="3"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb614-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">likelihood =</span> <span class="kw">bernoulli_likelihood</span>(<span class="dt">theta =</span> theta, </a>
<a class="sourceLine" id="cb614-5" data-line-number="5">                                           <span class="dt">data  =</span> trial_data))</a>
<a class="sourceLine" id="cb614-6" data-line-number="6"></a>
<a class="sourceLine" id="cb614-7" data-line-number="7"><span class="co"># plot</span></a>
<a class="sourceLine" id="cb614-8" data-line-number="8">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb614-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta, <span class="dt">y =</span> omega, <span class="dt">fill =</span> likelihood)) <span class="op">+</span></a>
<a class="sourceLine" id="cb614-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb614-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb614-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb614-13" data-line-number="13">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb614-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb614-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb614-16" data-line-number="16">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-20-1.png" /><!-- --></p>
<p>Now on to the posterior. Our first depiction will be the middle panel of the second row from the bottom of Figure 9.3. This will be <span class="math inline">\(p(\theta, \omega | y)\)</span>.</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb615-1" data-line-number="1"><span class="co"># compute the posterior</span></a>
<a class="sourceLine" id="cb615-2" data-line-number="2">d &lt;-</a>
<a class="sourceLine" id="cb615-3" data-line-number="3"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb615-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">posterior =</span> (likelihood <span class="op">*</span><span class="st"> </span>prior) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(likelihood <span class="op">*</span><span class="st"> </span>prior)) </a>
<a class="sourceLine" id="cb615-5" data-line-number="5"></a>
<a class="sourceLine" id="cb615-6" data-line-number="6"><span class="co"># plot</span></a>
<a class="sourceLine" id="cb615-7" data-line-number="7">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb615-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta, <span class="dt">y =</span> omega, <span class="dt">fill =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb615-12" data-line-number="12">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb615-13" data-line-number="13"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb615-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb615-15" data-line-number="15">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-21-1.png" /><!-- --></p>
<p>Here are the marginal plots for the two dimensions in our <code>posterior</code>.</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb616-1" data-line-number="1"><span class="co"># for omega</span></a>
<a class="sourceLine" id="cb616-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb616-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb616-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb616-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb616-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb616-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb616-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb616-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb616-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(omega),</a>
<a class="sourceLine" id="cb616-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Marginal p(&quot;</span>, omega, <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb616-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb616-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-22-1.png" /><!-- --></p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb617-1" data-line-number="1"><span class="co"># for theta</span></a>
<a class="sourceLine" id="cb617-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb617-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb617-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb617-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb617-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta,</a>
<a class="sourceLine" id="cb617-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb617-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb617-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb617-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb617-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Marginal p(&quot;</span>, theta, <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb617-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb617-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-22-2.png" /><!-- --></p>
<p>And we’ll finish off with the plots of Figure 9.3’s lower right panel.</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb618-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(omega <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(.<span class="dv">25</span>, <span class="fl">.75</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">posterior =</span> posterior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb618-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;omega == &quot;</span>, omega),</a>
<a class="sourceLine" id="cb618-6" data-line-number="6">                        <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;omega == 0.75&quot;</span>, <span class="st">&quot;omega == 0.25&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb618-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb618-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta,</a>
<a class="sourceLine" id="cb618-9" data-line-number="9">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb618-10" data-line-number="10">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb618-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb618-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb618-13" data-line-number="13">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta, <span class="st">&quot;|&quot;</span>, omega, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb618-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.0375</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb618-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb618-16" data-line-number="16"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">labeller =</span> label_parsed, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-23-1.png" /><!-- --></p>
</div>
</div>
<div id="multiple-coins-from-a-single-mint" class="section level2">
<h2><span class="header-section-number">9.2</span> Multiple coins from a single mint</h2>
<blockquote>
<p>What if we collect data from more than one coin created by the mint? If each coin has its own distinct bias <span class="math inline">\(\theta_s\)</span>, then we are estimating a distinct parameter value for each coin, and using all the data to estimate <span class="math inline">\(\omega\)</span>. (p. 230)</p>
</blockquote>
<div id="posterior-via-grid-approximation.-1" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Posterior via grid approximation.</h3>
<p>Now we have two coins,</p>
<blockquote>
<p>the full prior distribution is a joint distribution over three parameters: <span class="math inline">\(\omega\)</span>, <span class="math inline">\(\theta_1\)</span>, and <span class="math inline">\(\theta_2\)</span>. In a grid approximation, the prior is specified as a three-dimensional (3D) array that holds the prior probability at various grid points in the 3D space. (p. 233)</p>
</blockquote>
<p>So we’re going to have to update our <code>make_prior()</code> function. It was originally designed to handle two dimensions, <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\omega\)</span>. But now we have to update it to handle our three dimensions.</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb619-1" data-line-number="1">make_prior &lt;-<span class="st"> </span><span class="cf">function</span>(theta1, theta2, omega, alpha, beta, kappa) {</a>
<a class="sourceLine" id="cb619-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb619-3" data-line-number="3">  <span class="co"># p(theta_1 | omega)</span></a>
<a class="sourceLine" id="cb619-4" data-line-number="4">  t1 &lt;-<span class="st"> </span><span class="kw">dbeta</span>(<span class="dt">x =</span> theta1,</a>
<a class="sourceLine" id="cb619-5" data-line-number="5">             <span class="dt">shape1 =</span>      omega  <span class="op">*</span><span class="st"> </span>(kappa <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb619-6" data-line-number="6">             <span class="dt">shape2 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>omega) <span class="op">*</span><span class="st"> </span>(kappa <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb619-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb619-8" data-line-number="8">  <span class="co"># p(theta_2 | omega)</span></a>
<a class="sourceLine" id="cb619-9" data-line-number="9">  t2 &lt;-<span class="st"> </span><span class="kw">dbeta</span>(<span class="dt">x =</span> theta2,</a>
<a class="sourceLine" id="cb619-10" data-line-number="10">             <span class="dt">shape1 =</span>      omega  <span class="op">*</span><span class="st"> </span>(kappa <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb619-11" data-line-number="11">             <span class="dt">shape2 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>omega) <span class="op">*</span><span class="st"> </span>(kappa <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb619-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb619-13" data-line-number="13">  <span class="co"># p(omega)</span></a>
<a class="sourceLine" id="cb619-14" data-line-number="14">  o &lt;-<span class="st"> </span><span class="kw">dbeta</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb619-15" data-line-number="15">             <span class="dt">shape1 =</span> alpha,</a>
<a class="sourceLine" id="cb619-16" data-line-number="16">             <span class="dt">shape2 =</span> beta)</a>
<a class="sourceLine" id="cb619-17" data-line-number="17">  <span class="co"># p(theta1, theta2, omega) = p(theta1 | omega) * p(theta2 | omega) * p(omega)</span></a>
<a class="sourceLine" id="cb619-18" data-line-number="18">  <span class="kw">return</span>(t1 <span class="op">*</span><span class="st"> </span>t2 <span class="op">*</span><span class="st"> </span>o)</a>
<a class="sourceLine" id="cb619-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb619-20" data-line-number="20">}</a></code></pre></div>
<p>Let’s make our new data object, <code>d</code>.</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb620-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb620-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">theta_1 =</span> parameter_space,</a>
<a class="sourceLine" id="cb620-3" data-line-number="3">         <span class="dt">theta_2 =</span> parameter_space,</a>
<a class="sourceLine" id="cb620-4" data-line-number="4">         <span class="dt">omega   =</span> parameter_space) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb620-5" data-line-number="5"><span class="st">  </span><span class="kw">expand</span>(theta_<span class="dv">1</span>, theta_<span class="dv">2</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb620-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="kw">make_prior</span>(theta_<span class="dv">1</span>, theta_<span class="dv">2</span>, omega, <span class="dt">alpha =</span> <span class="dv">2</span>, <span class="dt">beta =</span> <span class="dv">2</span>, <span class="dt">kappa =</span> <span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb620-7" data-line-number="7"><span class="st">  </span><span class="co"># here we normalize</span></a>
<a class="sourceLine" id="cb620-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> prior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(prior))</a>
<a class="sourceLine" id="cb620-9" data-line-number="9"></a>
<a class="sourceLine" id="cb620-10" data-line-number="10"><span class="kw">glimpse</span>(d)</a></code></pre></div>
<pre><code>## Observations: 1,030,301
## Variables: 4
## $ theta_1 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ theta_2 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ omega   &lt;dbl&gt; 0.00, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.…
## $ prior   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</code></pre>
<p>Unlike what Kruschke said in the text, we’re not using a 3D data array. Rather, we’re just using a tibble with which <code>prior</code> has been expanded across all possible dimensions of the three indexing variables: <code>theta_1</code>, <code>theta_2</code>, and <code>omega</code>. As you can see from the ‘Observations’ count, above, this makes for a very long tibble.</p>
<p>“Because the parameter space is 3D, a distribution on it cannot easily be displayed on a 2D page. Instead, Figure 9.5 shows various marginal distributions” (p. 234). The consequence of that is when we marginalize, we’ll have to group by the two variables we’d like to retain for the plot. For example, the plots in the left and middle columns of the top row are the same save for their indices. So let’s just do the plot for <code>theta_1</code>. In order to marginalize over <code>theta_2</code>, we’ll need to <code>group_by(theta_1, omega)</code> and then <code>summarise(prior = sum(prior))</code>.</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb622-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb622-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb622-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb622-4" data-line-number="4"></a>
<a class="sourceLine" id="cb622-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb622-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb622-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb622-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb622-9" data-line-number="9">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb622-10" data-line-number="10"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb622-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb622-12" data-line-number="12">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-26-1.png" /><!-- --></p>
<p>But we just have to average over <code>omega</code> and <code>theta_1</code> to plot their marginal prior distributions.</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" data-line-number="1"><span class="co"># for omega</span></a>
<a class="sourceLine" id="cb623-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb623-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb623-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb623-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb623-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb623-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb623-8" data-line-number="8">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb623-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb623-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(omega),</a>
<a class="sourceLine" id="cb623-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, omega, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb623-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_flip</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb623-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-27-1.png" /><!-- --></p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb624-1" data-line-number="1"><span class="co"># for theta</span></a>
<a class="sourceLine" id="cb624-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb624-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb624-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb624-5" data-line-number="5"></a>
<a class="sourceLine" id="cb624-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb624-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb624-8" data-line-number="8">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb624-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb624-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb624-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta[<span class="dv">1</span>], <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb624-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb624-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-27-2.png" /><!-- --></p>
<p>Before we make the plots in the middle row of Figure 9.5, we need to add the likelihoods. Recall that we’re presuming the coin flips contained in <span class="math inline">\(D_1\)</span> and <span class="math inline">\(D_2\)</span> are independent. Kruschke explained in Chapter 7, section 4.1, that</p>
<blockquote>
<p>independence of the data across the two coins means that the data from coin 1 depend only on the bias in coin 1, and the data from coin 2 depend only on the bias in coin 2, which can be expressed formally as <span class="math inline">\(p(y_1 | \theta_1, \theta_2) = p(y_1 | \theta_1)\)</span> and <span class="math inline">\(p(y_2 | \theta_1, \theta_2) = p(y_2 | \theta_2)\)</span>. (p. 164)</p>
</blockquote>
<p>The likelihood function for our two series of coin flips is then</p>
<p><span class="math display">\[p(D | \theta_1, \theta_2) = \Big ( \theta_1^{z_1} (1 - \theta_1) ^ {N_1 - z_1} \Big ) \Big ( \theta_2^{z_2} (1 - \theta_2) ^ {N_2 - z_2} \Big ).\]</span></p>
<p>The upshot is we can compute the likelihoods for <span class="math inline">\(D_1\)</span> and <span class="math inline">\(D_2\)</span> separately and just multiply them together.</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb625-1" data-line-number="1"><span class="co"># D1: 3 heads, 12 tails</span></a>
<a class="sourceLine" id="cb625-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb625-3" data-line-number="3">z &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb625-4" data-line-number="4"></a>
<a class="sourceLine" id="cb625-5" data-line-number="5">trial_data_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">times =</span> <span class="kw">c</span>(n <span class="op">-</span><span class="st"> </span>z, z))</a>
<a class="sourceLine" id="cb625-6" data-line-number="6"></a>
<a class="sourceLine" id="cb625-7" data-line-number="7"><span class="co"># D2: 4 heads, 1 tail</span></a>
<a class="sourceLine" id="cb625-8" data-line-number="8">n &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb625-9" data-line-number="9">z &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb625-10" data-line-number="10"></a>
<a class="sourceLine" id="cb625-11" data-line-number="11">trial_data_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">times =</span> <span class="kw">c</span>(n <span class="op">-</span><span class="st"> </span>z, z))</a>
<a class="sourceLine" id="cb625-12" data-line-number="12">d &lt;-</a>
<a class="sourceLine" id="cb625-13" data-line-number="13"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb625-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">likelihood_1 =</span> <span class="kw">bernoulli_likelihood</span>(<span class="dt">theta =</span> theta_<span class="dv">1</span>, </a>
<a class="sourceLine" id="cb625-15" data-line-number="15">                                             <span class="dt">data  =</span> trial_data_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb625-16" data-line-number="16">         <span class="dt">likelihood_2 =</span> <span class="kw">bernoulli_likelihood</span>(<span class="dt">theta =</span> theta_<span class="dv">2</span>, </a>
<a class="sourceLine" id="cb625-17" data-line-number="17">                                             <span class="dt">data  =</span> trial_data_<span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb625-18" data-line-number="18"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">likelihood =</span> likelihood_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>likelihood_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb625-19" data-line-number="19"></a>
<a class="sourceLine" id="cb625-20" data-line-number="20"><span class="kw">head</span>(d)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   theta_1 theta_2 omega prior likelihood_1 likelihood_2 likelihood
##     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
## 1       0       0  0        0            0            0          0
## 2       0       0  0.01     0            0            0          0
## 3       0       0  0.02     0            0            0          0
## 4       0       0  0.03     0            0            0          0
## 5       0       0  0.04     0            0            0          0
## 6       0       0  0.05     0            0            0          0</code></pre>
<p>Now after a little <code>group_by()</code> followed by <code>summarise()</code> we can plot the two marginal likelihoods, the two plots in the middle row of Figure 9.5.</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb627-1" data-line-number="1"><span class="co"># likelihood_1</span></a>
<a class="sourceLine" id="cb627-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb627-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb627-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">likelihood =</span> <span class="kw">sum</span>(likelihood)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb627-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb627-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> likelihood)) <span class="op">+</span></a>
<a class="sourceLine" id="cb627-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb627-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb627-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb627-10" data-line-number="10">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb627-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb627-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb627-13" data-line-number="13">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-29-1.png" /><!-- --></p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb628-1" data-line-number="1"><span class="co"># likelihood_2</span></a>
<a class="sourceLine" id="cb628-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb628-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">2</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb628-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">likelihood =</span> <span class="kw">sum</span>(likelihood)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb628-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb628-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">2</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> likelihood)) <span class="op">+</span></a>
<a class="sourceLine" id="cb628-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb628-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb628-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb628-10" data-line-number="10">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb628-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb628-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb628-13" data-line-number="13">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-29-2.png" /><!-- --></p>
<p>The likelihoods look good. Next we compute the posterior in the same way we’ve done before: multiply the prior and the likelihood and then divide by their sum in order to convert the results to a probability metric.</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb629-1" data-line-number="1"><span class="co"># compute</span></a>
<a class="sourceLine" id="cb629-2" data-line-number="2">d &lt;-</a>
<a class="sourceLine" id="cb629-3" data-line-number="3"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb629-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">posterior =</span> (prior <span class="op">*</span><span class="st"> </span>likelihood) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(prior <span class="op">*</span><span class="st"> </span>likelihood))</a>
<a class="sourceLine" id="cb629-5" data-line-number="5"></a>
<a class="sourceLine" id="cb629-6" data-line-number="6"><span class="co"># posterior_1</span></a>
<a class="sourceLine" id="cb629-7" data-line-number="7">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb629-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb629-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb629-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb629-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb629-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb629-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb629-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb629-15" data-line-number="15">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb629-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb629-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb629-18" data-line-number="18">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-30-1.png" /><!-- --></p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb630-1" data-line-number="1"><span class="co"># posterior_2</span></a>
<a class="sourceLine" id="cb630-2" data-line-number="2">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb630-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">2</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb630-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb630-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb630-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">2</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb630-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb630-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb630-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb630-10" data-line-number="10">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb630-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb630-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb630-13" data-line-number="13">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-30-2.png" /><!-- --></p>
<p>Here’s the right plot on the second row from the bottom, the posterior distribution for <span class="math inline">\(\omega\)</span>.</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb631-1" data-line-number="1"><span class="co"># for omega</span></a>
<a class="sourceLine" id="cb631-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb631-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb631-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb631-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb631-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb631-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb631-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb631-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb631-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(omega),</a>
<a class="sourceLine" id="cb631-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, omega, <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb631-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_flip</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb631-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-31-1.png" /><!-- --></p>
<p>Now here are the marginal posterior plots on the bottom row of Figure 9.5.</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb632-1" data-line-number="1"><span class="co"># for theta_1</span></a>
<a class="sourceLine" id="cb632-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb632-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb632-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb632-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb632-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb632-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb632-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb632-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb632-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb632-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta[<span class="dv">1</span>], <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb632-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb632-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-32-1.png" /><!-- --></p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb633-1" data-line-number="1"><span class="co"># for theta_2</span></a>
<a class="sourceLine" id="cb633-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb633-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb633-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb633-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb633-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb633-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb633-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb633-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb633-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb633-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta[<span class="dv">2</span>], <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb633-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb633-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-32-2.png" /><!-- --></p>
<p>We’ll do this dog and pony one more time for Figure 9.6, which uses different priors on the same data. First, we make our new data object, <code>d</code>.</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb634-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb634-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">theta_1 =</span> parameter_space,</a>
<a class="sourceLine" id="cb634-3" data-line-number="3">         <span class="dt">theta_2 =</span> parameter_space,</a>
<a class="sourceLine" id="cb634-4" data-line-number="4">         <span class="dt">omega   =</span> parameter_space) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb634-5" data-line-number="5"><span class="st">  </span><span class="kw">expand</span>(theta_<span class="dv">1</span>, theta_<span class="dv">2</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb634-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="kw">make_prior</span>(theta_<span class="dv">1</span>, theta_<span class="dv">2</span>, omega, <span class="dt">alpha =</span> <span class="dv">2</span>, <span class="dt">beta =</span> <span class="dv">2</span>, <span class="dt">kappa =</span> <span class="dv">75</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb634-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> prior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(prior))</a></code></pre></div>
<p>Note how the only thing we changed from the last time was increasubf <code>kappa</code> to 75. Also like last time, the plots in the left and middle columns of the top row are the same save for their indices. So we’ll just focus on the one on the left.</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb635-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb635-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb635-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb635-4" data-line-number="4"></a>
<a class="sourceLine" id="cb635-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb635-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb635-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb635-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb635-9" data-line-number="9">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb635-10" data-line-number="10"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb635-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb635-12" data-line-number="12">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-34-1.png" /><!-- --></p>
<p>Now we’ll average over <code>omega</code> and <code>theta</code> to plot their marginal prior distributions.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb636-1" data-line-number="1"><span class="co"># for omega</span></a>
<a class="sourceLine" id="cb636-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb636-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb636-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb636-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb636-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb636-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb636-8" data-line-number="8">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb636-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb636-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(omega),</a>
<a class="sourceLine" id="cb636-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, omega, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb636-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_flip</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb636-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-35-1.png" /><!-- --></p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb637-1" data-line-number="1"><span class="co"># for theta</span></a>
<a class="sourceLine" id="cb637-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb637-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb637-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prior =</span> <span class="kw">sum</span>(prior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb637-5" data-line-number="5"></a>
<a class="sourceLine" id="cb637-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb637-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb637-8" data-line-number="8">             <span class="dt">ymax =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb637-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb637-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb637-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta[<span class="dv">1</span>], <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb637-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb637-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-35-2.png" /><!-- --></p>
<p>Let’s get those likelihoods in there and plot.</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb638-1" data-line-number="1"><span class="co"># D1: 3 heads, 12 tails</span></a>
<a class="sourceLine" id="cb638-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb638-3" data-line-number="3">z &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb638-4" data-line-number="4"></a>
<a class="sourceLine" id="cb638-5" data-line-number="5">trial_data_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">times =</span> <span class="kw">c</span>(n <span class="op">-</span><span class="st"> </span>z, z))</a>
<a class="sourceLine" id="cb638-6" data-line-number="6"></a>
<a class="sourceLine" id="cb638-7" data-line-number="7"><span class="co"># D2: 4 heads, 1 tail</span></a>
<a class="sourceLine" id="cb638-8" data-line-number="8">n &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb638-9" data-line-number="9">z &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb638-10" data-line-number="10"></a>
<a class="sourceLine" id="cb638-11" data-line-number="11">trial_data_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">times =</span> <span class="kw">c</span>(n <span class="op">-</span><span class="st"> </span>z, z))</a>
<a class="sourceLine" id="cb638-12" data-line-number="12"></a>
<a class="sourceLine" id="cb638-13" data-line-number="13"><span class="co"># compute the likelihoods</span></a>
<a class="sourceLine" id="cb638-14" data-line-number="14">d &lt;-</a>
<a class="sourceLine" id="cb638-15" data-line-number="15"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb638-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">likelihood_1 =</span> <span class="kw">bernoulli_likelihood</span>(<span class="dt">theta =</span> theta_<span class="dv">1</span>, </a>
<a class="sourceLine" id="cb638-17" data-line-number="17">                                             <span class="dt">data  =</span> trial_data_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb638-18" data-line-number="18">         <span class="dt">likelihood_2 =</span> <span class="kw">bernoulli_likelihood</span>(<span class="dt">theta =</span> theta_<span class="dv">2</span>, </a>
<a class="sourceLine" id="cb638-19" data-line-number="19">                                             <span class="dt">data  =</span> trial_data_<span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb638-20" data-line-number="20"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">likelihood =</span> likelihood_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>likelihood_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb638-21" data-line-number="21"></a>
<a class="sourceLine" id="cb638-22" data-line-number="22"><span class="co"># plot likelihood_1</span></a>
<a class="sourceLine" id="cb638-23" data-line-number="23">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb638-24" data-line-number="24"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb638-25" data-line-number="25"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">likelihood =</span> <span class="kw">sum</span>(likelihood)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb638-26" data-line-number="26"><span class="st">  </span></a>
<a class="sourceLine" id="cb638-27" data-line-number="27"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> likelihood)) <span class="op">+</span></a>
<a class="sourceLine" id="cb638-28" data-line-number="28"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb638-29" data-line-number="29"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb638-30" data-line-number="30"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb638-31" data-line-number="31">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb638-32" data-line-number="32"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb638-33" data-line-number="33"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb638-34" data-line-number="34">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-36-1.png" /><!-- --></p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb639-1" data-line-number="1"><span class="co"># plot likelihood_2</span></a>
<a class="sourceLine" id="cb639-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb639-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">2</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb639-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">likelihood =</span> <span class="kw">sum</span>(likelihood)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb639-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb639-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">2</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> likelihood)) <span class="op">+</span></a>
<a class="sourceLine" id="cb639-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb639-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb639-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb639-10" data-line-number="10">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb639-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb639-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb639-13" data-line-number="13">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-36-2.png" /><!-- --></p>
<p>Compute the posterior and make the left and middle plots of the second row to the bottom of Figure 9.6.</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb640-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb640-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb640-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">posterior =</span> (prior <span class="op">*</span><span class="st"> </span>likelihood) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(prior <span class="op">*</span><span class="st"> </span>likelihood))</a>
<a class="sourceLine" id="cb640-4" data-line-number="4"></a>
<a class="sourceLine" id="cb640-5" data-line-number="5"><span class="co"># posterior_1</span></a>
<a class="sourceLine" id="cb640-6" data-line-number="6">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb640-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb640-8" data-line-number="8"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb640-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb640-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb640-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb640-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb640-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb640-14" data-line-number="14">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb640-15" data-line-number="15"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb640-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb640-17" data-line-number="17">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-37-1.png" /><!-- --></p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb641-1" data-line-number="1"><span class="co"># posterior_2</span></a>
<a class="sourceLine" id="cb641-2" data-line-number="2">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb641-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">2</span>, omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb641-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb641-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb641-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">2</span>, <span class="dt">y =</span> omega, <span class="dt">fill =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">interpolate =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb641-10" data-line-number="10">       <span class="dt">y =</span> <span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb641-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb641-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb641-13" data-line-number="13">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-37-2.png" /><!-- --></p>
<p>Here’s the right plot on the same row, the posterior distribution for <span class="math inline">\(\omega\)</span>.</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb642-1" data-line-number="1"><span class="co"># for omega</span></a>
<a class="sourceLine" id="cb642-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb642-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(omega) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb642-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb642-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb642-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> omega,</a>
<a class="sourceLine" id="cb642-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb642-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb642-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb642-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(omega),</a>
<a class="sourceLine" id="cb642-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, omega, <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb642-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_flip</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb642-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-38-1.png" /><!-- --></p>
<p>Finally, here are the marginal posterior plots on the bottom row of Figure 9.6.</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb643-1" data-line-number="1"><span class="co"># for theta_1</span></a>
<a class="sourceLine" id="cb643-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb643-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb643-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb643-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb643-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb643-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb643-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb643-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb643-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb643-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta[<span class="dv">1</span>], <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb643-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb643-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-39-1.png" /><!-- --></p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb644-1" data-line-number="1"><span class="co"># for theta_2</span></a>
<a class="sourceLine" id="cb644-2" data-line-number="2">d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb644-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(theta_<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb644-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">posterior =</span> <span class="kw">sum</span>(posterior)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb644-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb644-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb644-7" data-line-number="7">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb644-8" data-line-number="8">             <span class="dt">ymax =</span> posterior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb644-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb644-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(theta[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb644-11" data-line-number="11">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, theta[<span class="dv">2</span>], <span class="st">&quot;|D)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb644-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.04</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb644-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-39-2.png" /><!-- --></p>
<blockquote>
<p>The grid approximation displayed in Figures 9.5 and 9.6 used combs of only [101] points on each parameter (<span class="math inline">\(\omega\)</span>, <span class="math inline">\(\theta_1\)</span>, and <span class="math inline">\(\theta_2\)</span>). This means that the 3D grid had [101<sup>3</sup> = 1,030,301] points, which is a size that can be handled easily on an ordinary desktop computer of the early 21st century. It is interesting to remind ourselves that the grid approximation displayed in Figures 9.5 and 9.6 would have been on the edge of computability 50 years ago, and would have been impossible 100 years ago. The number of points in a grid approximation can get hefty in a hurry. If we were to expand the example by including a third coin, with its parameter <span class="math inline">\(\theta_3\)</span>, then the grid would have [101<sup>4</sup> = 104,060,401] points, which already strains small computers. Include a fourth coin, and the grid contains over [10 billion] points. Grid approximation is not a viable approach to even modestly large problems, which we encounter next. (p. 235)</p>
</blockquote>
<p>In case you didn’t catch it, we used different numbers of points to evaluate each parameter. Whereas Kruschke indicated in the text he only used 50, we used 101. That value of 101 came from how we defined our <code>parameter_space</code> with the code <code>seq(from = 0, to = 1, by = .01)</code>. The reason we used a more densely-packed parameter space was to get smoother-looking 2D density plots.</p>
</div>
<div id="a-realistic-model-with-mcmc." class="section level3">
<h3><span class="header-section-number">9.2.2</span> A realistic model with MCMC.</h3>
<p>“Because the value of <span class="math inline">\(\kappa − 2\)</span> must be non-negative, the prior distribution on <span class="math inline">\(\kappa − 2\)</span> must not allow negative values” (p. 237). Gamma is one of the distributions with that property. The gamma distribution is defined by two parameters, its <em>shape</em> and <em>rate</em>. To get a sense of how those play out, here’ a look at the gamma densities of Figure 9.8.</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb645-1" data-line-number="1"><span class="co"># how many points do you want in your sequence of x values?</span></a>
<a class="sourceLine" id="cb645-2" data-line-number="2">length &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb645-3" data-line-number="3"></a>
<a class="sourceLine" id="cb645-4" data-line-number="4"><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb645-5" data-line-number="5"><span class="kw">tibble</span>(<span class="dt">shape =</span> <span class="kw">c</span>(.<span class="dv">01</span>, <span class="fl">1.56</span>, <span class="dv">1</span>, <span class="fl">6.25</span>),</a>
<a class="sourceLine" id="cb645-6" data-line-number="6">       <span class="dt">rate  =</span> <span class="kw">c</span>(.<span class="dv">01</span>, <span class="fl">.0312</span>, <span class="fl">.02</span>, <span class="fl">.125</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb645-7" data-line-number="7"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(shape, rate),</a>
<a class="sourceLine" id="cb645-8" data-line-number="8">         <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">200</span>, <span class="dt">length.out =</span> length)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb645-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean  =</span> shape <span class="op">*</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>rate,</a>
<a class="sourceLine" id="cb645-10" data-line-number="10">         <span class="dt">sd    =</span> <span class="kw">sqrt</span>(shape <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>rate)<span class="op">^</span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb645-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">str_c</span>(<span class="st">&quot;shape = &quot;</span>, shape, <span class="st">&quot;, rate = &quot;</span>, rate, </a>
<a class="sourceLine" id="cb645-12" data-line-number="12">                       <span class="st">&quot;</span><span class="ch">\n</span><span class="st">mean = &quot;</span>, mean, <span class="st">&quot;, sd = &quot;</span>, sd)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb645-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb645-14" data-line-number="14"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb645-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, </a>
<a class="sourceLine" id="cb645-16" data-line-number="16">             <span class="dt">ymin =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb645-17" data-line-number="17">             <span class="dt">ymax =</span> <span class="kw">dgamma</span>(<span class="dt">x =</span> x, <span class="dt">shape =</span> shape, <span class="dt">rate =</span> rate))) <span class="op">+</span></a>
<a class="sourceLine" id="cb645-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb645-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.01</span>, <span class="fl">.02</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb645-20" data-line-number="20"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">150</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb645-21" data-line-number="21"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(kappa),</a>
<a class="sourceLine" id="cb645-22" data-line-number="22">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;p(&quot;</span>, kappa, <span class="st">&quot;|s, r)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb645-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb645-24" data-line-number="24"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>label)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-40-1.png" /><!-- --></p>
<p>You can find the formulas for the mean and <span class="math inline">\(SD\)</span> for a given gamma distribution <a href="http://astrostatistics.psu.edu/su07/R/html/stats/html/GammaDist.html">here</a>. We used those formulas in the second <code>mutate()</code> statement for the data-prep stage of that last figure.</p>
<p>Using <span class="math inline">\(s\)</span> for shape and <span class="math inline">\(r\)</span> for rate, Kruschke’s equations 9.7 and 9.8 are as follows:</p>
<p><span class="math display">\[
s = \frac{\mu^2}{\sigma^2} \;\; \text{and} \;\; r = \frac{\mu}{\sigma^2} \;\; \text{for mean} \;\; \mu &gt; 0 \\
s = 1 + \omega r \;\; \text{where} \;\; r = \frac{\omega + \sqrt{\omega^2 + 4\sigma^2}}{2\sigma^2} \;\; \text{for mode} \;\; \omega &gt; 0.
\]</span></p>
<p>With those in hand, we can follow Kruschke’s <code>DBDA2E-utilities.R</code> file to make a couple convenience functions.</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb646-1" data-line-number="1">gamma_s_and_r_from_mean_sd &lt;-<span class="st"> </span><span class="cf">function</span>(mean, sd) {</a>
<a class="sourceLine" id="cb646-2" data-line-number="2">  <span class="cf">if</span> (mean <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;mean must be &gt; 0&quot;</span>)</a>
<a class="sourceLine" id="cb646-3" data-line-number="3">  <span class="cf">if</span> (sd   <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;sd must be &gt; 0&quot;</span>)</a>
<a class="sourceLine" id="cb646-4" data-line-number="4">  shape &lt;-<span class="st"> </span>mean<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>sd<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb646-5" data-line-number="5">  rate  &lt;-<span class="st"> </span>mean   <span class="op">/</span><span class="st"> </span>sd<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb646-6" data-line-number="6">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">shape =</span> shape, <span class="dt">rate =</span> rate))</a>
<a class="sourceLine" id="cb646-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb646-8" data-line-number="8"></a>
<a class="sourceLine" id="cb646-9" data-line-number="9">gamma_s_and_r_from_mode_sd &lt;-<span class="st"> </span><span class="cf">function</span>(mode, sd) {</a>
<a class="sourceLine" id="cb646-10" data-line-number="10">  <span class="cf">if</span> (mode <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;mode must be &gt; 0&quot;</span>)</a>
<a class="sourceLine" id="cb646-11" data-line-number="11">  <span class="cf">if</span> (sd   <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;sd must be &gt; 0&quot;</span>)</a>
<a class="sourceLine" id="cb646-12" data-line-number="12">  rate  &lt;-<span class="st"> </span>(mode <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(mode<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>sd<span class="op">^</span><span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sd<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb646-13" data-line-number="13">  shape &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>mode <span class="op">*</span><span class="st"> </span>rate</a>
<a class="sourceLine" id="cb646-14" data-line-number="14">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">shape =</span> shape, <span class="dt">rate =</span> rate))</a>
<a class="sourceLine" id="cb646-15" data-line-number="15">}</a></code></pre></div>
<p>They’re easy to put to use:</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb647-1" data-line-number="1"><span class="kw">gamma_s_and_r_from_mean_sd</span>(<span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">100</span>)</a></code></pre></div>
<pre><code>## $shape
## [1] 0.01
## 
## $rate
## [1] 0.001</code></pre>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb649-1" data-line-number="1"><span class="kw">gamma_s_and_r_from_mode_sd</span>(<span class="dt">mode =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">100</span>)</a></code></pre></div>
<pre><code>## $shape
## [1] 1.105125
## 
## $rate
## [1] 0.01051249</code></pre>
<p>Here’s a more detailed look at the structure of their output.</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb651-1" data-line-number="1">gamma_param &lt;-<span class="st"> </span><span class="kw">gamma_s_and_r_from_mode_sd</span>(<span class="dt">mode =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb651-2" data-line-number="2"></a>
<a class="sourceLine" id="cb651-3" data-line-number="3"><span class="kw">str</span>(gamma_param)</a></code></pre></div>
<pre><code>## List of 2
##  $ shape: num 1.11
##  $ rate : num 0.0105</code></pre>
</div>
<div id="doing-it-with-jags-brms." class="section level3">
<h3><span class="header-section-number">9.2.3</span> Doing it with <del>JAGS</del> brms.</h3>
<p>Unlike JAGS, the <strong>brms</strong> <code>formula</code> will not correspond as closely to Figure 9.7. You’ll see in just a bit.</p>
</div>
<div id="example-therapeutic-touch." class="section level3">
<h3><span class="header-section-number">9.2.4</span> Example: Therapeutic touch.</h3>
<p>Load the data from the <code>TherapeuticTouchData.csv</code> file.</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb653-1" data-line-number="1">my_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data.R/TherapeuticTouchData.csv&quot;</span>)</a>
<a class="sourceLine" id="cb653-2" data-line-number="2"></a>
<a class="sourceLine" id="cb653-3" data-line-number="3"><span class="kw">glimpse</span>(my_data)</a></code></pre></div>
<pre><code>## Observations: 280
## Variables: 2
## $ y &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0,…
## $ s &lt;chr&gt; &quot;S01&quot;, &quot;S01&quot;, &quot;S01&quot;, &quot;S01&quot;, &quot;S01&quot;, &quot;S01&quot;, &quot;S01&quot;, &quot;S01&quot;, &quot;S01&quot;,…</code></pre>
<p>Here are what the data look like:</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb655-1" data-line-number="1">my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb655-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> y <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb655-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb655-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb655-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> <span class="kw">stat</span>(count))) <span class="op">+</span></a>
<a class="sourceLine" id="cb655-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">9</span>, <span class="dt">by =</span> <span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb655-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">end =</span> <span class="fl">.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb655-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb655-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb655-10" data-line-number="10">        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb655-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>s, <span class="dt">ncol =</span> <span class="dv">7</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-45-1.png" /><!-- --></p>
<p>And here’s our Figure 9.9.</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb656-1" data-line-number="1">my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb656-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(s) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb656-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(y)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb656-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb656-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb656-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>,</a>
<a class="sourceLine" id="cb656-7" data-line-number="7">                 <span class="dt">size =</span> <span class="fl">.2</span>, <span class="dt">binwidth =</span> <span class="fl">.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb656-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb656-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Proportion Correct&quot;</span>,</a>
<a class="sourceLine" id="cb656-10" data-line-number="10">       <span class="dt">y =</span> <span class="st">&quot;# Practitioners&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb656-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-46-1.png" /><!-- --></p>
<p>Let’s open <strong>brms</strong>.</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb657-1" data-line-number="1"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>In applied statistics, the typical way to model a Bernoulli variable is with logistic regression. Instead of going through the pain of setting up a model in <strong>brms</strong> that mirrors the one in the text, I’m going to set up a hierarchical logistic regression model, instead.</p>
<p>Note the <code>family = bernoulli(link = logit)</code> argument. In work-a-day regression with vanilla Gaussian variables, the prediction space is unbounded. But when we want to model the probability of a success for a Bernoulli variable (i.e., <span class="math inline">\(\theta\)</span>), we need to constrain the model to only produce predictions between 0 and 1. With logistic regression, we use a link function to do just that. The consequence is that instead of modeling the probability, <span class="math inline">\(\theta\)</span>, we’re modeling the logit probability.</p>
<p>In case you’re curious, the logit of <span class="math inline">\(\theta\)</span> follows the formula</p>
<p><span class="math display">\[\operatorname{logit} (\theta) = \log \big (\theta/(1 - \theta) \big ).\]</span></p>
<p>But anyway, we’ll be doing logistic regression using the logit link. Kruschke will cover this in detail in Chapter 21.</p>
<p>The next new part of our syntax is <code>(1 | s)</code>. As in the popular frequentist <a href="https://cran.r-project.org/web/packages/lme4/index.html"><strong>lme4</strong> package</a>, you specify random effects or group-level parameters with the <code>(|)</code> syntax in <strong>brms</strong>. On the left side of the <code>|</code>, you tell <strong>brms</strong> what parameters you’d like to make random (i.e., vary by group). On the right side of the <code>|</code>, you tell <strong>brms</strong> what variable you want to group the parameters by. In our case, we want the intercepts to vary over the grouping variable <code>s</code>.</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb658-1" data-line-number="1">fit1 &lt;-</a>
<a class="sourceLine" id="cb658-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb658-3" data-line-number="3">      <span class="dt">family =</span> <span class="kw">bernoulli</span>(<span class="dt">link =</span> logit),</a>
<a class="sourceLine" id="cb658-4" data-line-number="4">      y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>s),</a>
<a class="sourceLine" id="cb658-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb658-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb658-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">20000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">thin =</span> <span class="dv">10</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb658-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">9</span>)</a></code></pre></div>
<p>As it turns out, the <span class="math inline">\(N(0, 1.5)\)</span> prior is flat in the probability space for the intercept in a logistic regression model. We’ll explore that a little further down. The <span class="math inline">\(N(0, 1)\)</span> prior for the random effect is actually a half Normal. That’s because <strong>brms</strong> defaults to bound <span class="math inline">\(SD\)</span> parameters to zero and above. The half Normal prior for a hierarchical <span class="math inline">\(SD\)</span> parameter in a logistic regression model is weakly regularizing and is conservative in the sense that it presumes some pooling is preferable to no pooling. If you wanted to take a lighter approach, you might use something like a <code>cauchy(0, 5)</code>, instead. See the <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">prior wiki</a> by the Stan team for more ideas on priors.</p>
<p>Here are the trace plots and posterior densities of the main parameters.</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb659-1" data-line-number="1"><span class="kw">plot</span>(fit1)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-48-1.png" /><!-- --></p>
<p>The trace plots indicate no problems with convergence. We’ll need to extract the posterior samples and open the <strong>bayesplot</strong> package before we can examine the autocorrelations.</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb660-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(fit1, <span class="dt">add_chain =</span> T)</a>
<a class="sourceLine" id="cb660-2" data-line-number="2"></a>
<a class="sourceLine" id="cb660-3" data-line-number="3"><span class="kw">library</span>(bayesplot)</a></code></pre></div>
<p>One of the nice things about <strong>bayesplot</strong> is it returns <strong>ggplot2</strong> objects. As such, we can amend their theme settings to be consistent with our other <strong>ggplot2</strong> plots. The <code>theme_set()</code> function will make that particularly easy. And since I prefer to plot without gridlines, we’ll slip in a line on <code>panel.grid</code> to suppress them by default for the remainder of this chapter.</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb661-1" data-line-number="1"><span class="kw">theme_set</span>(<span class="kw">theme_grey</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb661-2" data-line-number="2"><span class="st">            </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()))</a></code></pre></div>
<p>Now we’re ready for <code>bayesplot::mcmc_acf()</code>.</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb662-1" data-line-number="1"><span class="kw">mcmc_acf</span>(post, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;sd_s__Intercept&quot;</span>), <span class="dt">lags =</span> <span class="dv">10</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-51-1.png" /><!-- --></p>
<p>It appears <code>fit1</code> had very low autocorrelations. Here we’ll examine the <span class="math inline">\(N_{eff}/N\)</span> ratio.</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb663-1" data-line-number="1"><span class="kw">neff_ratio</span>(fit1) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb663-2" data-line-number="2"><span class="st">  </span><span class="kw">mcmc_neff</span>()</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-52-1.png" /><!-- --></p>
<p>The <span class="math inline">\(N_{eff}/N\)</span> ratio values for our model parameters were excellent. And if you really wanted them, you could get the parameter labels on the y-axis by tacking <code>+ yaxis_text()</code> on at the end of the plot block.</p>
<p>Here’s a numeric summary of the model.</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb664-1" data-line-number="1"><span class="kw">print</span>(fit1)</a></code></pre></div>
<pre><code>##  Family: bernoulli 
##   Links: mu = logit 
## Formula: y ~ 1 + (1 | s) 
##    Data: my_data (Number of observations: 280) 
## Samples: 4 chains, each with iter = 20000; warmup = 1000; thin = 10;
##          total post-warmup samples = 7600
## 
## Group-Level Effects: 
## ~s (Number of levels: 28) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.28      0.18     0.02     0.68 1.00     7438     7638
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.25      0.14    -0.53     0.02 1.00     7237     7507
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We’ll need <code>brms::inv_logit_scaled()</code> to convert the model parameters to predict <span class="math inline">\(\theta\)</span> rather than <span class="math inline">\(\operatorname{logit} (\theta)\)</span>. After the conversions, we’ll be ready to make the histograms in the lower portion of Figure 9.10.</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb666-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a>
<a class="sourceLine" id="cb666-2" data-line-number="2"></a>
<a class="sourceLine" id="cb666-3" data-line-number="3">post_small &lt;-</a>
<a class="sourceLine" id="cb666-4" data-line-number="4"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb666-5" data-line-number="5"><span class="st">  </span><span class="co"># convert the linter model to the probability space with `inv_logit_scaled()`</span></a>
<a class="sourceLine" id="cb666-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">theta[1]</span><span class="st">`</span>  =<span class="st"> </span>(b_Intercept <span class="op">+</span><span class="st"> `</span><span class="dt">r_s[S01,Intercept]</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inv_logit_scaled</span>(),</a>
<a class="sourceLine" id="cb666-7" data-line-number="7">         <span class="st">`</span><span class="dt">theta[14]</span><span class="st">`</span> =<span class="st"> </span>(b_Intercept <span class="op">+</span><span class="st"> `</span><span class="dt">r_s[S14,Intercept]</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inv_logit_scaled</span>(),</a>
<a class="sourceLine" id="cb666-8" data-line-number="8">         <span class="st">`</span><span class="dt">theta[28]</span><span class="st">`</span> =<span class="st"> </span>(b_Intercept <span class="op">+</span><span class="st"> `</span><span class="dt">r_s[S28,Intercept]</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inv_logit_scaled</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb666-9" data-line-number="9"><span class="st">  </span><span class="co"># make the difference distributions</span></a>
<a class="sourceLine" id="cb666-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">theta[1] - theta[14]</span><span class="st">`</span>  =<span class="st"> `</span><span class="dt">theta[1]</span><span class="st">`</span>  <span class="op">-</span><span class="st"> `</span><span class="dt">theta[14]</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb666-11" data-line-number="11">         <span class="st">`</span><span class="dt">theta[1] - theta[28]</span><span class="st">`</span>  =<span class="st"> `</span><span class="dt">theta[1]</span><span class="st">`</span>  <span class="op">-</span><span class="st"> `</span><span class="dt">theta[28]</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb666-12" data-line-number="12">         <span class="st">`</span><span class="dt">theta[14] - theta[28]</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">theta[14]</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">theta[28]</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb666-13" data-line-number="13"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;theta&quot;</span>))</a>
<a class="sourceLine" id="cb666-14" data-line-number="14"></a>
<a class="sourceLine" id="cb666-15" data-line-number="15">post_small <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb666-16" data-line-number="16"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb666-17" data-line-number="17"><span class="st">  </span><span class="co"># this line is unnecessary, but will help order the plots </span></a>
<a class="sourceLine" id="cb666-18" data-line-number="18"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">factor</span>(key, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;theta[1]&quot;</span>, <span class="st">&quot;theta[14]&quot;</span>, <span class="st">&quot;theta[28]&quot;</span>, </a>
<a class="sourceLine" id="cb666-19" data-line-number="19">                                      <span class="st">&quot;theta[1] - theta[14]&quot;</span>, <span class="st">&quot;theta[1] - theta[28]&quot;</span>, <span class="st">&quot;theta[14] - theta[28]&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb666-20" data-line-number="20"></a>
<a class="sourceLine" id="cb666-21" data-line-number="21"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb666-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>,</a>
<a class="sourceLine" id="cb666-23" data-line-number="23">                 <span class="dt">size =</span> <span class="fl">.2</span>, <span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb666-24" data-line-number="24"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb666-25" data-line-number="25">                      <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb666-26" data-line-number="26"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb666-27" data-line-number="27"><span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb666-28" data-line-number="28"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-54-1.png" /><!-- --></p>
<p>If you wanted the specific values of the posterior modes and 95% HDIs, you could execute this.</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb667-1" data-line-number="1">post_small <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb667-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb667-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb667-4" data-line-number="4"><span class="st">  </span><span class="kw">mode_hdi</span>(value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb667-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## Warning: unnest() has a new interface. See ?unnest for details.
## Try `df %&gt;% unnest(c(.lower, .upper))`, with `mutate()` if needed</code></pre>
<pre><code>## # A tibble: 6 x 7
##   key                    value .lower .upper .width .point .interval
##   &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 theta[1]               0.431  0.206  0.521   0.95 mode   hdi      
## 2 theta[1] - theta[14]  -0.003 -0.284  0.117   0.95 mode   hdi      
## 3 theta[1] - theta[28]  -0.01  -0.414  0.068   0.95 mode   hdi      
## 4 theta[14]              0.426  0.282  0.578   0.95 mode   hdi      
## 5 theta[14] - theta[28] -0.004 -0.329  0.105   0.95 mode   hdi      
## 6 theta[28]              0.452  0.357  0.697   0.95 mode   hdi</code></pre>
<p>And here are the Figure 9.10 scatter plots.</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb670-1" data-line-number="1"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb670-2" data-line-number="2"></a>
<a class="sourceLine" id="cb670-3" data-line-number="3">p1 &lt;-</a>
<a class="sourceLine" id="cb670-4" data-line-number="4"><span class="st">  </span>post_small <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb670-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">theta[1]</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">theta[14]</span><span class="st">`</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">linetype =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb670-9" data-line-number="9">                  <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb670-10" data-line-number="10"></a>
<a class="sourceLine" id="cb670-11" data-line-number="11">p2 &lt;-</a>
<a class="sourceLine" id="cb670-12" data-line-number="12"><span class="st">  </span>post_small <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb670-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">theta[1]</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">theta[28]</span><span class="st">`</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">linetype =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb670-17" data-line-number="17">                  <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb670-18" data-line-number="18"></a>
<a class="sourceLine" id="cb670-19" data-line-number="19">p3 &lt;-</a>
<a class="sourceLine" id="cb670-20" data-line-number="20"><span class="st">  </span>post_small <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb670-21" data-line-number="21"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">theta[14]</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">theta[28]</span><span class="st">`</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">linetype =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb670-24" data-line-number="24"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb670-25" data-line-number="25">                  <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb670-26" data-line-number="26"></a>
<a class="sourceLine" id="cb670-27" data-line-number="27"><span class="kw">grid.arrange</span>(p1, p2, p3, <span class="dt">ncol =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-56-1.png" /><!-- --></p>
<p>This is posterior distribution for the population estimate for <span class="math inline">\(\theta\)</span>, which roughly corresponds to the upper right histogram of <span class="math inline">\(\omega\)</span> in Figure 9.10.</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb671-1" data-line-number="1"><span class="co"># this part makes it easier to set the break points in `scale_x_continuous()` </span></a>
<a class="sourceLine" id="cb671-2" data-line-number="2">labels &lt;-</a>
<a class="sourceLine" id="cb671-3" data-line-number="3"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb671-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">theta =</span> b_Intercept <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inv_logit_scaled</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb671-5" data-line-number="5"><span class="st">  </span><span class="kw">mode_hdi</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb671-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(theta<span class="op">:</span>.upper) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb671-7" data-line-number="7"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb671-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> value <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span>as.character) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb671-9" data-line-number="9"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb671-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb671-11" data-line-number="11">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb671-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">theta =</span> b_Intercept <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inv_logit_scaled</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb671-13" data-line-number="13"></a>
<a class="sourceLine" id="cb671-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> theta)) <span class="op">+</span></a>
<a class="sourceLine" id="cb671-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>,</a>
<a class="sourceLine" id="cb671-16" data-line-number="16">                 <span class="dt">size =</span> <span class="fl">.2</span>, <span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb671-17" data-line-number="17"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb671-18" data-line-number="18">                      <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb671-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> labels<span class="op">$</span>value,</a>
<a class="sourceLine" id="cb671-20" data-line-number="20">                     <span class="dt">labels =</span> labels<span class="op">$</span>label) <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb671-21" data-line-number="21"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb671-22" data-line-number="22"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(theta))</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-57-1.png" /><!-- --></p>
<p>I’m not aware there’s a straight conversion to get <span class="math inline">\(\sigma\)</span> in a probability metric. As far as I can tell, you have to first use <code>coef()</code> to “extract [the] model coefficients, which are the sum of population-level effects and corresponding group-level effects” (p. 43 of the <a href="https://cran.r-project.org/web/packages/brms/brms.pdf"><strong>brms</strong> Reference manual, version 2.10.0</a>). With the model coefficient draws in hand, you can index them by posterior iteration, group them by that index, compute the iteration-level <span class="math inline">\(SD\)</span>s, and then plot the distribution of the <span class="math inline">\(SD\)</span>s.</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb672-1" data-line-number="1"><span class="co"># the tibble of the primary data</span></a>
<a class="sourceLine" id="cb672-2" data-line-number="2">sigmas &lt;-</a>
<a class="sourceLine" id="cb672-3" data-line-number="3"><span class="st">  </span><span class="kw">coef</span>(fit1, <span class="dt">summary =</span> F)<span class="op">$</span>s <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-4" data-line-number="4"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-7" data-line-number="7"><span class="st">  </span><span class="kw">gather</span>(key, value, <span class="op">-</span>iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">theta =</span> <span class="kw">inv_logit_scaled</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sd =</span> <span class="kw">sd</span>(theta))</a>
<a class="sourceLine" id="cb672-10" data-line-number="10"></a>
<a class="sourceLine" id="cb672-11" data-line-number="11"><span class="co"># this, again, is just to customize `scale_x_continuous()`</span></a>
<a class="sourceLine" id="cb672-12" data-line-number="12">labels &lt;-</a>
<a class="sourceLine" id="cb672-13" data-line-number="13"><span class="st">  </span>sigmas <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-14" data-line-number="14"><span class="st">  </span><span class="kw">mode_hdi</span>(sd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-15" data-line-number="15"><span class="st">  </span><span class="kw">select</span>(sd<span class="op">:</span>.upper) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-16" data-line-number="16"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> value <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span>as.character) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-18" data-line-number="18"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb672-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb672-20" data-line-number="20"><span class="co"># the plot</span></a>
<a class="sourceLine" id="cb672-21" data-line-number="21">sigmas <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb672-22" data-line-number="22"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> sd)) <span class="op">+</span></a>
<a class="sourceLine" id="cb672-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>,</a>
<a class="sourceLine" id="cb672-24" data-line-number="24">                 <span class="dt">size =</span> <span class="fl">.2</span>, <span class="dt">bins =</span> <span class="dv">30</span>, <span class="dt">boundary =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb672-25" data-line-number="25"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb672-26" data-line-number="26">                      <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb672-27" data-line-number="27"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> labels<span class="op">$</span>value,</a>
<a class="sourceLine" id="cb672-28" data-line-number="28">                     <span class="dt">labels =</span> labels<span class="op">$</span>label) <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb672-29" data-line-number="29"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb672-30" data-line-number="30"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(sigma, <span class="st">&quot; of &quot;</span>, theta, <span class="st">&quot; in a probability metric&quot;</span>)))</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-58-1.png" /><!-- --></p>
<p>And now you have a sense of how to do all those by hand, <code>bayesplot::mcmc_pairs()</code> offers a fairly quick way to get a good portion of Figure 9.10.</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb673-1" data-line-number="1"><span class="kw">color_scheme_set</span>(<span class="st">&quot;gray&quot;</span>)</a>
<a class="sourceLine" id="cb673-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb673-3" data-line-number="3"><span class="kw">coef</span>(fit1, <span class="dt">summary =</span> F)<span class="op">$</span>s <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb673-4" data-line-number="4"><span class="st">  </span><span class="kw">inv_logit_scaled</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb673-5" data-line-number="5"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb673-6" data-line-number="6"><span class="st">  </span><span class="kw">rename</span>(<span class="st">`</span><span class="dt">theta[1]</span><span class="st">`</span> =<span class="st"> </span>S01.Intercept, </a>
<a class="sourceLine" id="cb673-7" data-line-number="7">         <span class="st">`</span><span class="dt">theta[14]</span><span class="st">`</span> =<span class="st"> </span>S14.Intercept, </a>
<a class="sourceLine" id="cb673-8" data-line-number="8">         <span class="st">`</span><span class="dt">theta[28]</span><span class="st">`</span> =<span class="st"> </span>S28.Intercept) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb673-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">theta[1]</span><span class="st">`</span>, <span class="st">`</span><span class="dt">theta[14]</span><span class="st">`</span>, <span class="st">`</span><span class="dt">theta[28]</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb673-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb673-11" data-line-number="11"><span class="st">  </span><span class="kw">mcmc_pairs</span>(<span class="dt">off_diag_args =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>))</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-59-1.png" /><!-- --></p>
<p>Did you see how we slipped in that <code>color_scheme_set(&quot;gray&quot;)</code> line? When we used <code>theme_set()</code>, earlier, that changed the global theme settings for our <strong>ggplot2</strong> plots. The <code>color_scheme_set()</code> function is specific to <strong>bayesplot</strong> plots and it sets the color palette within them. Setting the color palette “gray” changed the colors depicted in the dots and bars of the <code>mcmc_pairs()</code>-based scatter plots and histograms, respectively.</p>
<p>Kruschke used a <span class="math inline">\(\operatorname{Beta} (1, 1)\)</span> prior for <span class="math inline">\(\omega\)</span>. If you randomly draw from that prior and plot a histogram, you’ll see it was flat.</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb674-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb674-2" data-line-number="2"><span class="kw">tibble</span>(<span class="dt">prior =</span> <span class="kw">rbeta</span>(<span class="dt">n =</span> <span class="fl">1e5</span>, <span class="dv">1</span>, <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb674-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb674-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">size =</span> <span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb674-5" data-line-number="5">                 <span class="dt">binwidth =</span> <span class="fl">.05</span>, <span class="dt">boundary =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb674-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.25&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;.75&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb674-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb674-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb674-9" data-line-number="9"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb674-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-60-1.png" /><!-- --></p>
<p>You’ll note that plot corresponds to the upper right panel of Figure 9.11.</p>
<p>Recall that we used a logistic regression model with a <code>normal(0, 1.5)</code> prior on the intercept. If you sample from <code>normal(0, 1.5)</code> and then convert the draws using <code>brms::inv_logit_scaled()</code>, you’ll discover that our <code>normal(0, 1.5)</code> prior was virtually flat on the probability scale. Here we’ll show the consequence of a variety of zero-mean Gaussian priors for the intercept of a logistic regression model:</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb675-1" data-line-number="1"><span class="co"># define a function</span></a>
<a class="sourceLine" id="cb675-2" data-line-number="2">r_norm &lt;-<span class="st"> </span><span class="cf">function</span>(i, <span class="dt">n =</span> <span class="fl">1e4</span>) {</a>
<a class="sourceLine" id="cb675-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb675-4" data-line-number="4">  <span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb675-5" data-line-number="5">  <span class="kw">rnorm</span>(<span class="dt">n =</span> n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> i) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb675-6" data-line-number="6"><span class="st">    </span><span class="kw">inv_logit_scaled</span>()</a>
<a class="sourceLine" id="cb675-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb675-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb675-9" data-line-number="9"></a>
<a class="sourceLine" id="cb675-10" data-line-number="10"><span class="co"># simulate and wrangle</span></a>
<a class="sourceLine" id="cb675-11" data-line-number="11"><span class="kw">tibble</span>(<span class="dt">sd =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.25</span>, <span class="dt">to =</span> <span class="dv">3</span>, <span class="dt">by =</span> <span class="fl">.25</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb675-12" data-line-number="12"><span class="st">  </span><span class="kw">group_by</span>(sd) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb675-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="kw">map</span>(sd, r_norm)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb675-14" data-line-number="14"><span class="st">  </span><span class="kw">unnest</span>(prior) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb675-15" data-line-number="15"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb675-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sd =</span> <span class="kw">str_c</span>(<span class="st">&quot;sd = &quot;</span>, sd)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb675-17" data-line-number="17"><span class="st">  </span></a>
<a class="sourceLine" id="cb675-18" data-line-number="18"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb675-19" data-line-number="19"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb675-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">size =</span> <span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb675-21" data-line-number="21">                 <span class="dt">binwidth =</span> <span class="fl">.05</span>, <span class="dt">boundary =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb675-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.25&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;.75&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb675-23" data-line-number="23"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb675-24" data-line-number="24"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb675-25" data-line-number="25"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>sd)</a></code></pre></div>
<p><img src="09_files/figure-gfm/prior_sim-1.png" /><!-- --></p>
<p>It appears that as <span class="math inline">\(\sigma\)</span> goes lower than 1.25, the prior becomes increasingly regularizing, pulling the estimate for <span class="math inline">\(\theta\)</span> to a neutral .5. However, as the prior’s <span class="math inline">\(\sigma\)</span> gets larger than 1.25, more and more of the probability mass ends up at extreme values.</p>
<p>Next, Kruschke examined the prior distribution. There are a few ways to do this. The one we’ll explore involved adding the <code>sample_prior = &quot;only&quot;</code> argument to the <code>brm()</code> function. When you do so, the results of the model are just the prior. That is, <code>brm()</code> leaves out the likelihood. This returns a bunch of samples from the prior predictive distribution.</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb676-1" data-line-number="1">fit1_prior &lt;-</a>
<a class="sourceLine" id="cb676-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb676-3" data-line-number="3">      <span class="dt">family =</span> <span class="kw">bernoulli</span>(<span class="dt">link =</span> logit),</a>
<a class="sourceLine" id="cb676-4" data-line-number="4">      y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>s),</a>
<a class="sourceLine" id="cb676-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb676-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb676-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">20000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">thin =</span> <span class="dv">10</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb676-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">9</span>,</a>
<a class="sourceLine" id="cb676-9" data-line-number="9">      <span class="dt">sample_prior =</span> <span class="st">&quot;only&quot;</span>)</a></code></pre></div>
<p>If we feed <code>fit1_prior</code> into the <code>posterior_samples()</code> function, we’ll get back a data frame of samples from the prior, but with the same parameter names we’d get from the posterior.</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb677-1" data-line-number="1">prior &lt;-</a>
<a class="sourceLine" id="cb677-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(fit1_prior) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb677-3" data-line-number="3"><span class="st">  </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb677-4" data-line-number="4"></a>
<a class="sourceLine" id="cb677-5" data-line-number="5"><span class="kw">head</span>(prior)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 31
##   b_Intercept sd_s__Intercept `r_s[S01,Interc… `r_s[S02,Interc…
##         &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1      -2.15           1.36            1.18             -0.892 
## 2      -0.825          0.0112         -0.00256          -0.0330
## 3       0.299          0.315          -0.00208          -0.535 
## 4       2.75           0.654           0.0715            0.821 
## 5       0.350          0.352          -0.127             0.0561
## 6      -3.23           0.433          -0.680             0.0825
## # … with 27 more variables: `r_s[S03,Intercept]` &lt;dbl&gt;,
## #   `r_s[S04,Intercept]` &lt;dbl&gt;, `r_s[S05,Intercept]` &lt;dbl&gt;,
## #   `r_s[S06,Intercept]` &lt;dbl&gt;, `r_s[S07,Intercept]` &lt;dbl&gt;,
## #   `r_s[S08,Intercept]` &lt;dbl&gt;, `r_s[S09,Intercept]` &lt;dbl&gt;,
## #   `r_s[S10,Intercept]` &lt;dbl&gt;, `r_s[S11,Intercept]` &lt;dbl&gt;,
## #   `r_s[S12,Intercept]` &lt;dbl&gt;, `r_s[S13,Intercept]` &lt;dbl&gt;,
## #   `r_s[S14,Intercept]` &lt;dbl&gt;, `r_s[S15,Intercept]` &lt;dbl&gt;,
## #   `r_s[S16,Intercept]` &lt;dbl&gt;, `r_s[S17,Intercept]` &lt;dbl&gt;,
## #   `r_s[S18,Intercept]` &lt;dbl&gt;, `r_s[S19,Intercept]` &lt;dbl&gt;,
## #   `r_s[S20,Intercept]` &lt;dbl&gt;, `r_s[S21,Intercept]` &lt;dbl&gt;,
## #   `r_s[S22,Intercept]` &lt;dbl&gt;, `r_s[S23,Intercept]` &lt;dbl&gt;,
## #   `r_s[S24,Intercept]` &lt;dbl&gt;, `r_s[S25,Intercept]` &lt;dbl&gt;,
## #   `r_s[S26,Intercept]` &lt;dbl&gt;, `r_s[S27,Intercept]` &lt;dbl&gt;,
## #   `r_s[S28,Intercept]` &lt;dbl&gt;, lp__ &lt;dbl&gt;</code></pre>
<p>And here we’ll take a subset of the columns in <code>prior</code>, transform the results to the probability metric, and save the results as <code>prior_samples</code>.</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb679-1" data-line-number="1">prior_samples &lt;-</a>
<a class="sourceLine" id="cb679-2" data-line-number="2"><span class="st">  </span>prior <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb679-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">theta[1]</span><span class="st">`</span> =<span class="st"> </span>b_Intercept <span class="op">+</span><span class="st"> `</span><span class="dt">r_s[S01,Intercept]</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb679-4" data-line-number="4">            <span class="st">`</span><span class="dt">theta[14]</span><span class="st">`</span> =<span class="st"> </span>b_Intercept <span class="op">+</span><span class="st"> `</span><span class="dt">r_s[S14,Intercept]</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb679-5" data-line-number="5">            <span class="st">`</span><span class="dt">theta[28]</span><span class="st">`</span> =<span class="st"> </span>b_Intercept <span class="op">+</span><span class="st"> `</span><span class="dt">r_s[S28,Intercept]</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb679-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate_all</span>(<span class="dt">.funs =</span> inv_logit_scaled)</a>
<a class="sourceLine" id="cb679-7" data-line-number="7"></a>
<a class="sourceLine" id="cb679-8" data-line-number="8"><span class="kw">head</span>(prior_samples)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   `theta[1]` `theta[14]` `theta[28]`
##        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1     0.276       0.669       0.0393
## 2     0.304       0.303       0.301 
## 3     0.574       0.527       0.565 
## 4     0.944       0.890       0.788 
## 5     0.556       0.711       0.505 
## 6     0.0197      0.0436      0.0305</code></pre>
<p>Now we can use our <code>prior_samples</code> object to make the diagonal of the lower grid of Figure 9.11.</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb681-1" data-line-number="1">prior_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb681-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb681-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb681-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb681-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">size =</span> <span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb681-6" data-line-number="6">                <span class="dt">binwidth =</span> <span class="fl">.05</span>, <span class="dt">boundary =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb681-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.25&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;.75&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb681-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb681-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb681-10" data-line-number="10"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-63-1.png" /><!-- --></p>
<p>With a little subtraction, we can reproduce the plots in the upper triangle.</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb682-1" data-line-number="1">prior_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb682-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">theta[1] - theta[14]</span><span class="st">`</span>  =<span class="st"> `</span><span class="dt">theta[1]</span><span class="st">`</span>  <span class="op">-</span><span class="st"> `</span><span class="dt">theta[14]</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb682-3" data-line-number="3">         <span class="st">`</span><span class="dt">theta[1] - theta[28]</span><span class="st">`</span>  =<span class="st"> `</span><span class="dt">theta[1]</span><span class="st">`</span>  <span class="op">-</span><span class="st"> `</span><span class="dt">theta[28]</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb682-4" data-line-number="4">         <span class="st">`</span><span class="dt">theta[14] - theta[28]</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">theta[14]</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">theta[28]</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb682-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;] - t&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb682-6" data-line-number="6"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb682-7" data-line-number="7"></a>
<a class="sourceLine" id="cb682-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb682-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">size =</span> <span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb682-10" data-line-number="10">                <span class="dt">binwidth =</span> <span class="fl">.05</span>, <span class="dt">boundary =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb682-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb682-12" data-line-number="12"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-64-1.png" /><!-- --></p>
<p>Those plots clarify our hierarchical logistic regression model was a little more regularizing than Kruschke’s. The consequence of our priors was more aggressive regularization, greater shrinkage toward zero. The prose in the next section of the text clarifies this isn’t necessarily a bad thing.</p>
<p>Finally, here are the plots for the lower triangle in Figure 9.11.</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb683-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb683-2" data-line-number="2"><span class="st">  </span>prior_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb683-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">theta[1]</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">theta[14]</span><span class="st">`</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb683-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb683-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">linetype =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb683-6" data-line-number="6"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb683-7" data-line-number="7">                  <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb683-8" data-line-number="8"></a>
<a class="sourceLine" id="cb683-9" data-line-number="9">p2 &lt;-</a>
<a class="sourceLine" id="cb683-10" data-line-number="10"><span class="st">  </span>prior_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb683-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">theta[1]</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">theta[28]</span><span class="st">`</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb683-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb683-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">linetype =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb683-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb683-15" data-line-number="15">                  <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb683-16" data-line-number="16"></a>
<a class="sourceLine" id="cb683-17" data-line-number="17">p3 &lt;-</a>
<a class="sourceLine" id="cb683-18" data-line-number="18"><span class="st">  </span>prior_samples <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb683-19" data-line-number="19"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">theta[14]</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">theta[28]</span><span class="st">`</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb683-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb683-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">linetype =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb683-22" data-line-number="22"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb683-23" data-line-number="23">                  <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb683-24" data-line-number="24"></a>
<a class="sourceLine" id="cb683-25" data-line-number="25"><span class="kw">grid.arrange</span>(p1, p2, p3, <span class="dt">ncol =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-65-1.png" /><!-- --></p>
<p>In case you were curious, here are the Pearson’s correlation coefficients among the priors.</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb684-1" data-line-number="1"><span class="kw">cor</span>(prior_samples) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##           theta[1] theta[14] theta[28]
## theta[1]      1.00      0.73      0.73
## theta[14]     0.73      1.00      0.72
## theta[28]     0.73      0.72      1.00</code></pre>
</div>
</div>
<div id="shrinkage-in-hierarchical-models" class="section level2">
<h2><span class="header-section-number">9.3</span> Shrinkage in hierarchical models</h2>
<p>“In typical hierarchical models, the estimates of low-level parameters are pulled closer together than they would be if there were not a higher-level distribution. This pulling together is called <em>shrinkage</em> of the estimates” (p. 245, <em>emphasis</em> in the original)</p>
<p>Further,</p>
<blockquote>
<p>shrinkage is a rational implication of hierarchical model structure, and is (usually) desired by the analyst because the shrunken parameter estimates are less affected by random sampling noise than estimates derived without hierarchical structure. Intuitively, shrinkage occurs because the estimate of each low-level parameter is influenced from two sources: (1) the subset of data that are directly dependent on the low-level parameter, and (2) the higher-level parameters on which the low-level parameter depends. The higher- level parameters are affected by all the data, and therefore the estimate of a low-level parameter is affected indirectly by all the data, via their influence on the higher-level parameters. (p. 247)</p>
</blockquote>
<p>Recall Formula 9.4 from page 223,</p>
<p><span class="math display">\[\theta \sim \operatorname{dbeta} (\omega(\kappa - 2) + 1), (1 - \omega)(\kappa - 2) + 1).\]</span></p>
<p>With that formula, we can express <code>dbeta()</code>’s <code>shape1</code> and <code>shape2</code> in terms of <span class="math inline">\(\omega\)</span> and <span class="math inline">\(\kappa\)</span> and make the shapes in Figure 9.12.</p>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb686-1" data-line-number="1">omega  &lt;-<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb686-2" data-line-number="2">kappa1 &lt;-<span class="st"> </span><span class="fl">2.1</span></a>
<a class="sourceLine" id="cb686-3" data-line-number="3">kappa2 &lt;-<span class="st"> </span><span class="fl">15.8</span></a>
<a class="sourceLine" id="cb686-4" data-line-number="4"></a>
<a class="sourceLine" id="cb686-5" data-line-number="5"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.001</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb686-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">kappa = 2.1</span><span class="st">`</span> =<span class="st"> </span><span class="kw">dbeta</span>(<span class="dt">x =</span> x, </a>
<a class="sourceLine" id="cb686-7" data-line-number="7">                               <span class="dt">shape1 =</span> omega <span class="op">*</span><span class="st"> </span>(kappa1 <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb686-8" data-line-number="8">                               <span class="dt">shape2 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>omega) <span class="op">*</span><span class="st"> </span>(kappa1 <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb686-9" data-line-number="9">         <span class="st">`</span><span class="dt">kappa = 15.8</span><span class="st">`</span> =<span class="st"> </span><span class="kw">dbeta</span>(<span class="dt">x =</span> x, </a>
<a class="sourceLine" id="cb686-10" data-line-number="10">                                <span class="dt">shape1 =</span> omega <span class="op">*</span><span class="st"> </span>(kappa2 <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb686-11" data-line-number="11">                                <span class="dt">shape2 =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>omega) <span class="op">*</span><span class="st"> </span>(kappa2 <span class="op">-</span><span class="st"> </span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb686-12" data-line-number="12"><span class="st">  </span><span class="kw">gather</span>(key, value, <span class="op">-</span><span class="st"> </span>x) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb686-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">factor</span>(key, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;kappa = 2.1&quot;</span>, <span class="st">&quot;kappa = 15.8&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb686-14" data-line-number="14"><span class="st">  </span></a>
<a class="sourceLine" id="cb686-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, </a>
<a class="sourceLine" id="cb686-16" data-line-number="16">             <span class="dt">ymin =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb686-17" data-line-number="17">             <span class="dt">ymax =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb686-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb686-19" data-line-number="19"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Data Proportion or &quot;</span>, theta, <span class="st">&quot; value&quot;</span>)),</a>
<a class="sourceLine" id="cb686-20" data-line-number="20">       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;dbeta(&quot;</span>, theta, <span class="st">&quot;|&quot;</span>, omega, <span class="st">&quot;,&quot;</span>, kappa, <span class="st">&quot;)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb686-21" data-line-number="21"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-67-1.png" /><!-- --></p>
</div>
<div id="speeding-up-jags-brms" class="section level2">
<h2><span class="header-section-number">9.4</span> Speeding up <del>JAGS</del> brms</h2>
<p>Here we’ll compare the time it takes to fit <code>fit1</code> as either <code>bernoulli(link = logit)</code> or <code>binomial(link = logit)</code>.</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb687-1" data-line-number="1"><span class="co"># bernoulli</span></a>
<a class="sourceLine" id="cb687-2" data-line-number="2">start_time_bernoulli &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</a>
<a class="sourceLine" id="cb687-3" data-line-number="3"></a>
<a class="sourceLine" id="cb687-4" data-line-number="4"><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb687-5" data-line-number="5">      <span class="dt">family =</span> <span class="kw">bernoulli</span>(<span class="dt">link =</span> logit),</a>
<a class="sourceLine" id="cb687-6" data-line-number="6">      y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>s),</a>
<a class="sourceLine" id="cb687-7" data-line-number="7">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb687-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb687-9" data-line-number="9">      <span class="dt">iter =</span> <span class="dv">20000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">thin =</span> <span class="dv">10</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb687-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb687-11" data-line-number="11"></a>
<a class="sourceLine" id="cb687-12" data-line-number="12">stop_time_bernoulli &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</a>
<a class="sourceLine" id="cb687-13" data-line-number="13"></a>
<a class="sourceLine" id="cb687-14" data-line-number="14"><span class="co"># binomial</span></a>
<a class="sourceLine" id="cb687-15" data-line-number="15">start_time_binomial &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</a>
<a class="sourceLine" id="cb687-16" data-line-number="16"></a>
<a class="sourceLine" id="cb687-17" data-line-number="17"><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb687-18" data-line-number="18">      <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> logit),</a>
<a class="sourceLine" id="cb687-19" data-line-number="19">      y <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>s),</a>
<a class="sourceLine" id="cb687-20" data-line-number="20">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb687-21" data-line-number="21">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb687-22" data-line-number="22">      <span class="dt">iter =</span> <span class="dv">20000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">thin =</span> <span class="dv">10</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb687-23" data-line-number="23">      <span class="dt">seed =</span> <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb687-24" data-line-number="24"></a>
<a class="sourceLine" id="cb687-25" data-line-number="25">stop_time_binomial &lt;-<span class="st"> </span><span class="kw">proc.time</span>()</a></code></pre></div>
<p>See how we’re using <code>proc.time()</code> to record when we began and finished evaluating our <code>brm()</code> code? The last time we covered that was way back in Chapter 3. In Chapter 3 we also learned how subtracting the former from the latter yields the total elapsed time.</p>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb688-1" data-line-number="1">stop_time_bernoulli <span class="op">-</span><span class="st"> </span>start_time_bernoulli</a></code></pre></div>
<pre><code>##    user  system elapsed 
## 107.537   3.358 215.631</code></pre>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb690-1" data-line-number="1">stop_time_binomial <span class="op">-</span><span class="st"> </span>start_time_binomial</a></code></pre></div>
<pre><code>##    user  system elapsed 
## 152.644   3.528 238.123</code></pre>
<p>If you wanted to be rigorous about this, you could do this multiple times in a mini simulation.</p>
<p>As to the issue of parallel processing, we’ve been doing this all along. Note our <code>chains = 4, cores = 4</code> code.</p>
</div>
<div id="extending-the-hierarchy-subjects-within-categories" class="section level2">
<h2><span class="header-section-number">9.5</span> Extending the hierarchy: Subjects within categories</h2>
<blockquote>
<p>Many data structures invite hierarchical descriptions that may have multiple levels. Software such as <del>JAGS</del> [<strong>brms</strong>] makes it easy to implement hierarchical models, and Bayesian inference makes it easy to interpret the parameter estimates, even for complex nonlinear hierarchical models. Here, we take a look at one type of extended hierarchical model. (p. 251)</p>
</blockquote>
<p>Here we depart a little from Kruschke, again. Though we will be fitting a hierarchical model with subjects <span class="math inline">\(s\)</span> within categories <span class="math inline">\(c\)</span>, the higher-level parameters will not be <span class="math inline">\(\omega\)</span> and <span class="math inline">\(\kappa\)</span>. As we’ll go over, below, we will use the binomial distribution within a more conventional hierarchical logistic regression paradigm. In this paradigm, we have an overall intercept, often called <span class="math inline">\(\alpha\)</span> or <span class="math inline">\(\beta_0\)</span>, which will be our analogue to Kruschke’s overall <span class="math inline">\(\omega\)</span>. For the two grouping categories, <span class="math inline">\(s\)</span> and <span class="math inline">\(c\)</span>, we will have <span class="math inline">\(\sigma\)</span> estimates, which express the variability within those grouping. You’ll see when we get there.</p>
<div id="example-baseball-batting-abilities-by-position." class="section level3">
<h3><span class="header-section-number">9.5.1</span> Example: Baseball batting abilities by position.</h3>
<p>Here are the batting average data.</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb692-1" data-line-number="1">my_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data.R/BattingAverage.csv&quot;</span>)</a>
<a class="sourceLine" id="cb692-2" data-line-number="2"></a>
<a class="sourceLine" id="cb692-3" data-line-number="3"><span class="kw">glimpse</span>(my_data)</a></code></pre></div>
<pre><code>## Observations: 948
## Variables: 6
## $ Player       &lt;chr&gt; &quot;Fernando Abad&quot;, &quot;Bobby Abreu&quot;, &quot;Tony Abreu&quot;, &quot;Dust…
## $ PriPos       &lt;chr&gt; &quot;Pitcher&quot;, &quot;Left Field&quot;, &quot;2nd Base&quot;, &quot;2nd Base&quot;, &quot;1…
## $ Hits         &lt;dbl&gt; 1, 53, 18, 137, 21, 0, 0, 2, 150, 167, 0, 128, 66, …
## $ AtBats       &lt;dbl&gt; 7, 219, 70, 607, 86, 1, 1, 20, 549, 576, 1, 525, 27…
## $ PlayerNumber &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, …
## $ PriPosNumber &lt;dbl&gt; 1, 7, 4, 4, 3, 1, 1, 3, 3, 4, 1, 5, 4, 2, 7, 4, 6, …</code></pre>
<p>To give a sense of the data, here are the number of occasions by primary position, <code>PriPos</code>, with their median at bat, <code>AtBats</code>, values.</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb694-1" data-line-number="1">my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb694-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(PriPos) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb694-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n      =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb694-4" data-line-number="4">            <span class="dt">median =</span> <span class="kw">median</span>(AtBats)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb694-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 9 x 3
##   PriPos           n median
##   &lt;chr&gt;        &lt;int&gt;  &lt;dbl&gt;
## 1 Pitcher        324     4 
## 2 Catcher        103   170 
## 3 Left Field     103   164 
## 4 1st Base        81   265 
## 5 3rd Base        75   267 
## 6 2nd Base        72   228.
## 7 Center Field    67   259 
## 8 Shortstop       63   205 
## 9 Right Field     60   340.</code></pre>
<p>As these data are aggregated, we’ll fit with an aggregated binomial model. This is still logistic regression. The Bernoulli distribution is a special case of the binomial distribution when the number of trials in each data point is 1 (see <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_families.html">this vignette</a> for details). Since our data are aggregated, the information encoded in <code>Hits</code> is a combination of multiple trials, which requires us to jump up to the more general binomial likelihood. Note the <code>Hits  | trials(AtBats)</code> syntax. With that bit, we instructed <strong>brms</strong> that our criterion, <code>Hits</code>, is an aggregate of multiple trials and the number of trials is encoded in <code>AtBats</code>.</p>
<p>Also note the <code>(1 | PriPos) + (1 | PriPos:Player)</code> syntax. In this model, we have two grouping factors, <code>PriPos</code> and <code>Player</code>. Thus we have two <code>(|)</code> arguments. But since players are themselves nested within positions, we have encoded that nesting with the <code>(1 | PriPos:Player)</code> syntax. For more on this style of syntax, see <a href="http://rpsychologist.com/r-guide-longitudinal-lme-lmer#different-level-3-variance-covariance-matrix">Kristoffer Magnusson’s handy post</a>. Since <strong>brms</strong> syntax is based on that from the earlier <strong>nlme</strong> and <strong>lme4</strong> packages, the basic syntax rules apply. Bürkner, of course, also covers these topics in the <code>brmsformula</code> subsection of his <a href="https://cran.r-project.org/web/packages/brms/brms.pdf"><strong>brms</strong> reference manual</a>.</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb696-1" data-line-number="1">fit2 &lt;-</a>
<a class="sourceLine" id="cb696-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb696-3" data-line-number="3">      <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> logit),</a>
<a class="sourceLine" id="cb696-4" data-line-number="4">      Hits  <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(AtBats) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>PriPos) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>PriPos<span class="op">:</span>Player),</a>
<a class="sourceLine" id="cb696-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb696-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb696-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">3500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">3</span>, <span class="dt">cores =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb696-8" data-line-number="8">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">.99</span>),</a>
<a class="sourceLine" id="cb696-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">9</span>)</a></code></pre></div>
<p>The chains look good.</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb697-1" data-line-number="1"><span class="kw">color_scheme_set</span>(<span class="st">&quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb697-2" data-line-number="2"></a>
<a class="sourceLine" id="cb697-3" data-line-number="3"><span class="kw">plot</span>(fit2)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-71-1.png" /><!-- --></p>
<p>We might examine the autocorrelations within the chains.</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb698-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(fit2, <span class="dt">add_chain =</span> T)</a>
<a class="sourceLine" id="cb698-2" data-line-number="2"></a>
<a class="sourceLine" id="cb698-3" data-line-number="3"><span class="kw">mcmc_acf</span>(post, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, </a>
<a class="sourceLine" id="cb698-4" data-line-number="4">                        <span class="st">&quot;sd_PriPos__Intercept&quot;</span>, </a>
<a class="sourceLine" id="cb698-5" data-line-number="5">                        <span class="st">&quot;sd_PriPos:Player__Intercept&quot;</span>), <span class="dt">lags =</span> <span class="dv">8</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-72-1.png" /><!-- --></p>
<p>Here’s a histogram of the <span class="math inline">\(N_{eff}/N\)</span> ratios.</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb699-1" data-line-number="1">fit2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb699-2" data-line-number="2"><span class="st">  </span><span class="kw">neff_ratio</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb699-3" data-line-number="3"><span class="st">  </span><span class="kw">mcmc_neff_hist</span>(<span class="dt">binwidth =</span> <span class="fl">.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb699-4" data-line-number="4"><span class="st">  </span><span class="kw">yaxis_text</span>()</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-73-1.png" /><!-- --></p>
<p>Happily, most have a very favorable ratio. Here’s a numeric summary of the primary model parameters.</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb700-1" data-line-number="1"><span class="kw">print</span>(fit2)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: Hits | trials(AtBats) ~ 1 + (1 | PriPos) + (1 | PriPos:Player) 
##    Data: my_data (Number of observations: 948) 
## Samples: 3 chains, each with iter = 3500; warmup = 500; thin = 1;
##          total post-warmup samples = 9000
## 
## Group-Level Effects: 
## ~PriPos (Number of levels: 9) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.32      0.10     0.19     0.59 1.00     2660     4283
## 
## ~PriPos:Player (Number of levels: 948) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.14      0.01     0.12     0.15 1.00     3695     5911
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -1.17      0.11    -1.40    -0.94 1.00     1507     2262
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>As far as I’m aware, <strong>brms</strong> offers three major ways to get the group-level parameters for a hierarchical model: using <code>posterior_samples()</code>, <code>coef()</code>, or <code>fitted()</code>. We’ll cover each, beginning with <code>posterior_samples()</code>. In order to look at the autocorrelation plots, above, we already saved the <code>posterior_samples(fit2)</code> output as <code>post</code>. Here we’ll look at its structure with <code>head()</code>. Before doing so we’ll convert <code>post</code>, which is currently saved as a data frame, into a tibble in order to keep the output from getting unwieldy.</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb702-1" data-line-number="1">post &lt;-</a>
<a class="sourceLine" id="cb702-2" data-line-number="2"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb702-3" data-line-number="3"><span class="st">  </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb702-4" data-line-number="4"></a>
<a class="sourceLine" id="cb702-5" data-line-number="5"><span class="kw">head</span>(post)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 963
##   b_Intercept sd_PriPos__Inte… `sd_PriPos:Play… `r_PriPos[1st.B…
##         &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1       -1.11            0.213            0.145         -0.00504
## 2       -1.13            0.262            0.147          0.101  
## 3       -1.18            0.351            0.149          0.169  
## 4       -1.18            0.279            0.130          0.141  
## 5       -1.16            0.408            0.137          0.0744 
## 6       -1.20            0.344            0.142          0.146  
## # … with 959 more variables: `r_PriPos[2nd.Base,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos[3rd.Base,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos[Catcher,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos[Center.Field,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos[Left.Field,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos[Pitcher,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos[Right.Field,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos[Shortstop,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Adam.Dunn,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Adam.LaRoche,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Adam.Lind,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Adrian.Gonzalez,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Albert.Pujols,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Allen.Craig,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Anthony.Rizzo,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Aubrey.Huff,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Billy.Butler,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Brandon.Allen,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Brandon.Belt,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Brandon.Moss,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Brandon.Snyder,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Brent.Lillibridge,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Brett.Pill,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Brett.Wallace,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Bryan.LaHair,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Carlos.Lee,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Carlos.Pena,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Casey.Kotchman,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Casey.McGehee,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Chad.Tracy,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Chris.Carter,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Chris.Davis,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Chris.Parmelee,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Corey.Hart,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Dan.Johnson,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Daric.Barton,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_David.Cooper,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_David.Ortiz,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Edwin.Encarnacion,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Eric.Hinske,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Eric.Hosmer,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Freddie.Freeman,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Gaby.Sanchez,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Garrett.Jones,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Hector.Luna,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Ike.Davis,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_James.Loney,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Jason.Giambi,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Jeff.Clement,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Jim.Thome,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Joe.Mahoney,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Joey.Votto,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Juan.Rivera,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Justin.Morneau,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Justin.Smoak,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Kendrys.Morales,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Kila.Kaaihue,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Kyle.Blanks,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Lance.Berkman,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Luke.Scott,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Lyle.Overbay,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Mark.Reynolds,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Mark.Teixeira,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Mat.Gamel,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Matt.Adams,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Matt.Carpenter,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Matt.Downs,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Matt.Hague,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Matt.LaPorta,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Mauro.Gomez,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Michael.Young,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Miguel.Cairo,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Mike.Costanzo,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Mike.Jacobs,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Mike.Olt,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Mitch.Moreland,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Nick.Johnson,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Paul.Goldschmidt,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Paul.Konerko,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Prince.Fielder,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Ryan.Howard,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Steven.Hill,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Taylor.Green,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Todd.Helton,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Travis.Ishikawa,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Ty.Wigginton,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Yan.Gomes,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Yonder.Alonso,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[1st.Base_Zach.Lutz,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Aaron.Hill,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Adam.Rosales,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Adrian.Cardenas,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Alexi.Amarista,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Alexi.Casilla,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Blake.DeWitt,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Brandon.Phillips,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Brian.Roberts,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Brock.Holt,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Charlie.Culberson,Intercept]` &lt;dbl&gt;,
## #   `r_PriPos:Player[2nd.Base_Chase.dArnaud,Intercept]` &lt;dbl&gt;, …</code></pre>
<p>In the text, Kruschke described the model as having 968 parameters. Our <code>post</code> tibble has one vector for each, with a couple others tacked onto the end. In the hierarchical logistic regression model, the group-specific parameters for the levels of <code>PriPos</code> are additive combinations of the global intercept vector, <code>b_Intercept</code> and each position-specific vector, <code>r_PriPos[i.Base,Intercept]</code>, where <code>i</code> is a fill-in for the position of interest. And recall that since the linear model is of the logit of the criterion, we’ll need to use <code>inv_logit_scaled()</code> to convert that to the probability space.</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb704-1" data-line-number="1">post_small &lt;-</a>
<a class="sourceLine" id="cb704-2" data-line-number="2"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb704-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">1st Base</span><span class="st">`</span> =<span class="st"> </span>(b_Intercept <span class="op">+</span><span class="st"> `</span><span class="dt">r_PriPos[1st.Base,Intercept]</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb704-4" data-line-number="4">            <span class="dt">Catcher    =</span> (b_Intercept <span class="op">+</span><span class="st"> `</span><span class="dt">r_PriPos[Catcher,Intercept]</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb704-5" data-line-number="5">            <span class="dt">Pitcher    =</span> (b_Intercept <span class="op">+</span><span class="st"> `</span><span class="dt">r_PriPos[Pitcher,Intercept]</span><span class="st">`</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb704-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate_all</span>(inv_logit_scaled) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb704-7" data-line-number="7"><span class="st">  </span><span class="co"># here we compute our difference distributions</span></a>
<a class="sourceLine" id="cb704-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Pitcher - Catcher</span><span class="st">`</span>  =<span class="st"> </span>Pitcher <span class="op">-</span><span class="st"> </span>Catcher,</a>
<a class="sourceLine" id="cb704-9" data-line-number="9">         <span class="st">`</span><span class="dt">Catcher - 1st Base</span><span class="st">`</span> =<span class="st"> </span>Catcher <span class="op">-</span><span class="st"> `</span><span class="dt">1st Base</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb704-10" data-line-number="10"></a>
<a class="sourceLine" id="cb704-11" data-line-number="11"><span class="kw">head</span>(post_small)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   `1st Base` Catcher Pitcher `Pitcher - Catcher` `Catcher - 1st Base`
##        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;               &lt;dbl&gt;                &lt;dbl&gt;
## 1      0.246   0.237   0.135              -0.102             -0.00921
## 2      0.264   0.251   0.134              -0.117             -0.0131 
## 3      0.267   0.242   0.122              -0.120             -0.0256 
## 4      0.262   0.242   0.126              -0.116             -0.0201 
## 5      0.252   0.241   0.133              -0.109             -0.0110 
## 6      0.259   0.243   0.137              -0.106             -0.0161</code></pre>
<p>If you take a glance at Figures 9.14 through 9.16 in the text, we’ll be making a lot of histograms of the same basic structure. To streamline our code a bit, we can make a custom histogram plotting function.</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb706-1" data-line-number="1">make_histogram &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, title, xlim, ...) {</a>
<a class="sourceLine" id="cb706-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb706-3" data-line-number="3">  <span class="kw">ggplot</span>(data, mapping) <span class="op">+</span></a>
<a class="sourceLine" id="cb706-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">size =</span> <span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb706-5" data-line-number="5">                <span class="dt">bins =</span> <span class="dv">30</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb706-6" data-line-number="6"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb706-7" data-line-number="7">                      <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb706-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb706-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> title,</a>
<a class="sourceLine" id="cb706-10" data-line-number="10">       <span class="dt">x     =</span> <span class="kw">expression</span>(theta)) <span class="op">+</span></a>
<a class="sourceLine" id="cb706-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> xlim) <span class="op">+</span></a>
<a class="sourceLine" id="cb706-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb706-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb706-14" data-line-number="14">}</a></code></pre></div>
<p>We’ll do the same thing for the correlation plots.</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb707-1" data-line-number="1">make_point &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, limits, ...) {</a>
<a class="sourceLine" id="cb707-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb707-3" data-line-number="3">  <span class="kw">ggplot</span>(data, mapping) <span class="op">+</span></a>
<a class="sourceLine" id="cb707-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb707-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">20</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb707-6" data-line-number="6"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> limits,</a>
<a class="sourceLine" id="cb707-7" data-line-number="7">                  <span class="dt">ylim =</span> limits)</a>
<a class="sourceLine" id="cb707-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb707-9" data-line-number="9">}</a></code></pre></div>
<p>To learn more about wrapping custom plots into custom functions, check out Chapter 12 of Wickham’s <a href="https://github.com/hadley/ggplot2-book"><em>ggplot2, Elegant graphics for data analysis</em></a>.</p>
<p>Now we have our <code>make_histogram()</code> and <code>make_point()</code> functions, we’ll use <code>grid.arrange()</code> to paste together the left half of Figure 9.14.</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb708-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb708-2" data-line-number="2"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> post_small,</a>
<a class="sourceLine" id="cb708-3" data-line-number="3">                 <span class="kw">aes</span>(<span class="dt">x =</span> Pitcher), </a>
<a class="sourceLine" id="cb708-4" data-line-number="4">                 <span class="dt">title =</span> <span class="st">&quot;Pitcher&quot;</span>, </a>
<a class="sourceLine" id="cb708-5" data-line-number="5">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.25</span>))</a>
<a class="sourceLine" id="cb708-6" data-line-number="6"></a>
<a class="sourceLine" id="cb708-7" data-line-number="7">p2 &lt;-</a>
<a class="sourceLine" id="cb708-8" data-line-number="8"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> post_small,</a>
<a class="sourceLine" id="cb708-9" data-line-number="9">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Pitcher - Catcher</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb708-10" data-line-number="10">                 <span class="dt">title =</span> <span class="st">&quot;Pitcher - Catcher&quot;</span>, </a>
<a class="sourceLine" id="cb708-11" data-line-number="11">                 <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">15</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb708-12" data-line-number="12"></a>
<a class="sourceLine" id="cb708-13" data-line-number="13">p3 &lt;-</a>
<a class="sourceLine" id="cb708-14" data-line-number="14"><span class="st">  </span><span class="kw">make_point</span>(<span class="dt">data =</span> post_small,</a>
<a class="sourceLine" id="cb708-15" data-line-number="15">             <span class="kw">aes</span>(<span class="dt">x =</span> Pitcher, <span class="dt">y =</span> Catcher),</a>
<a class="sourceLine" id="cb708-16" data-line-number="16">             <span class="dt">limits =</span> <span class="kw">c</span>(.<span class="dv">12</span>, <span class="fl">.25</span>))</a>
<a class="sourceLine" id="cb708-17" data-line-number="17"></a>
<a class="sourceLine" id="cb708-18" data-line-number="18">p4 &lt;-</a>
<a class="sourceLine" id="cb708-19" data-line-number="19"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> post_small,</a>
<a class="sourceLine" id="cb708-20" data-line-number="20">                 <span class="kw">aes</span>(<span class="dt">x =</span> Catcher), </a>
<a class="sourceLine" id="cb708-21" data-line-number="21">                 <span class="dt">title =</span> <span class="st">&quot;Catcher&quot;</span>, </a>
<a class="sourceLine" id="cb708-22" data-line-number="22">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">1</span>, <span class="fl">.25</span>))</a>
<a class="sourceLine" id="cb708-23" data-line-number="23"></a>
<a class="sourceLine" id="cb708-24" data-line-number="24"><span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-79-1.png" /><!-- --></p>
<p>We could follow the same procedure to make the right portion of Figure 9.14. But instead, let’s switch gears and explore the second way <strong>brms</strong> affords us for plotting group-level parameters. This time, we’ll use <code>coef()</code>.</p>
<p>Up in section 9.2.4, we learned that we can use <code>coef()</code> to “extract [the] model coefficients, which are the sum of population-level effects and corresponding group-level effects” (p. 43 of the <a href="https://cran.r-project.org/web/packages/brms/brms.pdf"><strong>brms</strong> reference manual</a>). The grouping level we’re interested in is <code>PriPos</code>, so we’ll use that to index the information returned by <code>coef()</code>. Since <code>coef()</code> returns a matrix, we’ll use <code>as_tibble()</code> to convert it to a tibble.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb709-1" data-line-number="1">coef_primary_position &lt;-</a>
<a class="sourceLine" id="cb709-2" data-line-number="2"><span class="st">  </span><span class="kw">coef</span>(fit2, <span class="dt">summary =</span> F)<span class="op">$</span>PriPos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb709-3" data-line-number="3"><span class="st">  </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb709-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb709-5" data-line-number="5"><span class="kw">str</span>(coef_primary_position)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    9000 obs. of  9 variables:
##  $ 1st Base.Intercept    : num  -1.12 -1.03 -1.01 -1.04 -1.09 ...
##  $ 2nd Base.Intercept    : num  -1.059 -1.072 -1.067 -0.997 -1.169 ...
##  $ 3rd Base.Intercept    : num  -1.01 -1.05 -1.04 -1.06 -1.07 ...
##  $ Catcher.Intercept     : num  -1.17 -1.09 -1.14 -1.14 -1.15 ...
##  $ Center Field.Intercept: num  -1.05 -1.07 -1.06 -1.06 -1.03 ...
##  $ Left Field.Intercept  : num  -1.08 -1.11 -1.06 -1.06 -1.12 ...
##  $ Pitcher.Intercept     : num  -1.86 -1.87 -1.97 -1.94 -1.88 ...
##  $ Right Field.Intercept : num  -1.03 -1.05 -1.08 -1.09 -1.01 ...
##  $ Shortstop.Intercept   : num  -1.16 -1.1 -1.14 -1.1 -1.12 ...</code></pre>
<p>Keep in mind that <code>coef()</code> returns the values in the logit scale when used for logistic regression models. So we’ll have to use <code>brms::inv_logit_scaled()</code> to convert the estimates to the probability metric. After we’re done converting the estimates, we’ll then make the difference distributions.</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb711-1" data-line-number="1">coef_small &lt;-</a>
<a class="sourceLine" id="cb711-2" data-line-number="2"><span class="st">  </span>coef_primary_position <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb711-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">1st Base.Intercept</span><span class="st">`</span>, Catcher.Intercept, Pitcher.Intercept) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb711-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">1st Base</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">1st Base.Intercept</span><span class="st">`</span>, </a>
<a class="sourceLine" id="cb711-5" data-line-number="5">            <span class="dt">Catcher    =</span> Catcher.Intercept, </a>
<a class="sourceLine" id="cb711-6" data-line-number="6">            <span class="dt">Pitcher    =</span> Pitcher.Intercept) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb711-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate_all</span>(inv_logit_scaled) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb711-8" data-line-number="8"><span class="st">  </span><span class="co"># here we make the difference distributions</span></a>
<a class="sourceLine" id="cb711-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Pitcher - Catcher</span><span class="st">`</span>  =<span class="st"> </span>Pitcher <span class="op">-</span><span class="st"> </span>Catcher,</a>
<a class="sourceLine" id="cb711-10" data-line-number="10">         <span class="st">`</span><span class="dt">Catcher - 1st Base</span><span class="st">`</span> =<span class="st"> </span>Catcher <span class="op">-</span><span class="st"> `</span><span class="dt">1st Base</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb711-11" data-line-number="11"></a>
<a class="sourceLine" id="cb711-12" data-line-number="12"><span class="kw">head</span>(coef_small)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   `1st Base` Catcher Pitcher `Pitcher - Catcher` `Catcher - 1st Base`
##        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;               &lt;dbl&gt;                &lt;dbl&gt;
## 1      0.246   0.237   0.135              -0.102             -0.00921
## 2      0.264   0.251   0.134              -0.117             -0.0131 
## 3      0.267   0.242   0.122              -0.120             -0.0256 
## 4      0.262   0.242   0.126              -0.116             -0.0201 
## 5      0.252   0.241   0.133              -0.109             -0.0110 
## 6      0.259   0.243   0.137              -0.106             -0.0161</code></pre>
<p>Now we’re ready for the right half of Figure 9.14.</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb713-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb713-2" data-line-number="2"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> coef_small,</a>
<a class="sourceLine" id="cb713-3" data-line-number="3">                 <span class="kw">aes</span>(<span class="dt">x =</span> Catcher), </a>
<a class="sourceLine" id="cb713-4" data-line-number="4">                 <span class="dt">title =</span> <span class="st">&quot;Catcher&quot;</span>, </a>
<a class="sourceLine" id="cb713-5" data-line-number="5">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">22</span>, <span class="fl">.27</span>))</a>
<a class="sourceLine" id="cb713-6" data-line-number="6"></a>
<a class="sourceLine" id="cb713-7" data-line-number="7">p2 &lt;-</a>
<a class="sourceLine" id="cb713-8" data-line-number="8"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> coef_small,</a>
<a class="sourceLine" id="cb713-9" data-line-number="9">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Catcher - 1st Base</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb713-10" data-line-number="10">                 <span class="dt">title =</span> <span class="st">&quot;Catcher - 1st Base&quot;</span>, </a>
<a class="sourceLine" id="cb713-11" data-line-number="11">                 <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">04</span>, <span class="fl">.01</span>))</a>
<a class="sourceLine" id="cb713-12" data-line-number="12"></a>
<a class="sourceLine" id="cb713-13" data-line-number="13">p3 &lt;-</a>
<a class="sourceLine" id="cb713-14" data-line-number="14"><span class="st">  </span><span class="kw">make_point</span>(<span class="dt">data =</span> coef_small,</a>
<a class="sourceLine" id="cb713-15" data-line-number="15">             <span class="kw">aes</span>(<span class="dt">x =</span> Catcher, <span class="dt">y =</span> <span class="st">`</span><span class="dt">1st Base</span><span class="st">`</span>),</a>
<a class="sourceLine" id="cb713-16" data-line-number="16">             <span class="dt">limits =</span> <span class="kw">c</span>(.<span class="dv">22</span>, <span class="fl">.27</span>))</a>
<a class="sourceLine" id="cb713-17" data-line-number="17"></a>
<a class="sourceLine" id="cb713-18" data-line-number="18">p4 &lt;-</a>
<a class="sourceLine" id="cb713-19" data-line-number="19"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> coef_small,</a>
<a class="sourceLine" id="cb713-20" data-line-number="20">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">1st Base</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb713-21" data-line-number="21">                 <span class="dt">title =</span> <span class="st">&quot;1st Base&quot;</span>, </a>
<a class="sourceLine" id="cb713-22" data-line-number="22">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">22</span>, <span class="fl">.27</span>))</a>
<a class="sourceLine" id="cb713-23" data-line-number="23"></a>
<a class="sourceLine" id="cb713-24" data-line-number="24"><span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-82-1.png" /><!-- --></p>
<p>And if you wanted the posterior modes and HDIs, you’d use <code>mode_hdi()</code> after a little wrangling.</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb714-1" data-line-number="1">coef_small <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb714-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb714-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb714-4" data-line-number="4"><span class="st">  </span><span class="kw">mode_hdi</span>(value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb714-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   key                 value .lower .upper .width .point .interval
##   &lt;chr&gt;               &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 1st Base            0.252  0.245  0.263   0.95 mode   hdi      
## 2 Catcher             0.241  0.233  0.25    0.95 mode   hdi      
## 3 Catcher - 1st Base -0.013 -0.024 -0.001   0.95 mode   hdi      
## 4 Pitcher             0.13   0.12   0.14    0.95 mode   hdi      
## 5 Pitcher - Catcher  -0.111 -0.124 -0.098   0.95 mode   hdi</code></pre>
<p>While we’re at it, we should capitalize on the opportunity to show how these results are the same as those derived from our <code>posterior_samples()</code> approach, above.</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb716-1" data-line-number="1">post_small <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb716-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb716-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb716-4" data-line-number="4"><span class="st">  </span><span class="kw">mode_hdi</span>(value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb716-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   key                 value .lower .upper .width .point .interval
##   &lt;chr&gt;               &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 1st Base            0.252  0.245  0.263   0.95 mode   hdi      
## 2 Catcher             0.241  0.233  0.25    0.95 mode   hdi      
## 3 Catcher - 1st Base -0.013 -0.024 -0.001   0.95 mode   hdi      
## 4 Pitcher             0.13   0.12   0.14    0.95 mode   hdi      
## 5 Pitcher - Catcher  -0.111 -0.124 -0.098   0.95 mode   hdi</code></pre>
<p>Success!</p>
<p>For Figures 9.15 and 9.16, Kruschke drilled down further into the posterior. To drill along with him, we’ll take the opportunity to showcase <code>fitted()</code>, the third way <strong>brms</strong> affords us for plotting group-level parameters.</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb718-1" data-line-number="1"><span class="co"># this will make life easier. just go with it</span></a>
<a class="sourceLine" id="cb718-2" data-line-number="2">name_list &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Kyle Blanks&quot;</span>, <span class="st">&quot;Bruce Chen&quot;</span>, <span class="st">&quot;ShinSoo Choo&quot;</span>, <span class="st">&quot;Ichiro Suzuki&quot;</span>, </a>
<a class="sourceLine" id="cb718-3" data-line-number="3">               <span class="st">&quot;Mike Leake&quot;</span>, <span class="st">&quot;Wandy Rodriguez&quot;</span>, <span class="st">&quot;Andrew McCutchen&quot;</span>, <span class="st">&quot;Brett Jackson&quot;</span>)</a>
<a class="sourceLine" id="cb718-4" data-line-number="4"></a>
<a class="sourceLine" id="cb718-5" data-line-number="5"><span class="co"># we&#39;ll define the data we&#39;d like to feed into `fitted()`, here</span></a>
<a class="sourceLine" id="cb718-6" data-line-number="6">nd &lt;-</a>
<a class="sourceLine" id="cb718-7" data-line-number="7"><span class="st">  </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb718-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(Player <span class="op">%in%</span><span class="st"> </span>name_list) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb718-9" data-line-number="9"><span class="st">  </span><span class="co"># these last two lines aren&#39;t typically necessary, </span></a>
<a class="sourceLine" id="cb718-10" data-line-number="10"><span class="st">  </span><span class="co"># but they allow us to arrange the rows in the same order we find the names in Figures 9.15 and 9.16</span></a>
<a class="sourceLine" id="cb718-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Player =</span> <span class="kw">factor</span>(Player, <span class="dt">levels =</span> name_list)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb718-12" data-line-number="12"><span class="st">  </span><span class="kw">arrange</span>(Player)</a>
<a class="sourceLine" id="cb718-13" data-line-number="13"></a>
<a class="sourceLine" id="cb718-14" data-line-number="14">fitted_players &lt;-</a>
<a class="sourceLine" id="cb718-15" data-line-number="15"><span class="st">  </span><span class="kw">fitted</span>(fit2, </a>
<a class="sourceLine" id="cb718-16" data-line-number="16">       <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb718-17" data-line-number="17">       <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>,</a>
<a class="sourceLine" id="cb718-18" data-line-number="18">       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb718-19" data-line-number="19"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb718-20" data-line-number="20"><span class="st">  </span><span class="co"># rename the values as returned by `as_tibble()`</span></a>
<a class="sourceLine" id="cb718-21" data-line-number="21"><span class="st">  </span><span class="kw">set_names</span>(name_list) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb718-22" data-line-number="22"><span class="st">  </span><span class="co"># convert the values from the logit scale to the probability scale</span></a>
<a class="sourceLine" id="cb718-23" data-line-number="23"><span class="st">  </span><span class="kw">mutate_all</span>(inv_logit_scaled) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb718-24" data-line-number="24"><span class="st">  </span><span class="co"># in this last section, we make our difference distributions </span></a>
<a class="sourceLine" id="cb718-25" data-line-number="25"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Kyle Blanks - Bruce Chen</span><span class="st">`</span>         =<span class="st"> `</span><span class="dt">Kyle Blanks</span><span class="st">`</span>      <span class="op">-</span><span class="st"> `</span><span class="dt">Bruce Chen</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb718-26" data-line-number="26">         <span class="st">`</span><span class="dt">ShinSoo Choo - Ichiro Suzuki</span><span class="st">`</span>     =<span class="st"> `</span><span class="dt">ShinSoo Choo</span><span class="st">`</span>     <span class="op">-</span><span class="st"> `</span><span class="dt">Ichiro Suzuki</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb718-27" data-line-number="27">         <span class="st">`</span><span class="dt">Mike Leake - Wandy Rodriguez</span><span class="st">`</span>     =<span class="st"> `</span><span class="dt">Mike Leake</span><span class="st">`</span>       <span class="op">-</span><span class="st"> `</span><span class="dt">Wandy Rodriguez</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb718-28" data-line-number="28">         <span class="st">`</span><span class="dt">Andrew McCutchen - Brett Jackson</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">Andrew McCutchen</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">Brett Jackson</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb718-29" data-line-number="29">    </a>
<a class="sourceLine" id="cb718-30" data-line-number="30"><span class="kw">glimpse</span>(fitted_players)</a></code></pre></div>
<pre><code>## Observations: 9,000
## Variables: 12
## $ `Kyle Blanks`                      &lt;dbl&gt; 0.2884479, 0.2444058, 0.30454…
## $ `Bruce Chen`                       &lt;dbl&gt; 0.1259121, 0.1468900, 0.11606…
## $ `ShinSoo Choo`                     &lt;dbl&gt; 0.2836534, 0.3041822, 0.26613…
## $ `Ichiro Suzuki`                    &lt;dbl&gt; 0.2631869, 0.2891847, 0.29991…
## $ `Mike Leake`                       &lt;dbl&gt; 0.1328278, 0.1611607, 0.17744…
## $ `Wandy Rodriguez`                  &lt;dbl&gt; 0.11374696, 0.12650915, 0.118…
## $ `Andrew McCutchen`                 &lt;dbl&gt; 0.3136231, 0.3139831, 0.29643…
## $ `Brett Jackson`                    &lt;dbl&gt; 0.2840384, 0.2368827, 0.20780…
## $ `Kyle Blanks - Bruce Chen`         &lt;dbl&gt; 0.16253577, 0.09751580, 0.188…
## $ `ShinSoo Choo - Ichiro Suzuki`     &lt;dbl&gt; 0.020466515, 0.014997563, -0.…
## $ `Mike Leake - Wandy Rodriguez`     &lt;dbl&gt; 0.019080819, 0.034651509, 0.0…
## $ `Andrew McCutchen - Brett Jackson` &lt;dbl&gt; 0.02958472, 0.07710036, 0.088…</code></pre>
<p>Note our use of the <code>scale = &quot;linear&quot;</code> argument in the <code>fitted()</code> function. By default, <code>fitted()</code> returns predictions on the scale of the criterion. But we don’t want a list of successes and failures; we want player-level parameters. When you specify <code>scale = &quot;linear&quot;</code>, you request <code>fitted()</code> return the values in the parameter scale.</p>
<p>Here’s the left portion of Figure 9.15.</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb720-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb720-2" data-line-number="2"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb720-3" data-line-number="3">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Kyle Blanks</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb720-4" data-line-number="4">                 <span class="dt">title =</span> <span class="st">&quot;Kyle Blanks (1st Base)&quot;</span>, </a>
<a class="sourceLine" id="cb720-5" data-line-number="5">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.35</span>))</a>
<a class="sourceLine" id="cb720-6" data-line-number="6"></a>
<a class="sourceLine" id="cb720-7" data-line-number="7">p2 &lt;-</a>
<a class="sourceLine" id="cb720-8" data-line-number="8"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb720-9" data-line-number="9">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Kyle Blanks - Bruce Chen</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb720-10" data-line-number="10">                 <span class="dt">title =</span> <span class="st">&quot;Kyle Blanks (1st Base) -</span><span class="ch">\n</span><span class="st">Bruce Chen (Pitcher)&quot;</span>, </a>
<a class="sourceLine" id="cb720-11" data-line-number="11">                 <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">1</span>, <span class="fl">.25</span>))</a>
<a class="sourceLine" id="cb720-12" data-line-number="12"></a>
<a class="sourceLine" id="cb720-13" data-line-number="13">p3 &lt;-</a>
<a class="sourceLine" id="cb720-14" data-line-number="14"><span class="st">  </span><span class="kw">make_point</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb720-15" data-line-number="15">             <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Kyle Blanks</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Bruce Chen</span><span class="st">`</span>),</a>
<a class="sourceLine" id="cb720-16" data-line-number="16">             <span class="dt">limits =</span> <span class="kw">c</span>(.<span class="dv">09</span>, <span class="fl">.35</span>))</a>
<a class="sourceLine" id="cb720-17" data-line-number="17"></a>
<a class="sourceLine" id="cb720-18" data-line-number="18">p4 &lt;-</a>
<a class="sourceLine" id="cb720-19" data-line-number="19"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb720-20" data-line-number="20">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Bruce Chen</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb720-21" data-line-number="21">                 <span class="dt">title =</span> <span class="st">&quot;Bruce Chen (Pitcher)&quot;</span>, </a>
<a class="sourceLine" id="cb720-22" data-line-number="22">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.35</span>))</a>
<a class="sourceLine" id="cb720-23" data-line-number="23"></a>
<a class="sourceLine" id="cb720-24" data-line-number="24"><span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-86-1.png" /><!-- --></p>
<p>Figure 9.15, right:</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb721-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb721-2" data-line-number="2"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb721-3" data-line-number="3">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">ShinSoo Choo</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb721-4" data-line-number="4">                 <span class="dt">title =</span> <span class="st">&quot;ShinSoo Choo (Right Field)&quot;</span>, </a>
<a class="sourceLine" id="cb721-5" data-line-number="5">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">22</span>, <span class="fl">.34</span>))</a>
<a class="sourceLine" id="cb721-6" data-line-number="6"></a>
<a class="sourceLine" id="cb721-7" data-line-number="7">p2 &lt;-</a>
<a class="sourceLine" id="cb721-8" data-line-number="8"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb721-9" data-line-number="9">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">ShinSoo Choo - Ichiro Suzuki</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb721-10" data-line-number="10">                 <span class="dt">title =</span> <span class="st">&quot;ShinSoo Choo (Right Field) -</span><span class="ch">\n</span><span class="st">Ichiro Suzuki (Right Field)&quot;</span>, </a>
<a class="sourceLine" id="cb721-11" data-line-number="11">                 <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">07</span>, <span class="fl">.07</span>))</a>
<a class="sourceLine" id="cb721-12" data-line-number="12"></a>
<a class="sourceLine" id="cb721-13" data-line-number="13">p3 &lt;-</a>
<a class="sourceLine" id="cb721-14" data-line-number="14"><span class="st">  </span><span class="kw">make_point</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb721-15" data-line-number="15">             <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">ShinSoo Choo</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Ichiro Suzuki</span><span class="st">`</span>),</a>
<a class="sourceLine" id="cb721-16" data-line-number="16">             <span class="dt">limits =</span> <span class="kw">c</span>(.<span class="dv">23</span>, <span class="fl">.32</span>))</a>
<a class="sourceLine" id="cb721-17" data-line-number="17"></a>
<a class="sourceLine" id="cb721-18" data-line-number="18">p4 &lt;-</a>
<a class="sourceLine" id="cb721-19" data-line-number="19"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb721-20" data-line-number="20">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Ichiro Suzuki</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb721-21" data-line-number="21">                 <span class="dt">title =</span> <span class="st">&quot;Ichiro Suzuki (Right Field)&quot;</span>, </a>
<a class="sourceLine" id="cb721-22" data-line-number="22">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">22</span>, <span class="fl">.34</span>))</a>
<a class="sourceLine" id="cb721-23" data-line-number="23"></a>
<a class="sourceLine" id="cb721-24" data-line-number="24"><span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-87-1.png" /><!-- --></p>
<p>Figure 9.16, left:</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb722-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb722-2" data-line-number="2"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb722-3" data-line-number="3">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Mike Leake</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb722-4" data-line-number="4">                 <span class="dt">title =</span> <span class="st">&quot;Mike Leake (Pitcher)&quot;</span>, </a>
<a class="sourceLine" id="cb722-5" data-line-number="5">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.35</span>))</a>
<a class="sourceLine" id="cb722-6" data-line-number="6"></a>
<a class="sourceLine" id="cb722-7" data-line-number="7">p2 &lt;-</a>
<a class="sourceLine" id="cb722-8" data-line-number="8"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb722-9" data-line-number="9">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Mike Leake - Wandy Rodriguez</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb722-10" data-line-number="10">                 <span class="dt">title =</span> <span class="st">&quot;Mike Leake (Pitcher) -</span><span class="ch">\n</span><span class="st">Wandy Rodriguez (Pitcher)&quot;</span>, </a>
<a class="sourceLine" id="cb722-11" data-line-number="11">                 <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">05</span>, <span class="fl">.25</span>))</a>
<a class="sourceLine" id="cb722-12" data-line-number="12"></a>
<a class="sourceLine" id="cb722-13" data-line-number="13">p3 &lt;-</a>
<a class="sourceLine" id="cb722-14" data-line-number="14"><span class="st">  </span><span class="kw">make_point</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb722-15" data-line-number="15">             <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Mike Leake</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Wandy Rodriguez</span><span class="st">`</span>),</a>
<a class="sourceLine" id="cb722-16" data-line-number="16">             <span class="dt">limits =</span> <span class="kw">c</span>(.<span class="dv">07</span>, <span class="fl">.25</span>))</a>
<a class="sourceLine" id="cb722-17" data-line-number="17"></a>
<a class="sourceLine" id="cb722-18" data-line-number="18">p4 &lt;-</a>
<a class="sourceLine" id="cb722-19" data-line-number="19"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb722-20" data-line-number="20">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Wandy Rodriguez</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb722-21" data-line-number="21">                 <span class="dt">title =</span> <span class="st">&quot;Wandy Rodriguez (Pitcher)&quot;</span>, </a>
<a class="sourceLine" id="cb722-22" data-line-number="22">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.35</span>))</a>
<a class="sourceLine" id="cb722-23" data-line-number="23"></a>
<a class="sourceLine" id="cb722-24" data-line-number="24"><span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-88-1.png" /><!-- --></p>
<p>Figure 9.16, right:</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb723-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb723-2" data-line-number="2"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb723-3" data-line-number="3">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Andrew McCutchen</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb723-4" data-line-number="4">                 <span class="dt">title =</span> <span class="st">&quot;Andrew McCutchen (Center Field)&quot;</span>, </a>
<a class="sourceLine" id="cb723-5" data-line-number="5">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">15</span>, <span class="fl">.35</span>))</a>
<a class="sourceLine" id="cb723-6" data-line-number="6"></a>
<a class="sourceLine" id="cb723-7" data-line-number="7">p2 &lt;-</a>
<a class="sourceLine" id="cb723-8" data-line-number="8"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb723-9" data-line-number="9">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Andrew McCutchen - Brett Jackson</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb723-10" data-line-number="10">                 <span class="dt">title =</span> <span class="st">&quot;Andrew McCutchen (Center Field) -</span><span class="ch">\n</span><span class="st">Brett Jackson (Center Field)&quot;</span>, </a>
<a class="sourceLine" id="cb723-11" data-line-number="11">                 <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.20</span>))</a>
<a class="sourceLine" id="cb723-12" data-line-number="12"></a>
<a class="sourceLine" id="cb723-13" data-line-number="13">p3 &lt;-</a>
<a class="sourceLine" id="cb723-14" data-line-number="14"><span class="st">  </span><span class="kw">make_point</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb723-15" data-line-number="15">             <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Andrew McCutchen</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Brett Jackson</span><span class="st">`</span>),</a>
<a class="sourceLine" id="cb723-16" data-line-number="16">             <span class="dt">limits =</span> <span class="kw">c</span>(.<span class="dv">15</span>, <span class="fl">.35</span>))</a>
<a class="sourceLine" id="cb723-17" data-line-number="17"></a>
<a class="sourceLine" id="cb723-18" data-line-number="18">p4 &lt;-</a>
<a class="sourceLine" id="cb723-19" data-line-number="19"><span class="st">  </span><span class="kw">make_histogram</span>(<span class="dt">data =</span> fitted_players,</a>
<a class="sourceLine" id="cb723-20" data-line-number="20">                 <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Brett Jackson</span><span class="st">`</span>), </a>
<a class="sourceLine" id="cb723-21" data-line-number="21">                 <span class="dt">title =</span> <span class="st">&quot;Brett Jackson (Center Field)&quot;</span>, </a>
<a class="sourceLine" id="cb723-22" data-line-number="22">                 <span class="dt">xlim =</span> <span class="kw">c</span>(.<span class="dv">15</span>, <span class="fl">.35</span>))</a>
<a class="sourceLine" id="cb723-23" data-line-number="23"></a>
<a class="sourceLine" id="cb723-24" data-line-number="24"><span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="09_files/figure-gfm/unnamed-chunk-89-1.png" /><!-- --></p>
<p>And if you wanted the posterior modes and HDIs, you’d use <code>mode_hdi()</code> after a little wrangling.</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb724-1" data-line-number="1">fitted_players <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb724-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb724-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb724-4" data-line-number="4"><span class="st">  </span><span class="kw">mode_hdi</span>(value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb724-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 12 x 7
##    key                          value .lower .upper .width .point .interval
##    &lt;chr&gt;                        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
##  1 Andrew McCutchen             0.307  0.275  0.336   0.95 mode   hdi      
##  2 Andrew McCutchen - Brett Ja… 0.074  0.019  0.12    0.95 mode   hdi      
##  3 Brett Jackson                0.233  0.195  0.277   0.95 mode   hdi      
##  4 Bruce Chen                   0.129  0.099  0.164   0.95 mode   hdi      
##  5 Ichiro Suzuki                0.275  0.246  0.306   0.95 mode   hdi      
##  6 Kyle Blanks                  0.25   0.202  0.303   0.95 mode   hdi      
##  7 Kyle Blanks - Bruce Chen     0.117  0.059  0.179   0.95 mode   hdi      
##  8 Mike Leake                   0.148  0.118  0.184   0.95 mode   hdi      
##  9 Mike Leake - Wandy Rodriguez 0.028 -0.015  0.069   0.95 mode   hdi      
## 10 ShinSoo Choo                 0.275  0.244  0.304   0.95 mode   hdi      
## 11 ShinSoo Choo - Ichiro Suzuki 0     -0.042  0.043   0.95 mode   hdi      
## 12 Wandy Rodriguez              0.119  0.096  0.152   0.95 mode   hdi</code></pre>
<blockquote>
<p>Finally, we have only looked at a tiny fraction of the relations among the 968 parameters. We could investigate many more comparisons among parameters if we were specifically interested. In traditional statistical testing based on <span class="math inline">\(p\)</span>-values (which will be discussed in Chapter 11), we would pay a penalty for even intending to make more comparisons. This is because a <span class="math inline">\(p\)</span> value depends on the space of counter-factual possibilities created from the testing intentions. In a Bayesian analysis, however, decisions are based on the posterior distribution, which is based only on the data (and the prior), not on the testing intention. More discussion of multiple comparisons can be found in Section 11.4. (pp. 259–260)</p>
</blockquote>
</div>
</div>
<div id="reference-8" class="section level2 unnumbered">
<h2>Reference</h2>
<p><a href="https://sites.google.com/site/doingbayesiandataanalysis/">Kruschke, J. K. (2015). <em>Doing Bayesian data analysis, Second Edition: A tutorial with R, JAGS, and Stan.</em> Burlington, MA: Academic Press/Elsevier.</a></p>
</div>
<div id="session-info-8" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb726-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.0 (2019-04-26)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] gridExtra_2.3   tidybayes_1.1.0 bayesplot_1.7.0 brms_2.10.3    
##  [5] Rcpp_1.0.2      ggridges_0.5.1  forcats_0.4.0   stringr_1.4.0  
##  [9] dplyr_0.8.3     purrr_0.3.2     readr_1.3.1     tidyr_1.0.0    
## [13] tibble_2.1.3    ggplot2_3.2.1   tidyverse_1.2.1
## 
## loaded via a namespace (and not attached):
##  [1] colorspace_1.4-1          ellipsis_0.3.0           
##  [3] rsconnect_0.8.15          ggstance_0.3.2           
##  [5] markdown_1.1              base64enc_0.1-3          
##  [7] rstudioapi_0.10           rstan_2.19.2             
##  [9] svUnit_0.7-12             DT_0.9                   
## [11] fansi_0.4.0               lubridate_1.7.4          
## [13] xml2_1.2.0                bridgesampling_0.7-2     
## [15] knitr_1.23                shinythemes_1.1.2        
## [17] zeallot_0.1.0             jsonlite_1.6             
## [19] broom_0.5.2               shiny_1.3.2              
## [21] compiler_3.6.0            httr_1.4.0               
## [23] backports_1.1.5           assertthat_0.2.1         
## [25] Matrix_1.2-17             lazyeval_0.2.2           
## [27] cli_1.1.0                 later_1.0.0              
## [29] htmltools_0.4.0           prettyunits_1.0.2        
## [31] tools_3.6.0               igraph_1.2.4.1           
## [33] coda_0.19-3               gtable_0.3.0             
## [35] glue_1.3.1                reshape2_1.4.3           
## [37] cellranger_1.1.0          vctrs_0.2.0              
## [39] nlme_3.1-139              crosstalk_1.0.0          
## [41] xfun_0.10                 ps_1.3.0                 
## [43] rvest_0.3.4               mime_0.7                 
## [45] miniUI_0.1.1.1            lifecycle_0.1.0          
## [47] gtools_3.8.1              zoo_1.8-6                
## [49] scales_1.0.0              colourpicker_1.0         
## [51] hms_0.4.2                 promises_1.1.0           
## [53] Brobdingnag_1.2-6         parallel_3.6.0           
## [55] inline_0.3.15             shinystan_2.5.0          
## [57] yaml_2.2.0                loo_2.1.0                
## [59] StanHeaders_2.19.0        stringi_1.4.3            
## [61] dygraphs_1.1.1.6          pkgbuild_1.0.5           
## [63] rlang_0.4.0               pkgconfig_2.0.3          
## [65] matrixStats_0.55.0        HDInterval_0.2.0         
## [67] evaluate_0.14             lattice_0.20-38          
## [69] rstantools_2.0.0          htmlwidgets_1.5          
## [71] labeling_0.3              tidyselect_0.2.5         
## [73] processx_3.4.1            plyr_1.8.4               
## [75] magrittr_1.5              R6_2.4.0                 
## [77] generics_0.0.2            pillar_1.4.2             
## [79] haven_2.1.0               withr_2.1.2              
## [81] xts_0.11-2                abind_1.4-5              
## [83] modelr_0.1.4              crayon_1.3.4             
## [85] arrayhelpers_1.0-20160527 utf8_1.1.4               
## [87] rmarkdown_1.13            grid_3.6.0               
## [89] readxl_1.3.1              callr_3.3.2              
## [91] threejs_0.3.1             digest_0.6.21            
## [93] xtable_1.8-4              httpuv_1.5.2             
## [95] stats4_3.6.0              munsell_0.5.0            
## [97] viridisLite_0.3.0         shinyjs_1.0</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="jags-brms.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-comparison-and-hierarchical-modeling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
