<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>17 Metric Predicted Variable with One Metric Predictor | Doing Bayesian Data Analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in Kruschke’s (2014) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="17 Metric Predicted Variable with One Metric Predictor | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is an attempt to re-express the code in Kruschke’s (2014) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="17 Metric Predicted Variable with One Metric Predictor | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in Kruschke’s (2014) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2019-11-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="metric-predicted-variable-on-one-or-two-groups.html">
<link rel="next" href="metric-predicted-variable-with-multiple-metric-predictors.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caution-work-in-progress"><i class="fa fa-check"></i>Caution: Work in progress</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html"><i class="fa fa-check"></i><b>1</b> What’s in This Book (Read This First!)</a><ul>
<li class="chapter" data-level="1.1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#real-people-can-read-this-book"><i class="fa fa-check"></i><b>1.1</b> Real people can read this book</a></li>
<li class="chapter" data-level="1.2" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-in-this-book"><i class="fa fa-check"></i><b>1.2</b> What’s in this book</a></li>
<li class="chapter" data-level="1.3" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-new-in-the-second-edition"><i class="fa fa-check"></i><b>1.3</b> What’s new in the second edition</a></li>
<li class="chapter" data-level="1.4" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#gimme-feedback-be-polite"><i class="fa fa-check"></i><b>1.4</b> Gimme feedback (be polite)</a></li>
<li class="chapter" data-level="1.5" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#thank-you"><i class="fa fa-check"></i><b>1.5</b> Thank you!</a></li>
<li class="chapter" data-level="" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="part"><span><b>I THE BASICS: MODELS, PROBABILITY, BAYES’ RULE, AND R</b></span></li>
<li class="chapter" data-level="2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html"><i class="fa fa-check"></i><b>2</b> Introduction: Credibility, Models, and Parameters</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#bayesian-inference-is-reallocation-of-credibility-across-possibilities"><i class="fa fa-check"></i><b>2.1</b> Bayesian inference is reallocation of credibility across possibilities</a><ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#data-are-noisy-and-inferences-are-probabilistic."><i class="fa fa-check"></i><b>2.1.1</b> Data are noisy and inferences are probabilistic.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#possibilities-are-parameter-values-in-descriptive-models"><i class="fa fa-check"></i><b>2.2</b> Possibilities are parameter values in descriptive models</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#the-steps-of-bayesian-data-analysis"><i class="fa fa-check"></i><b>2.3</b> The steps of Bayesian data analysis</a></li>
<li class="chapter" data-level="" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#reference-1"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html"><i class="fa fa-check"></i><b>3</b> The R Programming Language</a><ul>
<li class="chapter" data-level="3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-software"><i class="fa fa-check"></i><b>3.1</b> Get the software</a><ul>
<li class="chapter" data-level="3.1.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-look-at-rstudio."><i class="fa fa-check"></i><b>3.1.1</b> A look at RStudio.</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-simple-example-of-r-in-action"><i class="fa fa-check"></i><b>3.2</b> A simple example of R in action</a><ul>
<li class="chapter" data-level="3.2.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-programs-used-with-this-book."><i class="fa fa-check"></i><b>3.2.1</b> Get the programs used with this book.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#basic-commands-and-operators-in-r"><i class="fa fa-check"></i><b>3.3</b> Basic commands and operators in R</a><ul>
<li class="chapter" data-level="3.3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#getting-help-in-r."><i class="fa fa-check"></i><b>3.3.1</b> Getting help in R.</a></li>
<li class="chapter" data-level="3.3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#arithmetic-and-logical-operators."><i class="fa fa-check"></i><b>3.3.2</b> Arithmetic and logical operators.</a></li>
<li class="chapter" data-level="3.3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#assignment-relational-operators-and-tests-of-equality."><i class="fa fa-check"></i><b>3.3.3</b> Assignment, relational operators, and tests of equality.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-types"><i class="fa fa-check"></i><b>3.4</b> Variable types</a><ul>
<li class="chapter" data-level="3.4.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#vector."><i class="fa fa-check"></i><b>3.4.1</b> Vector.</a></li>
<li class="chapter" data-level="3.4.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#factor."><i class="fa fa-check"></i><b>3.4.2</b> Factor.</a></li>
<li class="chapter" data-level="3.4.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#matrix-and-array."><i class="fa fa-check"></i><b>3.4.3</b> Matrix and array.</a></li>
<li class="chapter" data-level="3.4.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#list-and-data-frame."><i class="fa fa-check"></i><b>3.4.4</b> List and data frame.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#loading-and-saving-data"><i class="fa fa-check"></i><b>3.5</b> Loading and saving data</a><ul>
<li class="chapter" data-level="3.5.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#the-read.csv-read_csv-and-read.table-read_table-functions."><i class="fa fa-check"></i><b>3.5.1</b> The <del>read.csv</del> <code>read_csv()</code> and <del>read.table</del> <code>read_table()</code> functions.</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#saving-data-from-r."><i class="fa fa-check"></i><b>3.5.2</b> Saving data from R.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#some-utility-functions"><i class="fa fa-check"></i><b>3.6</b> Some utility functions</a></li>
<li class="chapter" data-level="3.7" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-in-r"><i class="fa fa-check"></i><b>3.7</b> Programming in R</a><ul>
<li class="chapter" data-level="3.7.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-names-in-r."><i class="fa fa-check"></i><b>3.7.1</b> Variable names in R.</a></li>
<li class="chapter" data-level="3.7.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#running-a-program."><i class="fa fa-check"></i><b>3.7.2</b> Running a program.</a></li>
<li class="chapter" data-level="3.7.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-a-function."><i class="fa fa-check"></i><b>3.7.3</b> Programming a function.</a></li>
<li class="chapter" data-level="3.7.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#conditions-and-loops."><i class="fa fa-check"></i><b>3.7.4</b> Conditions and loops.</a></li>
<li class="chapter" data-level="3.7.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#measuring-processing-time."><i class="fa fa-check"></i><b>3.7.5</b> Measuring processing time.</a></li>
<li class="chapter" data-level="3.7.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#debugging."><i class="fa fa-check"></i><b>3.7.6</b> Debugging.</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#graphical-plots-opening-and-saving"><i class="fa fa-check"></i><b>3.8</b> Graphical plots: Opening and saving</a></li>
<li class="chapter" data-level="" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#reference-2"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html"><i class="fa fa-check"></i><b>4</b> What is This Stuff Called Probability?</a><ul>
<li class="chapter" data-level="4.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#the-set-of-all-possible-events"><i class="fa fa-check"></i><b>4.1</b> The set of all possible events</a></li>
<li class="chapter" data-level="4.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-outside-or-inside-the-head"><i class="fa fa-check"></i><b>4.2</b> Probability: Outside or inside the head</a><ul>
<li class="chapter" data-level="4.2.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#outside-the-head-long-run-relative-frequency."><i class="fa fa-check"></i><b>4.2.1</b> Outside the head: Long-run relative frequency.</a></li>
<li class="chapter" data-level="4.2.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#inside-the-head-subjective-belief."><i class="fa fa-check"></i><b>4.2.2</b> Inside the head: Subjective belief.</a></li>
<li class="chapter" data-level="4.2.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probabilities-assign-numbers-to-possibilities."><i class="fa fa-check"></i><b>4.2.3</b> Probabilities assign numbers to possibilities.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-distributions"><i class="fa fa-check"></i><b>4.3</b> Probability distributions</a><ul>
<li class="chapter" data-level="4.3.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#discrete-distributions-probability-mass."><i class="fa fa-check"></i><b>4.3.1</b> Discrete distributions: Probability mass.</a></li>
<li class="chapter" data-level="4.3.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#continuous-distributions-rendezvous-with-density."><i class="fa fa-check"></i><b>4.3.2</b> Continuous distributions: Rendezvous with density.</a></li>
<li class="chapter" data-level="4.3.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#mean-and-variance-of-a-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Mean and variance of a distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#highest-density-interval-hdi."><i class="fa fa-check"></i><b>4.3.4</b> Highest density interval (HDI).</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#two-way-distributions"><i class="fa fa-check"></i><b>4.4</b> Two-way distributions</a></li>
<li class="chapter" data-level="" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#reference-3"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayes-rule.html"><a href="bayes-rule.html"><i class="fa fa-check"></i><b>5</b> Bayes’ Rule</a><ul>
<li class="chapter" data-level="5.1" data-path="bayes-rule.html"><a href="bayes-rule.html#bayes-rule-1"><i class="fa fa-check"></i><b>5.1</b> Bayes’ rule</a><ul>
<li class="chapter" data-level="5.1.1" data-path="bayes-rule.html"><a href="bayes-rule.html#derived-from-definitions-of-conditional-probability."><i class="fa fa-check"></i><b>5.1.1</b> Derived from definitions of conditional probability.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bayes-rule.html"><a href="bayes-rule.html#applied-to-parameters-and-data"><i class="fa fa-check"></i><b>5.2</b> Applied to parameters and data</a></li>
<li class="chapter" data-level="5.3" data-path="bayes-rule.html"><a href="bayes-rule.html#complete-examples-estimating-bias-in-a-coin"><i class="fa fa-check"></i><b>5.3</b> Complete examples: Estimating bias in a coin</a><ul>
<li class="chapter" data-level="5.3.1" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-sample-size-on-the-posterior."><i class="fa fa-check"></i><b>5.3.1</b> Influence of sample size on the posterior.</a></li>
<li class="chapter" data-level="5.3.2" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-prior-on-the-posterior."><i class="fa fa-check"></i><b>5.3.2</b> Influence of prior on the posterior.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="bayes-rule.html"><a href="bayes-rule.html#why-bayesian-inference-can-be-difficult"><i class="fa fa-check"></i><b>5.4</b> Why Bayesian inference can be difficult</a></li>
<li class="chapter" data-level="" data-path="bayes-rule.html"><a href="bayes-rule.html#reference-4"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="bayes-rule.html"><a href="bayes-rule.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="part"><span><b>II ALL THE FUNDAMENTALS APPLIED TO INFERRING A BINOMIAL PROBABILITY</b></span></li>
<li class="chapter" data-level="6" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><i class="fa fa-check"></i><b>6</b> Inferring a Binomial Probability via Exact Mathematical Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-likelihood-function-the-bernoulli-distribution"><i class="fa fa-check"></i><b>6.1</b> The likelihood function: The Bernoulli distribution</a></li>
<li class="chapter" data-level="6.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#a-description-of-credibilities-the-beta-distribution"><i class="fa fa-check"></i><b>6.2</b> A description of credibilities: The beta distribution</a><ul>
<li class="chapter" data-level="6.2.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#specifying-a-beta-prior."><i class="fa fa-check"></i><b>6.2.1</b> Specifying a beta prior.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-posterior-beta"><i class="fa fa-check"></i><b>6.3</b> The posterior beta</a><ul>
<li class="chapter" data-level="6.3.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#posterior-is-compromise-of-prior-and-likelihood."><i class="fa fa-check"></i><b>6.3.1</b> Posterior is compromise of prior and likelihood.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#examples"><i class="fa fa-check"></i><b>6.4</b> Examples</a><ul>
<li class="chapter" data-level="6.4.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.1</b> Prior knowledge expressed as a beta distribution.</a></li>
<li class="chapter" data-level="6.4.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-that-cannot-be-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.2</b> Prior knowledge that cannot be expressed as a beta distribution.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#summary"><i class="fa fa-check"></i><b>6.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#reference-5"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>7</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="7.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#approximating-a-distribution-with-a-large-sample"><i class="fa fa-check"></i><b>7.1</b> Approximating a distribution with a large sample</a></li>
<li class="chapter" data-level="7.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-simple-case-of-the-metropolis-algorithm"><i class="fa fa-check"></i><b>7.2</b> A simple case of the Metropolis algorithm</a><ul>
<li class="chapter" data-level="7.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-politician-stumbles-upon-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.2.1</b> A politician stumbles upon the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-random-walk."><i class="fa fa-check"></i><b>7.2.2</b> A random walk.</a></li>
<li class="chapter" data-level="7.2.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#general-properties-of-a-random-walk."><i class="fa fa-check"></i><b>7.2.3</b> General properties of a random walk.</a></li>
<li class="chapter" data-level="7.2.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#why-we-care."><i class="fa fa-check"></i><b>7.2.4</b> Why we care.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-metropolis-algorithm-more-generally"><i class="fa fa-check"></i><b>7.3</b> The Metropolis algorithm more generally</a><ul>
<li class="chapter" data-level="7.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithm-applied-to-bernoulli-likelihood-and-beta-prior."><i class="fa fa-check"></i><b>7.3.1</b> Metropolis algorithm applied to Bernoulli likelihood and beta prior.</a></li>
<li class="chapter" data-level="7.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#summary-of-metropolis-algorithm."><i class="fa fa-check"></i><b>7.3.2</b> Summary of Metropolis algorithm.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#toward-gibbs-sampling-estimating-two-coin-biases"><i class="fa fa-check"></i><b>7.4</b> Toward Gibbs sampling: Estimating two coin biases</a><ul>
<li class="chapter" data-level="7.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#prior-likelihood-and-posterior-for-two-biases."><i class="fa fa-check"></i><b>7.4.1</b> Prior, likelihood and posterior for two biases.</a></li>
<li class="chapter" data-level="7.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-exact-formal-analysis."><i class="fa fa-check"></i><b>7.4.2</b> The posterior via exact formal analysis.</a></li>
<li class="chapter" data-level="7.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.4.3</b> The posterior via the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-hamiltonian-monte-carlo-sampling."><i class="fa fa-check"></i><b>7.4.4</b> <del>Gibbs</del> Hamiltonian Monte Carlo sampling.</a></li>
<li class="chapter" data-level="7.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#is-there-a-difference-between-biases"><i class="fa fa-check"></i><b>7.4.5</b> Is there a difference between biases?</a></li>
<li class="chapter" data-level="7.4.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#terminology-mcmc."><i class="fa fa-check"></i><b>7.4.6</b> Terminology: MCMC.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness-accuracy-and-efficiency"><i class="fa fa-check"></i><b>7.5</b> MCMC representativeness, accuracy, and efficiency</a><ul>
<li class="chapter" data-level="7.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness."><i class="fa fa-check"></i><b>7.5.1</b> MCMC representativeness.</a></li>
<li class="chapter" data-level="7.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-accuracy."><i class="fa fa-check"></i><b>7.5.2</b> MCMC accuracy.</a></li>
<li class="chapter" data-level="7.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-efficiency."><i class="fa fa-check"></i><b>7.5.3</b> MCMC efficiency.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#reference-6"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="jags-brms.html"><a href="jags-brms.html"><i class="fa fa-check"></i><b>8</b> <del>JAGS</del> brms</a><ul>
<li class="chapter" data-level="8.1" data-path="jags-brms.html"><a href="jags-brms.html#jags-brms-and-its-relation-to-r"><i class="fa fa-check"></i><b>8.1</b> <del>JAGS</del> brms and its relation to R</a></li>
<li class="chapter" data-level="8.2" data-path="jags-brms.html"><a href="jags-brms.html#a-complete-example"><i class="fa fa-check"></i><b>8.2</b> A complete example</a><ul>
<li class="chapter" data-level="8.2.1" data-path="jags-brms.html"><a href="jags-brms.html#load-data."><i class="fa fa-check"></i><b>8.2.1</b> Load data.</a></li>
<li class="chapter" data-level="8.2.2" data-path="jags-brms.html"><a href="jags-brms.html#specify-model."><i class="fa fa-check"></i><b>8.2.2</b> Specify model.</a></li>
<li class="chapter" data-level="8.2.3" data-path="jags-brms.html"><a href="jags-brms.html#initialize-chains."><i class="fa fa-check"></i><b>8.2.3</b> Initialize chains.</a></li>
<li class="chapter" data-level="8.2.4" data-path="jags-brms.html"><a href="jags-brms.html#generate-chains."><i class="fa fa-check"></i><b>8.2.4</b> Generate chains.</a></li>
<li class="chapter" data-level="8.2.5" data-path="jags-brms.html"><a href="jags-brms.html#examine-chains."><i class="fa fa-check"></i><b>8.2.5</b> Examine chains.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="jags-brms.html"><a href="jags-brms.html#simplified-scripts-for-frequently-used-analyses"><i class="fa fa-check"></i><b>8.3</b> Simplified scripts for frequently used analyses</a></li>
<li class="chapter" data-level="8.4" data-path="jags-brms.html"><a href="jags-brms.html#example-difference-of-biases"><i class="fa fa-check"></i><b>8.4</b> Example: Difference of biases</a></li>
<li class="chapter" data-level="8.5" data-path="jags-brms.html"><a href="jags-brms.html#sampling-from-the-prior-distribution-in-jags-brms"><i class="fa fa-check"></i><b>8.5</b> Sampling from the prior distribution in <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="8.6" data-path="jags-brms.html"><a href="jags-brms.html#probability-distributions-available-in-jags-brms"><i class="fa fa-check"></i><b>8.6</b> Probability distributions available in <del>JAGS</del> brms</a><ul>
<li class="chapter" data-level="8.6.1" data-path="jags-brms.html"><a href="jags-brms.html#defining-new-likelihood-functions."><i class="fa fa-check"></i><b>8.6.1</b> Defining new likelihood functions.</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="jags-brms.html"><a href="jags-brms.html#faster-sampling-with-parallel-processing-in-runjags-brmsbrm"><i class="fa fa-check"></i><b>8.7</b> Faster sampling with parallel processing in <del>runjags</del> <code>brms::brm()</code></a></li>
<li class="chapter" data-level="8.8" data-path="jags-brms.html"><a href="jags-brms.html#tips-for-expanding-jags-brms-models"><i class="fa fa-check"></i><b>8.8</b> Tips for expanding <del>JAGS</del> brms models</a></li>
<li class="chapter" data-level="" data-path="jags-brms.html"><a href="jags-brms.html#reference-7"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="jags-brms.html"><a href="jags-brms.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>9</b> Hierarchical Models</a><ul>
<li class="chapter" data-level="9.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-single-coin-from-a-single-mint"><i class="fa fa-check"></i><b>9.1</b> A single coin from a single mint</a><ul>
<li class="chapter" data-level="9.1.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation."><i class="fa fa-check"></i><b>9.1.1</b> Posterior via grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#multiple-coins-from-a-single-mint"><i class="fa fa-check"></i><b>9.2</b> Multiple coins from a single mint</a><ul>
<li class="chapter" data-level="9.2.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation.-1"><i class="fa fa-check"></i><b>9.2.1</b> Posterior via grid approximation.</a></li>
<li class="chapter" data-level="9.2.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-realistic-model-with-mcmc."><i class="fa fa-check"></i><b>9.2.2</b> A realistic model with MCMC.</a></li>
<li class="chapter" data-level="9.2.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#doing-it-with-jags-brms."><i class="fa fa-check"></i><b>9.2.3</b> Doing it with <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="9.2.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-therapeutic-touch."><i class="fa fa-check"></i><b>9.2.4</b> Example: Therapeutic touch.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#shrinkage-in-hierarchical-models"><i class="fa fa-check"></i><b>9.3</b> Shrinkage in hierarchical models</a></li>
<li class="chapter" data-level="9.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#speeding-up-jags-brms"><i class="fa fa-check"></i><b>9.4</b> Speeding up <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="9.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#extending-the-hierarchy-subjects-within-categories"><i class="fa fa-check"></i><b>9.5</b> Extending the hierarchy: Subjects within categories</a><ul>
<li class="chapter" data-level="9.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-baseball-batting-abilities-by-position."><i class="fa fa-check"></i><b>9.5.1</b> Example: Baseball batting abilities by position.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hierarchical-models.html"><a href="hierarchical-models.html#reference-8"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="hierarchical-models.html"><a href="hierarchical-models.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html"><i class="fa fa-check"></i><b>10</b> Model Comparison and Hierarchical Modeling</a><ul>
<li class="chapter" data-level="10.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#general-formula-and-the-bayes-factor"><i class="fa fa-check"></i><b>10.1</b> General formula and the Bayes factor</a></li>
<li class="chapter" data-level="10.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#example-two-factories-of-coins"><i class="fa fa-check"></i><b>10.2</b> Example: Two factories of coins</a><ul>
<li class="chapter" data-level="10.2.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-formal-analysis."><i class="fa fa-check"></i><b>10.2.1</b> Solution by formal analysis.</a></li>
<li class="chapter" data-level="10.2.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-grid-approximation."><i class="fa fa-check"></i><b>10.2.2</b> Solution by grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-mcmc"><i class="fa fa-check"></i><b>10.3</b> Solution by MCMC</a><ul>
<li class="chapter" data-level="10.3.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#nonhierarchical-mcmc-computation-of-each-models-marginal-likelihood."><i class="fa fa-check"></i><b>10.3.1</b> Nonhierarchical MCMC computation of each model’s marginal likelihood.</a></li>
<li class="chapter" data-level="10.3.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#hierarchical-mcmc-computation-of-relative-model-probability-is-not-available-in-brms-well-cover-information-criteria-instead."><i class="fa fa-check"></i><b>10.3.2</b> Hierarchical MCMC computation <del>of relative model probability</del> is not available in brms: We’ll cover information criteria instead.</a></li>
<li class="chapter" data-level="10.3.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#models-with-different-noise-distributions-in-jags-brms."><i class="fa fa-check"></i><b>10.3.3</b> Models with different “noise” distributions in <del>JAGS</del> brms.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#prediction-model-averaging"><i class="fa fa-check"></i><b>10.4</b> Prediction: Model averaging</a></li>
<li class="chapter" data-level="10.5" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#model-complexity-naturally-accounted-for"><i class="fa fa-check"></i><b>10.5</b> Model complexity naturally accounted for</a><ul>
<li class="chapter" data-level="10.5.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#caveats-regarding-nested-model-comparison."><i class="fa fa-check"></i><b>10.5.1</b> Caveats regarding nested model comparison.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#extreme-sensitivity-to-the-prior-distribution"><i class="fa fa-check"></i><b>10.6</b> Extreme sensitivity to the prior distribution</a><ul>
<li class="chapter" data-level="10.6.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#priors-of-different-models-should-be-equally-informed."><i class="fa fa-check"></i><b>10.6.1</b> Priors of different models should be equally informed.</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#bonus-theres-danger-ahead"><i class="fa fa-check"></i><b>10.7</b> Bonus: There’s danger ahead</a></li>
<li class="chapter" data-level="" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#reference-9"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html"><i class="fa fa-check"></i><b>11</b> Null Hypothesis Significance Testing</a><ul>
<li class="chapter" data-level="11.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#paved-with-good-intentions"><i class="fa fa-check"></i><b>11.1</b> Paved with good intentions</a><ul>
<li class="chapter" data-level="11.1.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#definition-of-p-value."><i class="fa fa-check"></i><b>11.1.1</b> Definition of <span class="math inline">\(p\)</span> value.</a></li>
<li class="chapter" data-level="11.1.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-n."><i class="fa fa-check"></i><b>11.1.2</b> With intention to fix <span class="math inline">\(N\)</span>.</a></li>
<li class="chapter" data-level="11.1.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-z."><i class="fa fa-check"></i><b>11.1.3</b> With intention to fix <span class="math inline">\(z\)</span>.</a></li>
<li class="chapter" data-level="11.1.4" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-duration."><i class="fa fa-check"></i><b>11.1.4</b> With intention to fix duration.</a></li>
<li class="chapter" data-level="11.1.5" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-make-multiple-tests."><i class="fa fa-check"></i><b>11.1.5</b> With intention to make multiple tests.</a></li>
<li class="chapter" data-level="11.1.6" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#soul-searching."><i class="fa fa-check"></i><b>11.1.6</b> Soul searching.</a></li>
<li class="chapter" data-level="11.1.7" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-analysis."><i class="fa fa-check"></i><b>11.1.7</b> Bayesian analysis.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#prior-knowledge"><i class="fa fa-check"></i><b>11.2</b> Prior knowledge</a><ul>
<li class="chapter" data-level="11.2.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#nhst-analysis."><i class="fa fa-check"></i><b>11.2.1</b> NHST analysis.</a></li>
<li class="chapter" data-level="11.2.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-analysis.-1"><i class="fa fa-check"></i><b>11.2.2</b> Bayesian analysis.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#confidence-interval-and-highest-density-interval"><i class="fa fa-check"></i><b>11.3</b> Confidence interval and highest density interval</a><ul>
<li class="chapter" data-level="11.3.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#ci-depends-on-intention."><i class="fa fa-check"></i><b>11.3.1</b> CI depends on intention.</a></li>
<li class="chapter" data-level="11.3.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-hdi."><i class="fa fa-check"></i><b>11.3.2</b> Bayesian HDI.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#multiple-comparisons"><i class="fa fa-check"></i><b>11.4</b> Multiple comparisons</a><ul>
<li class="chapter" data-level="11.4.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#nhst-correction-for-experiment-wise-error."><i class="fa fa-check"></i><b>11.4.1</b> NHST correction for experiment wise error.</a></li>
<li class="chapter" data-level="11.4.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#just-one-bayesian-posterior-no-matter-how-you-look-at-it."><i class="fa fa-check"></i><b>11.4.2</b> Just one Bayesian posterior no matter how you look at it.</a></li>
<li class="chapter" data-level="11.4.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#how-bayesian-analysis-mitigates-false-alarms."><i class="fa fa-check"></i><b>11.4.3</b> How Bayesian analysis mitigates false alarms.</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#what-a-sampling-distribution-is-good-for"><i class="fa fa-check"></i><b>11.5</b> What a sampling distribution is good for</a><ul>
<li class="chapter" data-level="11.5.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#planning-an-experiment."><i class="fa fa-check"></i><b>11.5.1</b> Planning an experiment.</a></li>
<li class="chapter" data-level="11.5.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#exploring-model-predictions-posterior-predictive-check."><i class="fa fa-check"></i><b>11.5.2</b> Exploring model predictions (posterior predictive check).</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#reference-10"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><i class="fa fa-check"></i><b>12</b> Bayesian Approaches to Testing a Point (“Null”) Hypothesis</a><ul>
<li class="chapter" data-level="12.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#the-estimation-approach"><i class="fa fa-check"></i><b>12.1</b> The estimation approach</a><ul>
<li class="chapter" data-level="12.1.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#region-of-practical-equivalence."><i class="fa fa-check"></i><b>12.1.1</b> Region of practical equivalence.</a></li>
<li class="chapter" data-level="12.1.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#some-examples."><i class="fa fa-check"></i><b>12.1.2</b> Some examples.</a></li>
<li class="chapter" data-level="12.1.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#differences-of-correlated-parameters."><i class="fa fa-check"></i><b>12.1.3</b> Differences of correlated parameters.</a></li>
<li class="chapter" data-level="12.1.4" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#why-hdi-and-not-equal-tailed-interval"><i class="fa fa-check"></i><b>12.1.4</b> Why HDI and not equal-tailed interval?</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#the-model-comparison-approach"><i class="fa fa-check"></i><b>12.2</b> The model-comparison approach</a><ul>
<li class="chapter" data-level="12.2.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#is-a-coin-fair-or-not"><i class="fa fa-check"></i><b>12.2.1</b> Is a coin fair or not?</a></li>
<li class="chapter" data-level="12.2.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#bayes-factor-can-accept-null-with-poor-precision."><i class="fa fa-check"></i><b>12.2.2</b> Bayes’ factor can accept null with poor precision.</a></li>
<li class="chapter" data-level="12.2.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#are-different-groups-equal-or-not"><i class="fa fa-check"></i><b>12.2.3</b> Are different groups equal or not?</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#relations-of-parameter-estimation-and-model-comparison"><i class="fa fa-check"></i><b>12.3</b> Relations of parameter estimation and model comparison</a></li>
<li class="chapter" data-level="12.4" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#estimation-and-model-comparison"><i class="fa fa-check"></i><b>12.4</b> Estimation and model comparison?</a></li>
<li class="chapter" data-level="" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#reference-11"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html"><i class="fa fa-check"></i><b>13</b> Goals, Power, and Sample Size</a><ul>
<li class="chapter" data-level="" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#references"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>14</b> Stan</a><ul>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#references-1"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="part"><span><b>III THE GENERALIZED LINEAR MODEL</b></span></li>
<li class="chapter" data-level="15" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>15</b> Overview of the Generalized Linear Model</a><ul>
<li class="chapter" data-level="15.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#types-of-variables"><i class="fa fa-check"></i><b>15.1</b> Types of variables</a><ul>
<li class="chapter" data-level="15.1.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#predictor-and-predicted-variables."><i class="fa fa-check"></i><b>15.1.1</b> Predictor and predicted variables.</a></li>
<li class="chapter" data-level="15.1.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#scale-types-metric-ordinal-nominal-and-count."><i class="fa fa-check"></i><b>15.1.2</b> Scale types: metric, ordinal, nominal, and count.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linear-combination-of-predictors"><i class="fa fa-check"></i><b>15.2</b> Linear combination of predictors</a><ul>
<li class="chapter" data-level="15.2.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linear-function-of-a-single-metric-predictor."><i class="fa fa-check"></i><b>15.2.1</b> Linear function of a single metric predictor.</a></li>
<li class="chapter" data-level="15.2.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#additive-combination-of-metric-predictors."><i class="fa fa-check"></i><b>15.2.2</b> Additive combination of metric predictors.</a></li>
<li class="chapter" data-level="15.2.3" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#nonadditive-interaction-of-metric-predictors."><i class="fa fa-check"></i><b>15.2.3</b> Nonadditive interaction of metric predictors.</a></li>
<li class="chapter" data-level="15.2.4" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#nominal-predictors."><i class="fa fa-check"></i><b>15.2.4</b> Nominal predictors.</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linking-from-combined-predictors-to-noisy-predicted-data"><i class="fa fa-check"></i><b>15.3</b> Linking from combined predictors to noisy predicted data</a><ul>
<li class="chapter" data-level="15.3.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#from-predictors-to-predicted-central-tendency."><i class="fa fa-check"></i><b>15.3.1</b> From predictors to predicted central tendency.</a></li>
<li class="chapter" data-level="15.3.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#from-predicted-central-tendency-to-noisy-data."><i class="fa fa-check"></i><b>15.3.2</b> From predicted central tendency to noisy data.</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#formal-expression-of-the-glm"><i class="fa fa-check"></i><b>15.4</b> Formal expression of the GLM</a><ul>
<li class="chapter" data-level="15.4.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#cases-of-the-glm."><i class="fa fa-check"></i><b>15.4.1</b> Cases of the GLM.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#reference-12"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html"><i class="fa fa-check"></i><b>16</b> Metric-Predicted Variable on One or Two Groups</a><ul>
<li class="chapter" data-level="16.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#estimating-the-mean-and-standard-deviation-of-a-normal-distribution"><i class="fa fa-check"></i><b>16.1</b> Estimating the mean and standard deviation of a normal distribution</a><ul>
<li class="chapter" data-level="16.1.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#solution-by-mathematical-analysis-heads-up-on-precision."><i class="fa fa-check"></i><b>16.1.1</b> <del>Solution by mathematical analysis</del> Heads up on precision.</a></li>
<li class="chapter" data-level="16.1.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#approximation-by-mcmc-in-jags-hmc-in-brms."><i class="fa fa-check"></i><b>16.1.2</b> Approximation by <del>MCMC in JAGS</del> HMC in brms.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#outliers-and-robust-estimation-the-t-distribution"><i class="fa fa-check"></i><b>16.2</b> Outliers and robust estimation: The <span class="math inline">\(t\)</span> distribution</a><ul>
<li class="chapter" data-level="16.2.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#using-the-t-distribution-in-jags-brms."><i class="fa fa-check"></i><b>16.2.1</b> Using the <span class="math inline">\(t\)</span> distribution in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="16.2.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#using-the-t-distribution-in-stan."><i class="fa fa-check"></i><b>16.2.2</b> Using the <span class="math inline">\(t\)</span> distribution in Stan.</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#two-groups"><i class="fa fa-check"></i><b>16.3</b> Two groups</a><ul>
<li class="chapter" data-level="16.3.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#analysis-by-nhst."><i class="fa fa-check"></i><b>16.3.1</b> Analysis by NHST.</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#other-noise-distributions-and-transforming-data"><i class="fa fa-check"></i><b>16.4</b> Other noise distributions and transforming data</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#reference-13"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#session-info-15"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html"><i class="fa fa-check"></i><b>17</b> Metric Predicted Variable with One Metric Predictor</a><ul>
<li class="chapter" data-level="17.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#simple-linear-regression"><i class="fa fa-check"></i><b>17.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="17.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression"><i class="fa fa-check"></i><b>17.2</b> Robust linear regression</a><ul>
<li class="chapter" data-level="17.2.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression-in-jags-brms."><i class="fa fa-check"></i><b>17.2.1</b> Robust linear regression in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="17.2.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression-in-stan."><i class="fa fa-check"></i><b>17.2.2</b> Robust linear regression in Stan.</a></li>
<li class="chapter" data-level="17.2.3" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#stan-or-jags"><i class="fa fa-check"></i><b>17.2.3</b> Stan or JAGS?</a></li>
<li class="chapter" data-level="17.2.4" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>17.2.4</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#hierarchical-regression-on-individuals-within-groups"><i class="fa fa-check"></i><b>17.3</b> Hierarchical regression on individuals within groups</a><ul>
<li class="chapter" data-level="17.3.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#the-model-and-implementation-in-jags-brms."><i class="fa fa-check"></i><b>17.3.1</b> The model and implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="17.3.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#the-posterior-distribution-shrinkage-and-prediction."><i class="fa fa-check"></i><b>17.3.2</b> The posterior distribution: Shrinkage and prediction.</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#quadratic-trend-and-weighted-data"><i class="fa fa-check"></i><b>17.4</b> Quadratic trend and weighted data</a><ul>
<li class="chapter" data-level="17.4.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#results-and-interpretation."><i class="fa fa-check"></i><b>17.4.1</b> Results and interpretation.</a></li>
<li class="chapter" data-level="17.4.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#further-extensions."><i class="fa fa-check"></i><b>17.4.2</b> Further extensions.</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#procedure-and-perils-for-expanding-a-model"><i class="fa fa-check"></i><b>17.5</b> Procedure and perils for expanding a model</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#reference-14"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#session-info-16"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html"><i class="fa fa-check"></i><b>18</b> Metric Predicted Variable with Multiple Metric Predictors</a><ul>
<li class="chapter" data-level="18.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#multiple-linear-regression"><i class="fa fa-check"></i><b>18.1</b> Multiple linear regression</a><ul>
<li class="chapter" data-level="18.1.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-perils-of-correlated-predictors."><i class="fa fa-check"></i><b>18.1.1</b> The perils of correlated predictors.</a></li>
<li class="chapter" data-level="18.1.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-model-and-implementation."><i class="fa fa-check"></i><b>18.1.2</b> The model and implementation.</a></li>
<li class="chapter" data-level="18.1.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-posterior-distribution."><i class="fa fa-check"></i><b>18.1.3</b> The posterior distribution.</a></li>
<li class="chapter" data-level="18.1.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#redundant-predictors."><i class="fa fa-check"></i><b>18.1.4</b> Redundant predictors.</a></li>
<li class="chapter" data-level="18.1.5" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#informative-priors-sparse-data-and-correlated-predictors."><i class="fa fa-check"></i><b>18.1.5</b> Informative priors, sparse data, and correlated predictors.</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#multiplicative-interaction-of-metric-predictors"><i class="fa fa-check"></i><b>18.2</b> Multiplicative interaction of metric predictors</a><ul>
<li class="chapter" data-level="18.2.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#an-example."><i class="fa fa-check"></i><b>18.2.1</b> An example.</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#shrinkage-of-regression-coefficients"><i class="fa fa-check"></i><b>18.3</b> Shrinkage of regression coefficients</a></li>
<li class="chapter" data-level="18.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#variable-selection"><i class="fa fa-check"></i><b>18.4</b> Variable selection</a><ul>
<li class="chapter" data-level="18.4.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#inclusion-probability-is-strongly-affected-by-vagueness-of-prior."><i class="fa fa-check"></i><b>18.4.1</b> Inclusion probability is strongly affected by vagueness of prior.</a></li>
<li class="chapter" data-level="18.4.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#variable-selection-with-hierarchical-shrinkage."><i class="fa fa-check"></i><b>18.4.2</b> Variable selection with hierarchical shrinkage.</a></li>
<li class="chapter" data-level="18.4.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#what-to-report-and-what-to-conclude."><i class="fa fa-check"></i><b>18.4.3</b> What to report and what to conclude.</a></li>
<li class="chapter" data-level="18.4.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#caution-computational-methods."><i class="fa fa-check"></i><b>18.4.4</b> Caution: Computational methods.</a></li>
<li class="chapter" data-level="18.4.5" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#caution-interaction-variables."><i class="fa fa-check"></i><b>18.4.5</b> Caution: Interaction variables.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#reference-15"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#session-info-17"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Doing Bayesian Data Analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="metric-predicted-variable-with-one-metric-predictor" class="section level1">
<h1><span class="header-section-number">17</span> Metric Predicted Variable with One Metric Predictor</h1>
<blockquote>
<p>We will initially describe the relationship between the predicted variable, <span class="math inline">\(y\)</span> and predictor, <span class="math inline">\(x\)</span>, with a simple linear model and normally distributed residual randomness in <span class="math inline">\(y\)</span>. This model is often referred to as ‘simple linear regression.’ We will generalize the model in three ways. First, we will give it a noise distribution that accommodates outliers, which is to say that we will replace the normal distribution with a <span class="math inline">\(t\)</span> distribution as we did in the previous chapter. The model will be implemented in [<strong>brms</strong>]. Next, we will consider differently shaped relations between the predictor and the predicted, such as quadratic trend. Finally, we will consider hierarchical models of situations in which every individual has data that can be described by an individual trend, and we also want to estimate group-level typical trends across individuals. (p. 478)</p>
</blockquote>
<div id="simple-linear-regression" class="section level2">
<h2><span class="header-section-number">17.1</span> Simple linear regression</h2>
<p>It wasn’t entirely clear how Kruschke simulated the bimodal data on the right panel of Figure 17.1. I figured an even split of two Gaussians would suffice and just sighted their <span class="math inline">\(\mu\)</span>s and <span class="math inline">\(\sigma\)</span>s.</p>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1186-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1186-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1186-3" data-line-number="3"><span class="co"># how many draws per panel would you like?</span></a>
<a class="sourceLine" id="cb1186-4" data-line-number="4">n_draw &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb1186-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1186-6" data-line-number="6"><span class="kw">set.seed</span>(<span class="dv">17</span>)</a>
<a class="sourceLine" id="cb1186-7" data-line-number="7">d &lt;-</a>
<a class="sourceLine" id="cb1186-8" data-line-number="8"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">panel =</span> <span class="kw">rep</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">each =</span> n_draw),</a>
<a class="sourceLine" id="cb1186-9" data-line-number="9">         <span class="dt">x =</span> <span class="kw">c</span>(<span class="kw">runif</span>(<span class="dt">n =</span> n_draw,    <span class="dv">-10</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1186-10" data-line-number="10">               <span class="kw">rnorm</span>(<span class="dt">n =</span> n_draw <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dv">-6</span>,  <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1186-11" data-line-number="11">               <span class="kw">rnorm</span>(<span class="dt">n =</span> n_draw <span class="op">/</span><span class="st"> </span><span class="dv">2</span>,  <span class="dv">3</span>,  <span class="dv">2</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1186-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="kw">n</span>(), <span class="dv">0</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb1186-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1186-14" data-line-number="14"><span class="kw">head</span>(d)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   panel      x     y
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 a     -6.90  -4.09
## 2 a      9.37  28.6 
## 3 a     -0.635 11.8 
## 4 a      5.54  23.3 
## 5 a     -1.84  10.9 
## 6 a      0.776 10.9</code></pre>
<p>In case you missed it, Kruschke defied the formula for these data in Figure 17.1. It is</p>
<p><span class="math display">\[\begin{align*}
y_i &amp; \sim \operatorname{Normal} (\mu, \sigma = 2), \text{where} \\
\mu &amp; = 10 + 2 x_i.
\end{align*}\]</span></p>
<p>“Note that the model only specifies the dependency of <span class="math inline">\(y\)</span> on <span class="math inline">\(x\)</span>. The model does not say anything about what generates <span class="math inline">\(x\)</span>, and there is no probability distribution assumed for describing <span class="math inline">\(x\)</span>” (p. 479). Let this sink into your soul. It took a long time, for me. E.g., a lot of people fret over the distributions of their <span class="math inline">\(x\)</span> variables. Now one might should examine them to make sure nothing looks off, such as for data coding mistakes. But if they’re not perfectly or even approximately Gaussian, that isn’t necessarily an issue. The typical linear model makes no presumption about the distribution of the predictors. Often times, the largest issue is whether the <span class="math inline">\(x\)</span> variables are categorical or continuous.</p>
<p>Before we make our Figure 17.1, we’ll want to make a separate tibble of the values necessary to plot those sideways Gaussians. Here are the steps.</p>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1188-1" data-line-number="1">curves &lt;-</a>
<a class="sourceLine" id="cb1188-2" data-line-number="2"><span class="st">  </span><span class="co"># define the 3 x-values we want the Gaussians to originate from</span></a>
<a class="sourceLine" id="cb1188-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">-7.5</span>, <span class="dt">to =</span> <span class="fl">7.5</span>, <span class="dt">length.out =</span> <span class="dv">4</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1188-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb1188-5" data-line-number="5"><span class="st">  </span><span class="co"># use the formula 10 + 2x to compute the expected y-value for x</span></a>
<a class="sourceLine" id="cb1188-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_mean =</span> <span class="dv">10</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1188-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb1188-8" data-line-number="8"><span class="st">  </span><span class="co"># based on a Gaussian with `mean = y_mean` and `sd = 2`, compute the 99% intervals</span></a>
<a class="sourceLine" id="cb1188-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> <span class="kw">qnorm</span>(.<span class="dv">005</span>, <span class="dt">mean =</span> y_mean, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1188-10" data-line-number="10">         <span class="dt">ul =</span> <span class="kw">qnorm</span>(.<span class="dv">995</span>, <span class="dt">mean =</span> y_mean, <span class="dt">sd =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1188-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb1188-12" data-line-number="12"><span class="st">  </span><span class="co"># now use those interval bounds to make a sequence of y-values</span></a>
<a class="sourceLine" id="cb1188-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">map2</span>(ll, ul, seq, <span class="dt">length.out =</span> <span class="dv">100</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1188-14" data-line-number="14"><span class="st">  </span></a>
<a class="sourceLine" id="cb1188-15" data-line-number="15"><span class="st">  </span><span class="co"># since that operation returned a nested column, we need to `unnest()`</span></a>
<a class="sourceLine" id="cb1188-16" data-line-number="16"><span class="st">  </span><span class="kw">unnest</span>(y) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1188-17" data-line-number="17"><span class="st">  </span></a>
<a class="sourceLine" id="cb1188-18" data-line-number="18"><span class="st">  </span><span class="co"># compute the density values</span></a>
<a class="sourceLine" id="cb1188-19" data-line-number="19"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">map2_dbl</span>(y, y_mean, dnorm, <span class="dt">sd =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1188-20" data-line-number="20"><span class="st">  </span></a>
<a class="sourceLine" id="cb1188-21" data-line-number="21"><span class="st">  </span><span class="co"># now rescale the density values to be wider.</span></a>
<a class="sourceLine" id="cb1188-22" data-line-number="22"><span class="st">  </span><span class="co"># since we want these to be our x-values, we&#39;ll </span></a>
<a class="sourceLine" id="cb1188-23" data-line-number="23"><span class="st">  </span><span class="co"># just redefine the x column with these results</span></a>
<a class="sourceLine" id="cb1188-24" data-line-number="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x =</span> x <span class="op">-</span><span class="st"> </span>density <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(density))</a>
<a class="sourceLine" id="cb1188-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1188-26" data-line-number="26"><span class="kw">str</span>(curves)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    400 obs. of  6 variables:
##  $ x      : num  -7.57 -7.58 -7.59 -7.61 -7.62 ...
##  $ y_mean : num  -5 -5 -5 -5 -5 -5 -5 -5 -5 -5 ...
##  $ ll     : num  -10.2 -10.2 -10.2 -10.2 -10.2 ...
##  $ ul     : num  0.152 0.152 0.152 0.152 0.152 ...
##  $ y      : num  -10.15 -10.05 -9.94 -9.84 -9.74 ...
##  $ density: num  0.00723 0.00826 0.0094 0.01068 0.01209 ...</code></pre>
<p>Now we’re ready to make Figure 17.1.</p>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1190-1" data-line-number="1"><span class="kw">theme_set</span>(<span class="kw">theme_grey</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-2" data-line-number="2"><span class="st">            </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()))</a>
<a class="sourceLine" id="cb1190-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1190-4" data-line-number="4">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1190-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-9" data-line-number="9"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> F, <span class="dt">fullrange =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> curves,</a>
<a class="sourceLine" id="cb1190-11" data-line-number="11">            <span class="kw">aes</span>(<span class="dt">group =</span> y_mean),</a>
<a class="sourceLine" id="cb1190-12" data-line-number="12">            <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-13" data-line-number="13"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">-10</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb1190-14" data-line-number="14">                  <span class="dt">ylim =</span> <span class="dv">-10</span><span class="op">:</span><span class="dv">30</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title    =</span> <span class="st">&quot;Normal PDF around Linear Function&quot;</span>,</a>
<a class="sourceLine" id="cb1190-16" data-line-number="16">       <span class="dt">subtitle =</span> <span class="st">&quot;We simulated x from a uniform distribution in the left panel and simulated it from a mixture of</span><span class="ch">\n</span><span class="st"> two Gaussians on the right.&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1190-18" data-line-number="18">        <span class="dt">strip.text =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>panel)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-4-1.png" /><!-- --></p>
<p>Concerning causality,</p>
<blockquote>
<p><em>the simple linear model makes no claims about causal connections between</em> <span class="math inline">\(x\)</span> <em>and</em> <span class="math inline">\(y\)</span>. <em>The simple linear model merely describes a tendency for</em> <span class="math inline">\(y\)</span> <em>values to be linearly related to</em> <span class="math inline">\(x\)</span> <em>values</em>, hence “predictable” from the <span class="math inline">\(x\)</span> values. When describing data with this model, we are starting with a scatter plot of points generated by an unknown process in the real world, and estimating parameter values that would produce a smattering of points that might mimic the real data. Even if the descriptive model mimics the data well (and it might not), the mathematical “process” in the model may have little if anything to do with the real-world process that created the data. Nevertheless, the parameters in the descriptive model are meaningful because they describe tendencies in the data. (p. 479, <em>emphasis</em> added)</p>
</blockquote>
<p>I emphasized these points because I’ve heard and seen a lot of academics conflate linear regression models with causal models. For sure, it might well be preferable if your regression model was also a causal model. But good old prediction is fine, too.</p>
</div>
<div id="robust-linear-regression" class="section level2">
<h2><span class="header-section-number">17.2</span> Robust linear regression</h2>
<blockquote>
<p>There is no requirement to use a normal distribution for the noise distribution. The normal distribution is traditional because of its relative simplicity in mathematical derivations. But real data may have outliers, and the use of (optionally) heavy-tailed noise distributions is straight forward in contemporary Bayesian software[, like <strong>brms</strong>]. (pp. 479–480)</p>
</blockquote>
<p>Here’s Kruschke’s <code>HtWtDataGenerator()</code> code.</p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1191-1" data-line-number="1">HtWtDataGenerator &lt;-<span class="st"> </span><span class="cf">function</span>(nSubj, <span class="dt">rndsd =</span> <span class="ot">NULL</span>, <span class="dt">maleProb =</span> <span class="fl">0.50</span>) {</a>
<a class="sourceLine" id="cb1191-2" data-line-number="2">  <span class="co"># Random height, weight generator for males and females. Uses parameters from</span></a>
<a class="sourceLine" id="cb1191-3" data-line-number="3">  <span class="co"># Brainard, J. &amp; Burmaster, D. E. (1992). Bivariate distributions for height and</span></a>
<a class="sourceLine" id="cb1191-4" data-line-number="4">  <span class="co"># weight of men and women in the United States. Risk Analysis, 12(2), 267-275.</span></a>
<a class="sourceLine" id="cb1191-5" data-line-number="5">  <span class="co"># Kruschke, J. K. (2011). Doing Bayesian data analysis:</span></a>
<a class="sourceLine" id="cb1191-6" data-line-number="6">  <span class="co"># A Tutorial with R and BUGS. Academic Press / Elsevier.</span></a>
<a class="sourceLine" id="cb1191-7" data-line-number="7">  <span class="co"># Kruschke, J. K. (2014). Doing Bayesian data analysis, 2nd Edition:</span></a>
<a class="sourceLine" id="cb1191-8" data-line-number="8">  <span class="co"># A Tutorial with R, JAGS and Stan. Academic Press / Elsevier.</span></a>
<a class="sourceLine" id="cb1191-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb1191-10" data-line-number="10">  <span class="co"># require(MASS)</span></a>
<a class="sourceLine" id="cb1191-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb1191-12" data-line-number="12">  <span class="co"># Specify parameters of multivariate normal (MVN) distributions.</span></a>
<a class="sourceLine" id="cb1191-13" data-line-number="13">  <span class="co"># Men:</span></a>
<a class="sourceLine" id="cb1191-14" data-line-number="14">  HtMmu   &lt;-<span class="st"> </span><span class="fl">69.18</span></a>
<a class="sourceLine" id="cb1191-15" data-line-number="15">  HtMsd   &lt;-<span class="st"> </span><span class="fl">2.87</span></a>
<a class="sourceLine" id="cb1191-16" data-line-number="16">  lnWtMmu &lt;-<span class="st"> </span><span class="fl">5.14</span></a>
<a class="sourceLine" id="cb1191-17" data-line-number="17">  lnWtMsd &lt;-<span class="st"> </span><span class="fl">0.17</span></a>
<a class="sourceLine" id="cb1191-18" data-line-number="18">  Mrho    &lt;-<span class="st"> </span><span class="fl">0.42</span></a>
<a class="sourceLine" id="cb1191-19" data-line-number="19">  Mmean   &lt;-<span class="st"> </span><span class="kw">c</span>(HtMmu, lnWtMmu)</a>
<a class="sourceLine" id="cb1191-20" data-line-number="20">  Msigma  &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(HtMsd<span class="op">^</span><span class="dv">2</span>, Mrho <span class="op">*</span><span class="st"> </span>HtMsd <span class="op">*</span><span class="st"> </span>lnWtMsd,</a>
<a class="sourceLine" id="cb1191-21" data-line-number="21">                      Mrho <span class="op">*</span><span class="st"> </span>HtMsd <span class="op">*</span><span class="st"> </span>lnWtMsd, lnWtMsd<span class="op">^</span><span class="dv">2</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1191-22" data-line-number="22">  <span class="co"># Women cluster 1:</span></a>
<a class="sourceLine" id="cb1191-23" data-line-number="23">  HtFmu1   &lt;-<span class="st"> </span><span class="fl">63.11</span></a>
<a class="sourceLine" id="cb1191-24" data-line-number="24">  HtFsd1   &lt;-<span class="st"> </span><span class="fl">2.76</span></a>
<a class="sourceLine" id="cb1191-25" data-line-number="25">  lnWtFmu1 &lt;-<span class="st"> </span><span class="fl">5.06</span></a>
<a class="sourceLine" id="cb1191-26" data-line-number="26">  lnWtFsd1 &lt;-<span class="st"> </span><span class="fl">0.24</span></a>
<a class="sourceLine" id="cb1191-27" data-line-number="27">  Frho1    &lt;-<span class="st"> </span><span class="fl">0.41</span></a>
<a class="sourceLine" id="cb1191-28" data-line-number="28">  prop1    &lt;-<span class="st"> </span><span class="fl">0.46</span></a>
<a class="sourceLine" id="cb1191-29" data-line-number="29">  Fmean1   &lt;-<span class="st"> </span><span class="kw">c</span>(HtFmu1, lnWtFmu1)</a>
<a class="sourceLine" id="cb1191-30" data-line-number="30">  Fsigma1  &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(HtFsd1<span class="op">^</span><span class="dv">2</span>, Frho1 <span class="op">*</span><span class="st"> </span>HtFsd1 <span class="op">*</span><span class="st"> </span>lnWtFsd1,</a>
<a class="sourceLine" id="cb1191-31" data-line-number="31">                       Frho1 <span class="op">*</span><span class="st"> </span>HtFsd1 <span class="op">*</span><span class="st"> </span>lnWtFsd1, lnWtFsd1<span class="op">^</span><span class="dv">2</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1191-32" data-line-number="32">  <span class="co"># Women cluster 2:</span></a>
<a class="sourceLine" id="cb1191-33" data-line-number="33">  HtFmu2   &lt;-<span class="st"> </span><span class="fl">64.36</span></a>
<a class="sourceLine" id="cb1191-34" data-line-number="34">  HtFsd2   &lt;-<span class="st"> </span><span class="fl">2.49</span></a>
<a class="sourceLine" id="cb1191-35" data-line-number="35">  lnWtFmu2 &lt;-<span class="st"> </span><span class="fl">4.86</span></a>
<a class="sourceLine" id="cb1191-36" data-line-number="36">  lnWtFsd2 &lt;-<span class="st"> </span><span class="fl">0.14</span></a>
<a class="sourceLine" id="cb1191-37" data-line-number="37">  Frho2    &lt;-<span class="st"> </span><span class="fl">0.44</span></a>
<a class="sourceLine" id="cb1191-38" data-line-number="38">  prop2    &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prop1</a>
<a class="sourceLine" id="cb1191-39" data-line-number="39">  Fmean2   &lt;-<span class="st"> </span><span class="kw">c</span>(HtFmu2, lnWtFmu2)</a>
<a class="sourceLine" id="cb1191-40" data-line-number="40">  Fsigma2  &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(HtFsd2<span class="op">^</span><span class="dv">2</span>, Frho2 <span class="op">*</span><span class="st"> </span>HtFsd2 <span class="op">*</span><span class="st"> </span>lnWtFsd2,</a>
<a class="sourceLine" id="cb1191-41" data-line-number="41">                       Frho2 <span class="op">*</span><span class="st"> </span>HtFsd2 <span class="op">*</span><span class="st"> </span>lnWtFsd2, lnWtFsd2<span class="op">^</span><span class="dv">2</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1191-42" data-line-number="42">  </a>
<a class="sourceLine" id="cb1191-43" data-line-number="43">  <span class="co"># Randomly generate data values from those MVN distributions.</span></a>
<a class="sourceLine" id="cb1191-44" data-line-number="44">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(rndsd)) {<span class="kw">set.seed</span>(rndsd)}</a>
<a class="sourceLine" id="cb1191-45" data-line-number="45">  datamatrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow =</span> nSubj, <span class="dt">ncol =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb1191-46" data-line-number="46">  <span class="kw">colnames</span>(datamatrix) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;height&quot;</span>, <span class="st">&quot;weight&quot;</span>)</a>
<a class="sourceLine" id="cb1191-47" data-line-number="47">  maleval &lt;-<span class="st"> </span><span class="dv">1</span>; femaleval &lt;-<span class="st"> </span><span class="dv">0</span> <span class="co"># arbitrary coding values</span></a>
<a class="sourceLine" id="cb1191-48" data-line-number="48">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nSubj)  {</a>
<a class="sourceLine" id="cb1191-49" data-line-number="49">    <span class="co"># Flip coin to decide sex</span></a>
<a class="sourceLine" id="cb1191-50" data-line-number="50">    sex &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(maleval, femaleval), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb1191-51" data-line-number="51">                  <span class="dt">prob =</span> <span class="kw">c</span>(maleProb, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>maleProb))</a>
<a class="sourceLine" id="cb1191-52" data-line-number="52">    <span class="cf">if</span> (sex <span class="op">==</span><span class="st"> </span>maleval) {datum =<span class="st"> </span>MASS<span class="op">::</span><span class="kw">mvrnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">mu =</span> Mmean, <span class="dt">Sigma =</span> Msigma)}</a>
<a class="sourceLine" id="cb1191-53" data-line-number="53">    <span class="cf">if</span> (sex <span class="op">==</span><span class="st"> </span>femaleval) {</a>
<a class="sourceLine" id="cb1191-54" data-line-number="54">      Fclust =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(prop1, prop2))</a>
<a class="sourceLine" id="cb1191-55" data-line-number="55">      <span class="cf">if</span> (Fclust <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {datum =<span class="st"> </span>MASS<span class="op">::</span><span class="kw">mvrnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">mu =</span> Fmean1, <span class="dt">Sigma =</span> Fsigma1)}</a>
<a class="sourceLine" id="cb1191-56" data-line-number="56">      <span class="cf">if</span> (Fclust <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) {datum =<span class="st"> </span>MASS<span class="op">::</span><span class="kw">mvrnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">mu =</span> Fmean2, <span class="dt">Sigma =</span> Fsigma2)}</a>
<a class="sourceLine" id="cb1191-57" data-line-number="57">    }</a>
<a class="sourceLine" id="cb1191-58" data-line-number="58">    datamatrix[i, ] =<span class="st"> </span><span class="kw">c</span>(sex, <span class="kw">round</span>(<span class="kw">c</span>(datum[<span class="dv">1</span>], <span class="kw">exp</span>(datum[<span class="dv">2</span>])), <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1191-59" data-line-number="59">  }</a>
<a class="sourceLine" id="cb1191-60" data-line-number="60">  </a>
<a class="sourceLine" id="cb1191-61" data-line-number="61">  <span class="kw">return</span>(datamatrix)</a>
<a class="sourceLine" id="cb1191-62" data-line-number="62">} <span class="co"># end function</span></a></code></pre></div>
<p>Let’s take this baby for a spin to simulate our data.</p>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1192-1" data-line-number="1">d &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1192-2" data-line-number="2"><span class="st">  </span><span class="kw">HtWtDataGenerator</span>(<span class="dt">nSubj =</span> <span class="dv">300</span>, <span class="dt">rndsd =</span> <span class="dv">17</span>, <span class="dt">maleProb =</span> <span class="fl">.50</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1192-3" data-line-number="3"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1192-4" data-line-number="4"><span class="st">  </span><span class="co"># this will allow us to subset 30 of the values into their own group</span></a>
<a class="sourceLine" id="cb1192-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">subset =</span> <span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">times =</span> <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(., <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb1192-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1192-7" data-line-number="7"><span class="kw">head</span>(d)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##    male height weight subset
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;int&gt;
## 1     0   63.3   167.      0
## 2     0   62.4   126.      0
## 3     1   66.4   124       0
## 4     0   62.9   148.      0
## 5     1   65.5   151.      0
## 6     1   71.4   234.      0</code></pre>
<blockquote>
<p>Fortunately, we do not have to worry much about analytical derivations because we can let JAGS or Stan generate a high resolution picture of the posterior distribution. Our job, therefore, is to specify sensible priors and to make sure that the MCMC process generates a trustworthy posterior sample that is converged and well mixed. (p. 483)</p>
</blockquote>
<div id="robust-linear-regression-in-jags-brms." class="section level3">
<h3><span class="header-section-number">17.2.1</span> Robust linear regression in <del>JAGS</del> brms.</h3>
<p>Presuming a data set with a sole standardized predictor <code>x_z</code> for a sole standardized criterion <code>y_z</code>, the basic <strong>brms</strong> code corresponding to the JAGS code Kruschke showed on page 483 looks like this.</p>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1194-1" data-line-number="1">fit1 &lt;-</a>
<a class="sourceLine" id="cb1194-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb1194-3" data-line-number="3">      <span class="dt">family =</span> student,</a>
<a class="sourceLine" id="cb1194-4" data-line-number="4">      y_z <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x_z,</a>
<a class="sourceLine" id="cb1194-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1194-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1194-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb1194-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">exponential</span>(one_over_twentynine), <span class="dt">class =</span> nu)),</a>
<a class="sourceLine" id="cb1194-9" data-line-number="9">      <span class="dt">stanvars =</span> <span class="kw">stanvar</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">29</span>, <span class="dt">name =</span> <span class="st">&quot;one_over_twentynine&quot;</span>))</a></code></pre></div>
<p>Like we discussed in Chapter 16, we won’t be using the uniform prior for <span class="math inline">\(\sigma\)</span>. Since we’re presuming standardized data, a half-unit normal is a fine choice. But do note this is much tighter than Kruschke’s <span class="math inline">\(\operatorname{uniform} (0.001, 1000)\)</span> and it will have down-the-road consequences for our results versus those in the text.</p>
<p>Also, look at how we just pumped the definition of our sole <code>stanvar(1/29, name = &quot;one_over_twentynine&quot;)</code> operation right into the <code>stanvar</code> argument. If we were defining multiple values this way, I’d prefer to save this as an object first and then just pump that object into <code>stanvars</code>. But in this case, it was simple enough to just throw directly into the <code>brm()</code> function.</p>
<div id="standardizing-the-data-for-mcmc-sampling." class="section level4">
<h4><span class="header-section-number">17.2.1.1</span> Standardizing the data for MCMC sampling.</h4>
<p>Kruschke mentioned how standardizing your data before feeding it into JAGS often helps the algorithm operate smoothly. The same basic principle holds for <strong>brms</strong> and Stan. Stan can often handle unstandardized data just fine. But if you ever run into estimation difficulties, consider standardizing your data and trying again.</p>
<p>We’ll make a simple function to standardize the <code>height</code> and <code>weight</code> values.</p>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1195-1" data-line-number="1">standardize &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1195-2" data-line-number="2">  (x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(x)</a>
<a class="sourceLine" id="cb1195-3" data-line-number="3">  }</a>
<a class="sourceLine" id="cb1195-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1195-5" data-line-number="5">d &lt;-</a>
<a class="sourceLine" id="cb1195-6" data-line-number="6"><span class="st">  </span>d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1195-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height_z =</span> <span class="kw">standardize</span>(height),</a>
<a class="sourceLine" id="cb1195-8" data-line-number="8">         <span class="dt">weight_z =</span> <span class="kw">standardize</span>(weight))</a></code></pre></div>
<p>Somewhat analogous to how Kruschke standardized his data within the JAGS code, you could standardize the data within the <code>brm()</code> function. That would look something like this.</p>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1196-1" data-line-number="1">fit1 &lt;-</a>
<a class="sourceLine" id="cb1196-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># the standardizing occurs in the next two lines</span></a>
<a class="sourceLine" id="cb1196-3" data-line-number="3"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">height_z =</span> <span class="kw">standardize</span>(height),</a>
<a class="sourceLine" id="cb1196-4" data-line-number="4">               <span class="dt">weight_z =</span> <span class="kw">standardize</span>(weight)),</a>
<a class="sourceLine" id="cb1196-5" data-line-number="5">      <span class="dt">family =</span> student,</a>
<a class="sourceLine" id="cb1196-6" data-line-number="6">      weight_z <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>height_z,</a>
<a class="sourceLine" id="cb1196-7" data-line-number="7">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1196-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1196-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb1196-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">exponential</span>(one_over_twentynine), <span class="dt">class =</span> nu)),</a>
<a class="sourceLine" id="cb1196-11" data-line-number="11">      <span class="dt">stanvars =</span> <span class="kw">stanvar</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">29</span>, <span class="dt">name =</span> <span class="st">&quot;one_over_twentynine&quot;</span>))</a></code></pre></div>
<p>But anyway, let’s open <strong>brms</strong>.</p>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1197-1" data-line-number="1"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>We’ll fit the two models at once. <code>fit1</code> will be of the total data sample. <code>fit2</code> is of the <span class="math inline">\(n = 30\)</span> subset.</p>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1198-1" data-line-number="1">fit1 &lt;-</a>
<a class="sourceLine" id="cb1198-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d,</a>
<a class="sourceLine" id="cb1198-3" data-line-number="3">      <span class="dt">family =</span> student,</a>
<a class="sourceLine" id="cb1198-4" data-line-number="4">      weight_z <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>height_z,</a>
<a class="sourceLine" id="cb1198-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1198-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1198-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb1198-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">exponential</span>(one_over_twentynine), <span class="dt">class =</span> nu)),</a>
<a class="sourceLine" id="cb1198-9" data-line-number="9">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1198-10" data-line-number="10">      <span class="dt">stanvars =</span> <span class="kw">stanvar</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">29</span>, <span class="dt">name =</span> <span class="st">&quot;one_over_twentynine&quot;</span>),</a>
<a class="sourceLine" id="cb1198-11" data-line-number="11">      <span class="dt">seed =</span> <span class="dv">17</span>)</a>
<a class="sourceLine" id="cb1198-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1198-13" data-line-number="13">fit2 &lt;-</a>
<a class="sourceLine" id="cb1198-14" data-line-number="14"><span class="st">  </span><span class="kw">update</span>(fit1,</a>
<a class="sourceLine" id="cb1198-15" data-line-number="15">         <span class="dt">newdata =</span> d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1198-16" data-line-number="16"><span class="st">           </span><span class="kw">filter</span>(subset <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1198-17" data-line-number="17">         <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1198-18" data-line-number="18">         <span class="dt">seed =</span> <span class="dv">17</span>)</a></code></pre></div>
<p>Here are the results.</p>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1199-1" data-line-number="1"><span class="kw">print</span>(fit1)</a></code></pre></div>
<pre><code>##  Family: student 
##   Links: mu = identity; sigma = identity; nu = identity 
## Formula: weight_z ~ 1 + height_z 
##    Data: d (Number of observations: 300) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.03      0.05    -0.13     0.08 1.00     3803     2730
## height_z      0.45      0.05     0.35     0.56 1.00     3482     2259
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.85      0.05     0.75     0.94 1.00     3206     2704
## nu       25.60     21.67     6.31    86.62 1.00     2919     2543
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1201-1" data-line-number="1"><span class="kw">print</span>(fit2)</a></code></pre></div>
<pre><code>##  Family: student 
##   Links: mu = identity; sigma = identity; nu = identity 
## Formula: weight_z ~ 1 + height_z 
##    Data: d %&gt;% filter(subset == 1) (Number of observations: 30) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.11      0.12    -0.34     0.12 1.00     4038     2686
## height_z      0.61      0.11     0.39     0.82 1.00     4173     2589
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.64      0.09     0.48     0.84 1.00     3622     2528
## nu       39.57     30.75     5.84   119.87 1.00     4129     2872
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Based on Kruschke’s Equation 17.2, we can convert the standardized coefficients back to their original metric using the formulas</p>
<p><span class="math display">\[\begin{align*}
\beta_0 &amp; = \zeta_0 \operatorname{SD}_y + M_y - \frac{\zeta_1 M_x \operatorname{SD}_y}{\operatorname{SD}_x} \;\; \text{and}  \\
\beta_1 &amp; = \frac{\zeta_1 \operatorname{SD}_y}{\operatorname{SD}_x},
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\zeta_0\)</span> and <span class="math inline">\(\zeta_1\)</span> denote the intercept and slope for the model of the standardized data, respectively, and that model follows the familiar form</p>
<p><span class="math display">\[z_{\hat y} = \zeta_0 + \zeta_1 z_x.\]</span></p>
<p>To implement those equations, we’ll first extract the posterior samples. We’ll begin with <code>fit1</code>, the model for which <span class="math inline">\(N = 300\)</span>.</p>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1203-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(fit1)</a>
<a class="sourceLine" id="cb1203-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1203-3" data-line-number="3"><span class="kw">head</span>(post)</a></code></pre></div>
<pre><code>##    b_Intercept b_height_z     sigma       nu      lp__
## 1 -0.008565966  0.4506511 0.9079515 29.13748 -401.0110
## 2 -0.044204302  0.4281183 0.7970452 31.07005 -402.4087
## 3 -0.105379516  0.4123081 0.8323686 14.74480 -401.5056
## 4 -0.153969750  0.3571412 0.8509155 14.65994 -404.8230
## 5 -0.125288079  0.3651884 0.8242179 18.03175 -403.6745
## 6 -0.129856036  0.4115427 0.8529961 19.64789 -402.5184</code></pre>
<p>Let’s wrap the consequences of Equation 17.2 into two functions.</p>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1205-1" data-line-number="1">make_beta_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="cf">function</span>(zeta_<span class="dv">0</span>, zeta_<span class="dv">1</span>, sd_x, sd_y, m_x, m_y) {</a>
<a class="sourceLine" id="cb1205-2" data-line-number="2">  zeta_<span class="dv">0</span> <span class="op">*</span><span class="st"> </span>sd_y <span class="op">+</span><span class="st"> </span>m_y <span class="op">-</span><span class="st"> </span>zeta_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>m_x <span class="op">*</span><span class="st"> </span>sd_y <span class="op">/</span><span class="st"> </span>sd_x</a>
<a class="sourceLine" id="cb1205-3" data-line-number="3">  }</a>
<a class="sourceLine" id="cb1205-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1205-5" data-line-number="5">make_beta_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="cf">function</span>(zeta_<span class="dv">1</span>, sd_x, sd_y) {</a>
<a class="sourceLine" id="cb1205-6" data-line-number="6">  zeta_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>sd_y <span class="op">/</span><span class="st"> </span>sd_x</a>
<a class="sourceLine" id="cb1205-7" data-line-number="7">  }</a></code></pre></div>
<p>After saving a few values, we’re ready to use our custom functions to convert our posteriors for <code>b_Intercept</code> and <code>b_height_z</code> to their natural metric.</p>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1206-1" data-line-number="1">sd_x &lt;-<span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>height)</a>
<a class="sourceLine" id="cb1206-2" data-line-number="2">sd_y &lt;-<span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>weight)</a>
<a class="sourceLine" id="cb1206-3" data-line-number="3">m_x  &lt;-<span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>height)</a>
<a class="sourceLine" id="cb1206-4" data-line-number="4">m_y  &lt;-<span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>weight)</a>
<a class="sourceLine" id="cb1206-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1206-6" data-line-number="6">post &lt;-</a>
<a class="sourceLine" id="cb1206-7" data-line-number="7"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1206-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">b_0 =</span> <span class="kw">make_beta_0</span>(<span class="dt">zeta_0 =</span> b_Intercept,</a>
<a class="sourceLine" id="cb1206-9" data-line-number="9">                           <span class="dt">zeta_1 =</span> b_height_z,</a>
<a class="sourceLine" id="cb1206-10" data-line-number="10">                           <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1206-11" data-line-number="11">                           <span class="dt">sd_y   =</span> sd_y,</a>
<a class="sourceLine" id="cb1206-12" data-line-number="12">                           <span class="dt">m_x    =</span> m_x,</a>
<a class="sourceLine" id="cb1206-13" data-line-number="13">                           <span class="dt">m_y    =</span> m_y),</a>
<a class="sourceLine" id="cb1206-14" data-line-number="14">         <span class="dt">b_1 =</span> <span class="kw">make_beta_1</span>(<span class="dt">zeta_1 =</span> b_height_z,</a>
<a class="sourceLine" id="cb1206-15" data-line-number="15">                           <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1206-16" data-line-number="16">                           <span class="dt">sd_y   =</span> sd_y))</a>
<a class="sourceLine" id="cb1206-17" data-line-number="17"></a>
<a class="sourceLine" id="cb1206-18" data-line-number="18"><span class="kw">glimpse</span>(post)</a></code></pre></div>
<pre><code>## Observations: 4,000
## Variables: 7
## $ b_Intercept &lt;dbl&gt; -0.0085659663, -0.0442043023, -0.1053795163, -0.1539697497, -0.1252880790, -0…
## $ b_height_z  &lt;dbl&gt; 0.4506511, 0.4281183, 0.4123081, 0.3571412, 0.3651884, 0.4115427, 0.4193145, …
## $ sigma       &lt;dbl&gt; 0.9079515, 0.7970452, 0.8323686, 0.8509155, 0.8242179, 0.8529961, 0.8232428, …
## $ nu          &lt;dbl&gt; 29.137481, 31.070051, 14.744799, 14.659941, 18.031749, 19.647894, 11.043079, …
## $ lp__        &lt;dbl&gt; -401.0110, -402.4087, -401.5056, -404.8230, -403.6745, -402.5184, -400.9171, …
## $ b_0         &lt;dbl&gt; -117.61990, -104.89450, -97.21419, -64.72410, -68.71807, -97.58500, -100.6906…
## $ b_1         &lt;dbl&gt; 4.182206, 3.973094, 3.826369, 3.314400, 3.389081, 3.819266, 3.891391, 4.52945…</code></pre>
<p>Now we’re finally ready to make the top panel of Figure 17.4.</p>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1208-1" data-line-number="1"><span class="co"># how many posterior lines would you like?</span></a>
<a class="sourceLine" id="cb1208-2" data-line-number="2">n_lines &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb1208-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1208-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1208-5" data-line-number="5">       <span class="kw">aes</span>(<span class="dt">x =</span> height, <span class="dt">y =</span> weight)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> post[<span class="dv">1</span><span class="op">:</span>n_lines, <span class="st">&quot;b_0&quot;</span>], </a>
<a class="sourceLine" id="cb1208-7" data-line-number="7">              <span class="dt">slope =</span> post[<span class="dv">1</span><span class="op">:</span>n_lines, <span class="st">&quot;b_1&quot;</span>],</a>
<a class="sourceLine" id="cb1208-8" data-line-number="8">              <span class="dt">color =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-10" data-line-number="10"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">50</span><span class="op">:</span><span class="dv">80</span>,</a>
<a class="sourceLine" id="cb1208-11" data-line-number="11">                  <span class="dt">ylim =</span> <span class="dv">-50</span><span class="op">:</span><span class="dv">470</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">eval</span>(<span class="kw">substitute</span>(<span class="kw">paste</span>(<span class="st">&quot;Data with&quot;</span>, </a>
<a class="sourceLine" id="cb1208-13" data-line-number="13">                                        n_lines, </a>
<a class="sourceLine" id="cb1208-14" data-line-number="14">                                        <span class="st">&quot;credible regression lines&quot;</span>))),</a>
<a class="sourceLine" id="cb1208-15" data-line-number="15">       <span class="dt">x =</span> <span class="st">&quot;height&quot;</span>,</a>
<a class="sourceLine" id="cb1208-16" data-line-number="16">       <span class="dt">y =</span> <span class="st">&quot;weight&quot;</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-15-1.png" /><!-- --></p>
<p>We’ll want to open the <strong>tidybayes</strong> package to help make the histograms.</p>
<div class="sourceCode" id="cb1209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1209-1" data-line-number="1"><span class="kw">library</span>(tidybayes)</a>
<a class="sourceLine" id="cb1209-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1209-3" data-line-number="3"><span class="co"># we&#39;ll use this to mark off the ROPEs as white strips in the background</span></a>
<a class="sourceLine" id="cb1209-4" data-line-number="4">rope &lt;-</a>
<a class="sourceLine" id="cb1209-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">key  =</span> <span class="st">&quot;Slope&quot;</span>, </a>
<a class="sourceLine" id="cb1209-6" data-line-number="6">         <span class="dt">xmin =</span> <span class="fl">-.5</span>,</a>
<a class="sourceLine" id="cb1209-7" data-line-number="7">         <span class="dt">xmax =</span> <span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb1209-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1209-9" data-line-number="9"><span class="co"># here are the primary data</span></a>
<a class="sourceLine" id="cb1209-10" data-line-number="10">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1209-11" data-line-number="11"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Intercept =</span> b_<span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1209-12" data-line-number="12">            <span class="dt">Slope     =</span> b_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1209-13" data-line-number="13">            <span class="dt">Scale     =</span> sigma <span class="op">*</span><span class="st"> </span>sd_y,</a>
<a class="sourceLine" id="cb1209-14" data-line-number="14">            <span class="dt">Normality =</span> nu <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">log10</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1209-15" data-line-number="15"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1209-16" data-line-number="16"><span class="st">  </span></a>
<a class="sourceLine" id="cb1209-17" data-line-number="17"><span class="st">  </span><span class="co"># the plot</span></a>
<a class="sourceLine" id="cb1209-18" data-line-number="18"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1209-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> rope,</a>
<a class="sourceLine" id="cb1209-20" data-line-number="20">            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, <span class="dt">xmax =</span> xmax,</a>
<a class="sourceLine" id="cb1209-21" data-line-number="21">                <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb1209-22" data-line-number="22">            <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1209-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value),</a>
<a class="sourceLine" id="cb1209-24" data-line-number="24">                 <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>,</a>
<a class="sourceLine" id="cb1209-25" data-line-number="25">                 <span class="dt">size =</span> <span class="fl">.2</span>, <span class="dt">bins =</span> <span class="dv">40</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1209-26" data-line-number="26"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb1209-27" data-line-number="27">                      <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1209-28" data-line-number="28"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1209-29" data-line-number="29"><span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1209-30" data-line-number="30"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-16-1.png" /><!-- --></p>
<p>Here’s the scatter plot for the slope and intercept.</p>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1210-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1210-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_<span class="dv">1</span>, <span class="dt">y =</span> b_<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1210-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey56&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1210-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(beta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb1210-5" data-line-number="5">       <span class="dt">y =</span> <span class="kw">expression</span>(beta[<span class="dv">0</span>]))</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-17-1.png" /><!-- --></p>
<p>That is one strong correlation! Finally, here’s the scatter plot for <span class="math inline">\(\operatorname{log10}(\nu)\)</span> and <span class="math inline">\(\sigma_{\text{transformed back to its raw metric}}\)</span>.</p>
<div class="sourceCode" id="cb1211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1211-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1211-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Scale =</span> sigma <span class="op">*</span><span class="st"> </span>sd_y,</a>
<a class="sourceLine" id="cb1211-3" data-line-number="3">            <span class="dt">Normality =</span> nu <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">log10</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1211-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Normality, <span class="dt">y =</span> Scale)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1211-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey56&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1211-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(<span class="kw">log10</span>(nu)),</a>
<a class="sourceLine" id="cb1211-7" data-line-number="7">       <span class="dt">y =</span> <span class="kw">expression</span>(sigma))</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-18-1.png" /><!-- --></p>
<p>Let’s back track and make the plots for Figure 17.3 with <code>fit2</code>. We’ll need to extract the posterior samples and wrangle, as before.</p>
<div class="sourceCode" id="cb1212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1212-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(fit2)</a>
<a class="sourceLine" id="cb1212-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1212-3" data-line-number="3">post &lt;-</a>
<a class="sourceLine" id="cb1212-4" data-line-number="4"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1212-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">b_0 =</span> <span class="kw">make_beta_0</span>(<span class="dt">zeta_0 =</span> b_Intercept,</a>
<a class="sourceLine" id="cb1212-6" data-line-number="6">                           <span class="dt">zeta_1 =</span> b_height_z,</a>
<a class="sourceLine" id="cb1212-7" data-line-number="7">                           <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1212-8" data-line-number="8">                           <span class="dt">sd_y   =</span> sd_y,</a>
<a class="sourceLine" id="cb1212-9" data-line-number="9">                           <span class="dt">m_x    =</span> m_x,</a>
<a class="sourceLine" id="cb1212-10" data-line-number="10">                           <span class="dt">m_y    =</span> m_y),</a>
<a class="sourceLine" id="cb1212-11" data-line-number="11">         <span class="dt">b_1 =</span> <span class="kw">make_beta_1</span>(<span class="dt">zeta_1 =</span> b_height_z,</a>
<a class="sourceLine" id="cb1212-12" data-line-number="12">                           <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1212-13" data-line-number="13">                           <span class="dt">sd_y   =</span> sd_y))</a>
<a class="sourceLine" id="cb1212-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1212-15" data-line-number="15"><span class="kw">glimpse</span>(post)</a></code></pre></div>
<pre><code>## Observations: 4,000
## Variables: 7
## $ b_Intercept &lt;dbl&gt; -0.15966043, -0.05963733, -0.10287799, -0.08226864, 0.08219908, -0.26932327, …
## $ b_height_z  &lt;dbl&gt; 0.6156750, 0.4158976, 0.4348758, 0.7235308, 0.6377568, 0.6681059, 0.4613149, …
## $ sigma       &lt;dbl&gt; 0.6158242, 0.6801605, 0.6325821, 0.4960271, 0.4937104, 0.6232176, 0.5654167, …
## $ nu          &lt;dbl&gt; 29.243356, 31.527094, 20.264225, 23.611639, 12.533737, 11.569457, 33.638157, …
## $ lp__        &lt;dbl&gt; -36.11596, -38.05293, -37.72598, -38.17854, -39.75470, -37.86057, -38.74105, …
## $ b_0         &lt;dbl&gt; -225.04181, -97.85839, -111.10497, -289.17023, -230.36964, -261.29985, -121.4…
## $ b_1         &lt;dbl&gt; 5.713688, 3.859681, 4.035805, 6.714629, 5.918615, 6.200266, 4.281170, 6.41192…</code></pre>
<p>Here’s the top panel of Figure 17.3.</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1214-1" data-line-number="1"><span class="co"># how many posterior lines would you like?</span></a>
<a class="sourceLine" id="cb1214-2" data-line-number="2">n_lines &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb1214-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1214-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="dt">data =</span> d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1214-5" data-line-number="5"><span class="st">         </span><span class="kw">filter</span>(subset <span class="op">==</span><span class="st"> </span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb1214-6" data-line-number="6">       <span class="kw">aes</span>(<span class="dt">x =</span> height, <span class="dt">y =</span> weight)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1214-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1214-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> post[<span class="dv">1</span><span class="op">:</span>n_lines, <span class="st">&quot;b_0&quot;</span>], </a>
<a class="sourceLine" id="cb1214-9" data-line-number="9">              <span class="dt">slope =</span> post[<span class="dv">1</span><span class="op">:</span>n_lines, <span class="st">&quot;b_1&quot;</span>],</a>
<a class="sourceLine" id="cb1214-10" data-line-number="10">              <span class="dt">color =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1214-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1214-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">-300</span>, <span class="dt">to =</span> <span class="dv">200</span>, <span class="dt">by =</span> <span class="dv">100</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1214-13" data-line-number="13"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">80</span>,</a>
<a class="sourceLine" id="cb1214-14" data-line-number="14">                  <span class="dt">ylim =</span> <span class="dv">-350</span><span class="op">:</span><span class="dv">250</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1214-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">eval</span>(<span class="kw">substitute</span>(<span class="kw">paste</span>(<span class="st">&quot;Data with&quot;</span>, </a>
<a class="sourceLine" id="cb1214-16" data-line-number="16">                                        n_lines, </a>
<a class="sourceLine" id="cb1214-17" data-line-number="17">                                        <span class="st">&quot;credible regression lines&quot;</span>))),</a>
<a class="sourceLine" id="cb1214-18" data-line-number="18">       <span class="dt">x =</span> <span class="st">&quot;height&quot;</span>,</a>
<a class="sourceLine" id="cb1214-19" data-line-number="19">       <span class="dt">y =</span> <span class="st">&quot;weight&quot;</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-20-1.png" /><!-- --></p>
<p>Next we’ll make the histograms.</p>
<div class="sourceCode" id="cb1215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1215-1" data-line-number="1"><span class="co"># here are the primary data</span></a>
<a class="sourceLine" id="cb1215-2" data-line-number="2">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1215-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Intercept =</span> b_<span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1215-4" data-line-number="4">            <span class="dt">Slope     =</span> b_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1215-5" data-line-number="5">            <span class="dt">Scale     =</span> sigma <span class="op">*</span><span class="st"> </span>sd_y,</a>
<a class="sourceLine" id="cb1215-6" data-line-number="6">            <span class="dt">Normality =</span> nu <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">log10</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1215-7" data-line-number="7"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1215-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb1215-9" data-line-number="9"><span class="st">  </span><span class="co"># the plot</span></a>
<a class="sourceLine" id="cb1215-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1215-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> rope,</a>
<a class="sourceLine" id="cb1215-12" data-line-number="12">            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, <span class="dt">xmax =</span> xmax,</a>
<a class="sourceLine" id="cb1215-13" data-line-number="13">                <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb1215-14" data-line-number="14">            <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1215-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value),</a>
<a class="sourceLine" id="cb1215-16" data-line-number="16">                 <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>,</a>
<a class="sourceLine" id="cb1215-17" data-line-number="17">                 <span class="dt">size =</span> <span class="fl">.2</span>, <span class="dt">bins =</span> <span class="dv">40</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1215-18" data-line-number="18"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb1215-19" data-line-number="19">                      <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1215-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1215-21" data-line-number="21"><span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1215-22" data-line-number="22"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-21-1.png" /><!-- --></p>
<p>And we’ll finish up with the scatter plots.</p>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1216-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1216-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_<span class="dv">1</span>, <span class="dt">y =</span> b_<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1216-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey56&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1216-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(beta[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb1216-5" data-line-number="5">       <span class="dt">y =</span> <span class="kw">expression</span>(beta[<span class="dv">0</span>]))</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-22-1.png" /><!-- --></p>
<div class="sourceCode" id="cb1217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1217-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1217-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Scale =</span> sigma <span class="op">*</span><span class="st"> </span>sd_y,</a>
<a class="sourceLine" id="cb1217-3" data-line-number="3">            <span class="dt">Normality =</span> nu <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">log10</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1217-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Normality, <span class="dt">y =</span> Scale)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1217-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey56&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1217-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(<span class="kw">log10</span>(nu)),</a>
<a class="sourceLine" id="cb1217-7" data-line-number="7">       <span class="dt">y =</span> <span class="kw">expression</span>(sigma))</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-22-2.png" /><!-- --></p>
</div>
</div>
<div id="robust-linear-regression-in-stan." class="section level3">
<h3><span class="header-section-number">17.2.2</span> Robust linear regression in Stan.</h3>
<blockquote>
<p>Recall from Section 14.1 (p. 400) that Stan uses Hamiltonian dynamics to find proposed positions in parameter space. The trajectories use the gradient of the posterior distribution to move large distances even in narrow distributions. Thus, HMC by itself, without data standardization, should be able to efficiently generate a representative sample from the posterior distribution. (p. 487)</p>
</blockquote>
<p>To be clear, we’re going to fit the models with Stan/<strong>brms</strong> twice. Above, we used the standardized data like Kruschke did with his JAGS code. Now we’re getting ready to follow along with the text and use Stan/<strong>brms</strong> to fit the models with the unstandardized data.</p>
<div id="constants-for-vague-priors." class="section level4">
<h4><span class="header-section-number">17.2.2.1</span> Constants for vague priors.</h4>
<p>It’s worth repeating a large portion of Kruschke’s second paragraph:</p>
<blockquote>
<p>A regression slope can take on a maximum value of <span class="math inline">\(\operatorname{SD}_y / \operatorname{SD}_x\)</span> for data that are perfectly correlated. Therefore, the prior on the slope will be given a standard deviation that is large compared to that maximum. The biggest that an intercept could be, for data that are perfectly correlated, is <span class="math inline">\(M_x \operatorname{SD}_y / \operatorname{SD}_x\)</span>. Therefore, the prior on the intercept will have a standard deviation that is large compared to that maximum. (p. 487)</p>
</blockquote>
<p>With that in mind, we’ll specify our <code>stanvars</code> as follows:</p>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1218-1" data-line-number="1">beta_<span class="dv">0</span>_sigma &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="kw">abs</span>(m_x <span class="op">*</span><span class="st"> </span>sd_y <span class="op">/</span><span class="st"> </span>sd_x)</a>
<a class="sourceLine" id="cb1218-2" data-line-number="2">beta_<span class="dv">1</span>_sigma &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="kw">abs</span>(sd_y <span class="op">/</span><span class="st"> </span>sd_x) </a>
<a class="sourceLine" id="cb1218-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1218-4" data-line-number="4">stanvars &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1218-5" data-line-number="5"><span class="st">  </span><span class="kw">stanvar</span>(beta_<span class="dv">0</span>_sigma, <span class="dt">name =</span> <span class="st">&quot;beta_0_sigma&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1218-6" data-line-number="6"><span class="st">  </span><span class="kw">stanvar</span>(beta_<span class="dv">1</span>_sigma, <span class="dt">name =</span> <span class="st">&quot;beta_1_sigma&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1218-7" data-line-number="7"><span class="st">  </span><span class="kw">stanvar</span>(sd_y, <span class="dt">name =</span> <span class="st">&quot;sd_y&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1218-8" data-line-number="8"><span class="st">  </span><span class="kw">stanvar</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">29</span>, <span class="dt">name =</span> <span class="st">&quot;one_over_twentynine&quot;</span>)</a></code></pre></div>
<p>As in Chapter 16, “set the priors to be extremely broad relative to the data” (p. 487). With our <code>stanvars</code> saved, we’re ready to fit <code>fit3</code>.</p>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1219-1" data-line-number="1">fit3 &lt;-</a>
<a class="sourceLine" id="cb1219-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d,</a>
<a class="sourceLine" id="cb1219-3" data-line-number="3">      <span class="dt">family =</span> student,</a>
<a class="sourceLine" id="cb1219-4" data-line-number="4">      weight <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>height,</a>
<a class="sourceLine" id="cb1219-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, beta_<span class="dv">0</span>_sigma), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1219-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, beta_<span class="dv">1</span>_sigma), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1219-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, sd_y), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb1219-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">exponential</span>(one_over_twentynine), <span class="dt">class =</span> nu)),</a>
<a class="sourceLine" id="cb1219-9" data-line-number="9">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1219-10" data-line-number="10">      <span class="dt">stanvars =</span> stanvars,</a>
<a class="sourceLine" id="cb1219-11" data-line-number="11">      <span class="dt">seed =</span> <span class="dv">17</span>)</a></code></pre></div>
<p>Here’s the model summary.</p>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1220-1" data-line-number="1"><span class="kw">print</span>(fit3)</a></code></pre></div>
<pre><code>##  Family: student 
##   Links: mu = identity; sigma = identity; nu = identity 
## Formula: weight ~ 1 + height 
##    Data: d (Number of observations: 300) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept  -121.10     33.32  -186.82   -54.98 1.00     3348     2858
## height        4.22      0.50     3.24     5.20 1.00     3369     2816
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    29.08      1.76    25.58    32.36 1.00     2500     1920
## nu       25.37     21.47     6.20    84.33 1.00     2320     2473
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now compare the histograms for these posterior draws to those we made, above, from those <code>fit1</code>. You’ll see they’re quite similar.</p>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1222-1" data-line-number="1"><span class="co"># here are the primary data</span></a>
<a class="sourceLine" id="cb1222-2" data-line-number="2"><span class="kw">posterior_samples</span>(fit3) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1222-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Intercept =</span> b_Intercept,</a>
<a class="sourceLine" id="cb1222-4" data-line-number="4">            <span class="dt">Slope     =</span> b_height,</a>
<a class="sourceLine" id="cb1222-5" data-line-number="5">            <span class="dt">Scale     =</span> sigma,</a>
<a class="sourceLine" id="cb1222-6" data-line-number="6">            <span class="dt">Normality =</span> nu <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">log10</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1222-7" data-line-number="7"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1222-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb1222-9" data-line-number="9"><span class="st">  </span><span class="co"># the plot</span></a>
<a class="sourceLine" id="cb1222-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1222-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> rope,</a>
<a class="sourceLine" id="cb1222-12" data-line-number="12">            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, <span class="dt">xmax =</span> xmax,</a>
<a class="sourceLine" id="cb1222-13" data-line-number="13">                <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb1222-14" data-line-number="14">            <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1222-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value),</a>
<a class="sourceLine" id="cb1222-16" data-line-number="16">                 <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>,</a>
<a class="sourceLine" id="cb1222-17" data-line-number="17">                 <span class="dt">size =</span> <span class="fl">.2</span>, <span class="dt">bins =</span> <span class="dv">40</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1222-18" data-line-number="18"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb1222-19" data-line-number="19">                      <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1222-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1222-21" data-line-number="21"><span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1222-22" data-line-number="22"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-25-1.png" /><!-- --></p>
</div>
</div>
<div id="stan-or-jags" class="section level3">
<h3><span class="header-section-number">17.2.3</span> Stan or JAGS?</h3>
<p>In this project we only fit the models with <strong>brms</strong>, which uses Stan under the hood. But since we fit the <span class="math inline">\(N = 300\)</span> model with both standardized and unstandardized data, we can compare their performance. For that, we’ll want <strong>bayesplot</strong>.</p>
<div class="sourceCode" id="cb1223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1223-1" data-line-number="1"><span class="kw">library</span>(bayesplot)</a></code></pre></div>
<p>They had equally impressive autocorrelation plots.</p>
<div class="sourceCode" id="cb1224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1224-1" data-line-number="1"><span class="kw">mcmc_acf</span>(<span class="kw">posterior_samples</span>(fit1), <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_height_z&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="st">&quot;nu&quot;</span>), <span class="dt">lags =</span> <span class="dv">10</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-27-1.png" /><!-- --></p>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1225-1" data-line-number="1"><span class="kw">mcmc_acf</span>(<span class="kw">posterior_samples</span>(fit3), <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_height&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="st">&quot;nu&quot;</span>), <span class="dt">lags =</span> <span class="dv">10</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-27-2.png" /><!-- --></p>
<p>Their <span class="math inline">\(N_{eff}/N\)</span> ratios were pretty similar. Both were reasonable. You’d probably want to run a simulation to contrast them with any rigor.</p>
<div class="sourceCode" id="cb1226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1226-1" data-line-number="1"><span class="kw">neff_ratio</span>(fit1) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1226-2" data-line-number="2"><span class="st">  </span><span class="kw">mcmc_neff</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1226-3" data-line-number="3"><span class="st">  </span><span class="kw">yaxis_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-28-1.png" /><!-- --></p>
<div class="sourceCode" id="cb1227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1227-1" data-line-number="1"><span class="kw">neff_ratio</span>(fit3) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1227-2" data-line-number="2"><span class="st">  </span><span class="kw">mcmc_neff</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1227-3" data-line-number="3"><span class="st">  </span><span class="kw">yaxis_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-28-2.png" /><!-- --></p>
</div>
<div id="interpreting-the-posterior-distribution." class="section level3">
<h3><span class="header-section-number">17.2.4</span> Interpreting the posterior distribution.</h3>
<p>Halfway through the prose, Kruschke mentioned how the models provide entire posteriors for the <code>weight</code> of a 50-inch-tall person. <strong>brms</strong> offers a few ways to do so.</p>
<blockquote>
<p>In some applications, there is interest in extrapolating or interpolating trends at <span class="math inline">\(x\)</span> values sparsely represented in the current data. For instance, we might want to predict the weight of a person who is 50 inches tall. A feature of Bayesian analysis is that we get an entire distribution of credible predicted values, not only a point estimate. (p. 489)</p>
</blockquote>
<p>Since this is such a simple model, one way is to work directly with the posterior samples. Here we use the model formula <span class="math inline">\(y_i = \beta_0 + \beta_1 x_i\)</span> by adding the transformed intercept <code>b_0</code> to the product of <span class="math inline">\(50\)</span> and the transformed coefficient for <code>height</code>, <code>b_1</code>.</p>
<div class="sourceCode" id="cb1228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1228-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1228-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight_at_50 =</span> b_<span class="dv">0</span> <span class="op">+</span><span class="st"> </span>b_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1228-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb1228-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> weight_at_<span class="dv">50</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1228-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>,</a>
<a class="sourceLine" id="cb1228-6" data-line-number="6">                 <span class="dt">size =</span> <span class="fl">.2</span>, <span class="dt">bins =</span> <span class="dv">40</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1228-7" data-line-number="7"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb1228-8" data-line-number="8">                      <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1228-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1228-10" data-line-number="10"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;lbs&quot;</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-29-1.png" /><!-- --></p>
<p>Looks pretty wide, doesn’t it? Hopefully this isn’t a surprise. Recall that this <code>post</code> is from <code>fit2</code>, the posterior based on the <span class="math inline">\(n = 30\)</span> data. With so few data, most predictions from that model are uncertain. But also, 50 inches is way out of the bounds of the data the model was based on, so we should be uncertain in this range.</p>
<p>Let’s practice a second method. With the <code>brms::fitted()</code> function, we can specify the desired <code>height</code> value into a tibble, which we’ll then feed into the <code>newdata</code> argument. Fitted will then return the model-implied criterion value for that predictor variable. To warm up, we’ll first to it with <code>fit3</code>, the model based on the untransformed data.</p>
<div class="sourceCode" id="cb1229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1229-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">height =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb1229-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1229-3" data-line-number="3"><span class="kw">fitted</span>(fit3,</a>
<a class="sourceLine" id="cb1229-4" data-line-number="4">       <span class="dt">newdata =</span> nd)</a></code></pre></div>
<pre><code>##      Estimate Est.Error     Q2.5    Q97.5
## [1,] 90.13275  8.579962 73.14503 107.2745</code></pre>
<p>The code returned a typical <strong>brms</strong>-style summary of the posterior mean, standard deviation, and 95% percentile-based intervals. The same basic method will work for the standardized models, <code>fit1</code> or <code>fit2</code>. But that will take a little more wrangling. First, we’ll need to transform our desired value 50 into its standardized version.</p>
<div class="sourceCode" id="cb1231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1231-1" data-line-number="1">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">height_z =</span> (<span class="dv">50</span> <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>height)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>height))</a></code></pre></div>
<p>When we feed this value into <code>fitted()</code>, it will return the corresponding posterior within the standardized metric. But we want unstandardized, so we’ll need to transform. That’ll be a few-step process. First, to do the transformation properly, we’ll want to work with the poster draws themselves, rather than summary values. So we’ll set <code>summary = F</code>. We’ll then convert the draws into a tibble format. Then we’ll use the <code>transmute()</code> function to do the conversion. In the final step, we’ll use <code>mean_qi()</code> to compute the summary values.</p>
<div class="sourceCode" id="cb1232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1232-1" data-line-number="1"><span class="kw">fitted</span>(fit1,</a>
<a class="sourceLine" id="cb1232-2" data-line-number="2">       <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1232-3" data-line-number="3">       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1232-4" data-line-number="4"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1232-5" data-line-number="5"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">weight =</span> V1 <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(d<span class="op">$</span>weight) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(d<span class="op">$</span>weight)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1232-6" data-line-number="6"><span class="st">  </span><span class="kw">mean_qi</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   weight .lower .upper .width .point .interval
##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1   90.5   73.7   107.   0.95 mean   qi</code></pre>
<p>If you look above, you’ll see the results are within rounding error of those from <code>fit3</code>.</p>
</div>
</div>
<div id="hierarchical-regression-on-individuals-within-groups" class="section level2">
<h2><span class="header-section-number">17.3</span> Hierarchical regression on individuals within groups</h2>
<blockquote>
<p>In the previous applications, the <span class="math inline">\(j\)</span>th individual contributed a single <span class="math inline">\(x_j, y_j\)</span> pair. But suppose instead that every individual, <span class="math inline">\(j\)</span>, contributes multiple observations of <span class="math inline">\(x_{i|j}, y_{i|j}\)</span> pairs. (The subscript notation <span class="math inline">\(i|j\)</span> means the <span class="math inline">\(i\)</span>th observation within the <span class="math inline">\(j\)</span>th individual.) With these data, we can estimate a regression curve for every individual. If we also assume that the individuals are mutually representative of a common group, then we can estimate group-level parameters too. (p. 490)</p>
</blockquote>
<p>Load the fictitious data and take a <code>glimpse()</code>.</p>
<div class="sourceCode" id="cb1234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1234-1" data-line-number="1">my_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data.R/HierLinRegressData.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1234-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1234-3" data-line-number="3"><span class="kw">glimpse</span>(my_data)</a></code></pre></div>
<pre><code>## Observations: 132
## Variables: 3
## $ Subj &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 4, 4, 5, 5, 5, 5, …
## $ X    &lt;dbl&gt; 60.2, 61.5, 61.7, 62.3, 67.6, 69.2, 53.7, 60.1, 60.5, 62.3, 63.0, 64.0, 64.1, 66.7, …
## $ Y    &lt;dbl&gt; 145.6, 157.3, 165.6, 158.8, 196.1, 183.9, 165.0, 166.9, 179.0, 196.2, 192.3, 200.7, …</code></pre>
<blockquote>
<p>Our goal is to describe each individual with a linear regression, and simultaneously to estimate the typical slope and intercept of the group overall. A key assumption for our analysis is that each individual is representative of the group. Therefore, every individual informs the estimate of the group slope and intercept, which in turn inform the estimates of all the individual slopes and intercepts. Thereby we get sharing of information across individuals, and shrinkage of individual estimates toward the overarching mode. (p. 491)</p>
</blockquote>
<div id="the-model-and-implementation-in-jags-brms." class="section level3">
<h3><span class="header-section-number">17.3.1</span> The model and implementation in <del>JAGS</del> brms.</h3>
<p>Here we’ll standardize the data and define our <code>stanvars</code>. I should note that standardizing and mean centering, more generally, becomes complicated with multilevel models. Here we’re just standardizing based on the grand mean and grand standard deviation. But there are other ways to standardize, such as within groups. Craig Enders has a <a href="https://scholar.google.com/scholar?hl=en&amp;as_sdt=0%2C1&amp;q=Centering+Predictors+and+Contextual+Effects&amp;btnG=">good book chapter</a> that touched on the topic, as well as <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.928.9848&amp;rep=rep1&amp;type=pdf">an earlier (2007) paper with Tofighi</a>.</p>
<div class="sourceCode" id="cb1236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1236-1" data-line-number="1">my_data &lt;-</a>
<a class="sourceLine" id="cb1236-2" data-line-number="2"><span class="st">  </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1236-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_z =</span> <span class="kw">standardize</span>(X),</a>
<a class="sourceLine" id="cb1236-4" data-line-number="4">         <span class="dt">y_z =</span> <span class="kw">standardize</span>(Y))</a></code></pre></div>
<p>In my experience, you typically use the <code>(|)</code> syntax when fitting a hierarchical model with the<code>brm()</code> function. The terms before the <code>|</code> are those varying by group and you tell <code>brm()</code> what the grouping variable is after the <code>|</code>. In the case of multiple group-level parameters–which is the case with this model (i.e., both intercept and the <code>x_z</code> slope–, this syntax also estimates correlations among the group-level parameters. Kruschke’s model doesn’t appear to include such a correlation. Happily, we can use the <code>(||)</code> syntax instead, which omits correlations among the group-level parameters. If you’re curious about the distinction, fit the model both ways and explore the differences in the <code>print()</code> output. For more on the topic, see the <em>Group-level terms</em> subsection of the <code>brmsformula</code> section of the <a href="https://cran.r-project.org/web/packages/brms/brms.pdf"><strong>brms</strong> reference manual</a>.</p>
<div class="sourceCode" id="cb1237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1237-1" data-line-number="1">fit4 &lt;-</a>
<a class="sourceLine" id="cb1237-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb1237-3" data-line-number="3">      <span class="dt">family =</span> student,</a>
<a class="sourceLine" id="cb1237-4" data-line-number="4">      y_z <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x_z <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x_z <span class="op">||</span><span class="st"> </span>Subj),</a>
<a class="sourceLine" id="cb1237-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1237-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1237-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb1237-8" data-line-number="8">                <span class="co"># the next line is new</span></a>
<a class="sourceLine" id="cb1237-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd),</a>
<a class="sourceLine" id="cb1237-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">exponential</span>(one_over_twentynine) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">class =</span> nu)),</a>
<a class="sourceLine" id="cb1237-11" data-line-number="11">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1237-12" data-line-number="12">      <span class="dt">stanvars =</span> <span class="kw">stanvar</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">29</span>, <span class="dt">name =</span> <span class="st">&quot;one_over_twentynine&quot;</span>),</a>
<a class="sourceLine" id="cb1237-13" data-line-number="13">      <span class="dt">seed =</span> <span class="dv">17</span>)</a></code></pre></div>
<p>Did you catch that <code>prior(normal(0, 1), class = sd)</code> line in the code? That’s the prior we used for our hierarchical variance parameters, <span class="math inline">\(\sigma_0\)</span> and <span class="math inline">\(\sigma_1\)</span>. Just like with the scale parameter, <span class="math inline">\(\sigma\)</span>, we used the zero-mean half-normal distribution. By default, <strong>brms</strong> sets their left boundary to zero, which keeps the HMC algorithm from exploring negative variance values.</p>
<p>Anyway, here’s the model <code>summary()</code>.</p>
<div class="sourceCode" id="cb1238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1238-1" data-line-number="1"><span class="kw">summary</span>(fit4)</a></code></pre></div>
<pre><code>##  Family: student 
##   Links: mu = identity; sigma = identity; nu = identity 
## Formula: y_z ~ 1 + x_z + (1 + x_z || Subj) 
##    Data: my_data (Number of observations: 132) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~Subj (Number of levels: 25) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     1.02      0.17     0.73     1.40 1.00     1185     2187
## sd(x_z)           0.22      0.12     0.02     0.47 1.00      944     1549
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.07      0.22    -0.37     0.51 1.01     1002     1682
## x_z           0.70      0.10     0.51     0.90 1.00     2316     2489
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.59      0.05     0.49     0.70 1.00     1768     2071
## nu       38.56     29.91     6.24   118.14 1.00     3792     2083
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div id="the-posterior-distribution-shrinkage-and-prediction." class="section level3">
<h3><span class="header-section-number">17.3.2</span> The posterior distribution: Shrinkage and prediction.</h3>
<p>Keeping in the same spirit of section 17.2.4, we’ll make the plots of Figure 17.5 in two ways. First, we’ll use our <code>make_beta_0()</code> and <code>make_beta_1()</code> functions to transform the model coefficients.</p>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1240-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(fit4)</a>
<a class="sourceLine" id="cb1240-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1240-3" data-line-number="3">sd_x &lt;-<span class="st"> </span><span class="kw">sd</span>(my_data<span class="op">$</span>X)</a>
<a class="sourceLine" id="cb1240-4" data-line-number="4">sd_y &lt;-<span class="st"> </span><span class="kw">sd</span>(my_data<span class="op">$</span>Y)</a>
<a class="sourceLine" id="cb1240-5" data-line-number="5">m_x  &lt;-<span class="st"> </span><span class="kw">mean</span>(my_data<span class="op">$</span>X)</a>
<a class="sourceLine" id="cb1240-6" data-line-number="6">m_y  &lt;-<span class="st"> </span><span class="kw">mean</span>(my_data<span class="op">$</span>Y)</a>
<a class="sourceLine" id="cb1240-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1240-8" data-line-number="8">post &lt;-</a>
<a class="sourceLine" id="cb1240-9" data-line-number="9"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1240-10" data-line-number="10"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">b_0 =</span> <span class="kw">make_beta_0</span>(<span class="dt">zeta_0 =</span> b_Intercept,</a>
<a class="sourceLine" id="cb1240-11" data-line-number="11">                              <span class="dt">zeta_1 =</span> b_x_z,</a>
<a class="sourceLine" id="cb1240-12" data-line-number="12">                              <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1240-13" data-line-number="13">                              <span class="dt">sd_y   =</span> sd_y,</a>
<a class="sourceLine" id="cb1240-14" data-line-number="14">                              <span class="dt">m_x    =</span> m_x,</a>
<a class="sourceLine" id="cb1240-15" data-line-number="15">                              <span class="dt">m_y    =</span> m_y),</a>
<a class="sourceLine" id="cb1240-16" data-line-number="16">            <span class="dt">b_1 =</span> <span class="kw">make_beta_1</span>(<span class="dt">zeta_1 =</span> b_x_z,</a>
<a class="sourceLine" id="cb1240-17" data-line-number="17">                              <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1240-18" data-line-number="18">                              <span class="dt">sd_y   =</span> sd_y))</a>
<a class="sourceLine" id="cb1240-19" data-line-number="19"></a>
<a class="sourceLine" id="cb1240-20" data-line-number="20"><span class="kw">head</span>(post)</a></code></pre></div>
<pre><code>##         b_0      b_1
## 1 -43.98003 2.930472
## 2 -44.70868 2.913752
## 3 -94.67366 3.671535
## 4 -39.53594 2.934772
## 5 -30.23631 2.967107
## 6 -97.21916 3.936589</code></pre>
<p>Here’s the top panel of Figure 17.4.</p>
<div class="sourceCode" id="cb1242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1242-1" data-line-number="1"><span class="co"># how many posterior lines would you like?</span></a>
<a class="sourceLine" id="cb1242-2" data-line-number="2">n_lines &lt;-<span class="st"> </span><span class="dv">250</span></a>
<a class="sourceLine" id="cb1242-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1242-4" data-line-number="4">my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1242-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Subj =</span> Subj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1242-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb1242-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1242-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> post[<span class="dv">1</span><span class="op">:</span>n_lines, <span class="st">&quot;b_0&quot;</span>], </a>
<a class="sourceLine" id="cb1242-9" data-line-number="9">              <span class="dt">slope     =</span> post[<span class="dv">1</span><span class="op">:</span>n_lines, <span class="st">&quot;b_1&quot;</span>],</a>
<a class="sourceLine" id="cb1242-10" data-line-number="10">              <span class="dt">color =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1242-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Subj),</a>
<a class="sourceLine" id="cb1242-12" data-line-number="12">             <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1242-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> Subj, <span class="dt">color =</span> Subj),</a>
<a class="sourceLine" id="cb1242-14" data-line-number="14">            <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1242-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1242-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">50</span>, <span class="dt">to =</span> <span class="dv">250</span>, <span class="dt">by =</span> <span class="dv">50</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1242-17" data-line-number="17"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">40</span><span class="op">:</span><span class="dv">95</span>,</a>
<a class="sourceLine" id="cb1242-18" data-line-number="18">                  <span class="dt">ylim =</span> <span class="dv">30</span><span class="op">:</span><span class="dv">270</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1242-19" data-line-number="19"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">eval</span>(<span class="kw">substitute</span>(<span class="kw">paste</span>(<span class="st">&quot;Data from all units with&quot;</span>, n_lines, <span class="st">&quot;credible population-level</span><span class="ch">\n</span><span class="st">regression lines&quot;</span>)))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1242-20" data-line-number="20"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-37-1.png" /><!-- --></p>
<p>Recall how we can use <code>coef()</code> to extract the <code>Subj</code>-specific parameters. But we’ll want posterior draws rather than summaries, which requires <code>summary = F</code>. It’ll take a bit of wrangling to get the output in a tidy format. Once we’re there, the plot code will be fairly simple.</p>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1243-1" data-line-number="1">c &lt;-</a>
<a class="sourceLine" id="cb1243-2" data-line-number="2"><span class="st">  </span><span class="co"># first we&#39;ll wrangle the `coef()` output for the intercept</span></a>
<a class="sourceLine" id="cb1243-3" data-line-number="3"><span class="st">  </span><span class="kw">coef</span>(fit4, <span class="dt">summary =</span> F)<span class="op">$</span>Subj[, , <span class="st">&quot;Intercept&quot;</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1243-4" data-line-number="4"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1243-5" data-line-number="5"><span class="st">  </span><span class="kw">gather</span>(Subj, Intercept) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1243-6" data-line-number="6"><span class="st">  </span><span class="co"># add the slope</span></a>
<a class="sourceLine" id="cb1243-7" data-line-number="7"><span class="st">  </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb1243-8" data-line-number="8">    <span class="kw">coef</span>(fit4, <span class="dt">summary =</span> F)<span class="op">$</span>Subj[, , <span class="st">&quot;x_z&quot;</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1243-9" data-line-number="9"><span class="st">      </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1243-10" data-line-number="10"><span class="st">      </span><span class="kw">gather</span>(Subj, Slope) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1243-11" data-line-number="11"><span class="st">      </span><span class="kw">select</span>(Slope)</a>
<a class="sourceLine" id="cb1243-12" data-line-number="12">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1243-13" data-line-number="13"><span class="st">  </span><span class="co"># now we&#39;re ready to un-standardize the standardized coefficients</span></a>
<a class="sourceLine" id="cb1243-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">b_0 =</span> <span class="kw">make_beta_0</span>(<span class="dt">zeta_0 =</span> Intercept,</a>
<a class="sourceLine" id="cb1243-15" data-line-number="15">                           <span class="dt">zeta_1 =</span> Slope,</a>
<a class="sourceLine" id="cb1243-16" data-line-number="16">                           <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1243-17" data-line-number="17">                           <span class="dt">sd_y   =</span> sd_y,</a>
<a class="sourceLine" id="cb1243-18" data-line-number="18">                           <span class="dt">m_x    =</span> m_x,</a>
<a class="sourceLine" id="cb1243-19" data-line-number="19">                           <span class="dt">m_y    =</span> m_y),</a>
<a class="sourceLine" id="cb1243-20" data-line-number="20">         <span class="dt">b_1 =</span> <span class="kw">make_beta_1</span>(<span class="dt">zeta_1 =</span> Slope,</a>
<a class="sourceLine" id="cb1243-21" data-line-number="21">                           <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1243-22" data-line-number="22">                           <span class="dt">sd_y   =</span> sd_y)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1243-23" data-line-number="23"><span class="st">  </span><span class="co"># we need an iteration index so we might `filter()` the number of lines per case</span></a>
<a class="sourceLine" id="cb1243-24" data-line-number="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>, <span class="dt">times =</span> <span class="dv">25</span>))</a>
<a class="sourceLine" id="cb1243-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1243-26" data-line-number="26"><span class="co"># how many lines would you like?</span></a>
<a class="sourceLine" id="cb1243-27" data-line-number="27">n_lines &lt;-<span class="st"> </span><span class="dv">250</span></a>
<a class="sourceLine" id="cb1243-28" data-line-number="28"></a>
<a class="sourceLine" id="cb1243-29" data-line-number="29"><span class="co"># the plot:</span></a>
<a class="sourceLine" id="cb1243-30" data-line-number="30">my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1243-31" data-line-number="31"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1243-32" data-line-number="32"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">data =</span> c <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(iter <span class="op">&lt;=</span><span class="st"> </span>n_lines),</a>
<a class="sourceLine" id="cb1243-33" data-line-number="33">              <span class="kw">aes</span>(<span class="dt">intercept =</span> b_<span class="dv">0</span>, <span class="dt">slope =</span> b_<span class="dv">1</span>), </a>
<a class="sourceLine" id="cb1243-34" data-line-number="34">              <span class="dt">color =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1243-35" data-line-number="35"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Subj)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1243-36" data-line-number="36"><span class="st">  </span><span class="kw">scale_color_viridis_c</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1243-37" data-line-number="37"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">50</span>, <span class="dt">to =</span> <span class="dv">90</span>,  <span class="dt">by =</span> <span class="dv">20</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1243-38" data-line-number="38"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">50</span>, <span class="dt">to =</span> <span class="dv">250</span>, <span class="dt">by =</span> <span class="dv">100</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1243-39" data-line-number="39"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">45</span><span class="op">:</span><span class="dv">90</span>,</a>
<a class="sourceLine" id="cb1243-40" data-line-number="40">                  <span class="dt">ylim =</span> <span class="dv">50</span><span class="op">:</span><span class="dv">270</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1243-41" data-line-number="41"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Each unit now has its own bundle of credible regression lines&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1243-42" data-line-number="42"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1243-43" data-line-number="43"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Subj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">factor</span>(., <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">25</span>))</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-38-1.png" /><!-- --></p>
<p>There’s some good pedagogy in that method. But it’s good to have options and in this case <code>fitted()</code> is a simpler option. Here’s the preparatory data wrangling step.</p>
<div class="sourceCode" id="cb1244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1244-1" data-line-number="1"><span class="co"># how many posterior lines would you like?</span></a>
<a class="sourceLine" id="cb1244-2" data-line-number="2">n_lines &lt;-<span class="st"> </span><span class="dv">250</span></a>
<a class="sourceLine" id="cb1244-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1244-4" data-line-number="4">nd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1244-5" data-line-number="5"><span class="st">  </span><span class="co"># since we&#39;re working with straight lines, we only need two x-values</span></a>
<a class="sourceLine" id="cb1244-6" data-line-number="6"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x_z =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1244-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">X =</span> x_z <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(my_data<span class="op">$</span>X) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(my_data<span class="op">$</span>X))</a>
<a class="sourceLine" id="cb1244-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1244-9" data-line-number="9">f &lt;-</a>
<a class="sourceLine" id="cb1244-10" data-line-number="10"><span class="st">  </span><span class="kw">fitted</span>(fit4,</a>
<a class="sourceLine" id="cb1244-11" data-line-number="11">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1244-12" data-line-number="12">         <span class="co"># since we only want the fixed effects, we&#39;ll use `re_formula` </span></a>
<a class="sourceLine" id="cb1244-13" data-line-number="13">         <span class="co"># to maginalize over the random effects</span></a>
<a class="sourceLine" id="cb1244-14" data-line-number="14">         <span class="dt">re_formula =</span> Y_z <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>X_z,</a>
<a class="sourceLine" id="cb1244-15" data-line-number="15">         <span class="dt">summary =</span> F,</a>
<a class="sourceLine" id="cb1244-16" data-line-number="16">         <span class="co"># here we use `nsamples` to subset right from the get go</span></a>
<a class="sourceLine" id="cb1244-17" data-line-number="17">         <span class="dt">nsamples =</span> n_lines) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1244-18" data-line-number="18"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1244-19" data-line-number="19"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1244-20" data-line-number="20"><span class="st">  </span><span class="co"># transform the `y_z` values back into the `Y` metric</span></a>
<a class="sourceLine" id="cb1244-21" data-line-number="21"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Y =</span> value <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(my_data<span class="op">$</span>Y) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(my_data<span class="op">$</span>Y)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1244-22" data-line-number="22"><span class="st">  </span><span class="co"># now attach the predictor values to the output</span></a>
<a class="sourceLine" id="cb1244-23" data-line-number="23"><span class="st">  </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb1244-24" data-line-number="24">    nd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1244-25" data-line-number="25"><span class="st">      </span><span class="kw">expand</span>(X, <span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span>n_lines)</a>
<a class="sourceLine" id="cb1244-26" data-line-number="26">  )</a>
<a class="sourceLine" id="cb1244-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1244-28" data-line-number="28"><span class="kw">head</span>(f)  </a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##       Y     X  iter
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1  55.8  31.4     1
## 2 -17.7  31.4     2
## 3  49.6  31.4     3
## 4  76.7  31.4     4
## 5  33.7  31.4     5
## 6  34.9  31.4     6</code></pre>
<p>For the second time, here’s the top panel of Figure 17.4, this time based off of <code>fitted()</code>.</p>
<div class="sourceCode" id="cb1246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1246-1" data-line-number="1">my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1246-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Subj =</span> Subj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1246-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb1246-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1246-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> f,</a>
<a class="sourceLine" id="cb1246-6" data-line-number="6">            <span class="kw">aes</span>(<span class="dt">group =</span> iter),</a>
<a class="sourceLine" id="cb1246-7" data-line-number="7">            <span class="dt">color =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1246-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Subj),</a>
<a class="sourceLine" id="cb1246-9" data-line-number="9">             <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1246-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> Subj, <span class="dt">color =</span> Subj),</a>
<a class="sourceLine" id="cb1246-11" data-line-number="11">            <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1246-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="dt">option =</span> <span class="st">&quot;C&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1246-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">50</span>, <span class="dt">to =</span> <span class="dv">250</span>, <span class="dt">by =</span> <span class="dv">50</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1246-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">40</span><span class="op">:</span><span class="dv">95</span>,</a>
<a class="sourceLine" id="cb1246-15" data-line-number="15">                  <span class="dt">ylim =</span> <span class="dv">30</span><span class="op">:</span><span class="dv">270</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1246-16" data-line-number="16"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="kw">eval</span>(<span class="kw">substitute</span>(<span class="kw">paste</span>(<span class="st">&quot;Data from all units with&quot;</span>, n_lines, <span class="st">&quot;credible population-level</span><span class="ch">\n</span><span class="st">regression lines&quot;</span>)))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1246-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-40-1.png" /><!-- --></p>
<p>The whole process is quite similar for the <code>Subj</code>-specific lines. There are two main differences. First, we need to specify which <code>Subj</code> values we’d like to get <code>fitted()</code> points for. That goes into our <code>nd</code> tibble. Second, we omit the <code>re_formula</code> argument. There are other subtleties, like with the contents of the <code>bind_cols()</code> function. But hopefully those are self-evident.</p>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1247-1" data-line-number="1"><span class="co"># how many posterior lines would you like?</span></a>
<a class="sourceLine" id="cb1247-2" data-line-number="2">n_lines &lt;-<span class="st"> </span><span class="dv">250</span></a>
<a class="sourceLine" id="cb1247-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1247-4" data-line-number="4">nd &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1247-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x_z =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1247-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">X =</span> x_z <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(my_data<span class="op">$</span>X) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(my_data<span class="op">$</span>X)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1247-7" data-line-number="7"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(x_z, X),</a>
<a class="sourceLine" id="cb1247-8" data-line-number="8">         <span class="dt">Subj =</span> <span class="kw">distinct</span>(my_data, Subj) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>())</a>
<a class="sourceLine" id="cb1247-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1247-10" data-line-number="10">f &lt;-</a>
<a class="sourceLine" id="cb1247-11" data-line-number="11"><span class="st">  </span><span class="kw">fitted</span>(fit4,</a>
<a class="sourceLine" id="cb1247-12" data-line-number="12">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb1247-13" data-line-number="13">         <span class="dt">summary =</span> F,</a>
<a class="sourceLine" id="cb1247-14" data-line-number="14">         <span class="dt">nsamples =</span> n_lines) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1247-15" data-line-number="15"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1247-16" data-line-number="16"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1247-17" data-line-number="17"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">Y =</span> value <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(my_data<span class="op">$</span>Y) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(my_data<span class="op">$</span>Y)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1247-18" data-line-number="18"><span class="st">  </span><span class="kw">bind_cols</span>(nd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1247-19" data-line-number="19"><span class="st">              </span><span class="kw">expand</span>(<span class="kw">nesting</span>(X, Subj),</a>
<a class="sourceLine" id="cb1247-20" data-line-number="20">                     <span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span>n_lines)</a>
<a class="sourceLine" id="cb1247-21" data-line-number="21">  )</a>
<a class="sourceLine" id="cb1247-22" data-line-number="22"></a>
<a class="sourceLine" id="cb1247-23" data-line-number="23"><span class="kw">head</span>(f)  </a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##       Y     X  Subj  iter
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1  36.8  31.4     1     1
## 2  50.8  31.4     1     2
## 3 108.   31.4     1     3
## 4  41.1  31.4     1     4
## 5  59.0  31.4     1     5
## 6  60.3  31.4     1     6</code></pre>
<p>And now for the second time, here’s the bottom panel of Figure 17.4, this time based off of <code>fitted()</code>.</p>
<div class="sourceCode" id="cb1249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1249-1" data-line-number="1">my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1249-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1249-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> f,</a>
<a class="sourceLine" id="cb1249-4" data-line-number="4">            <span class="kw">aes</span>(<span class="dt">group =</span> iter),</a>
<a class="sourceLine" id="cb1249-5" data-line-number="5">            <span class="dt">color =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1249-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Subj)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1249-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_color_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;C&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1249-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">50</span>, <span class="dt">to =</span> <span class="dv">90</span>,  <span class="dt">by =</span> <span class="dv">20</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1249-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">50</span>, <span class="dt">to =</span> <span class="dv">250</span>, <span class="dt">by =</span> <span class="dv">100</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1249-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Each unit now has its own bundle of credible regression lines&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1249-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">45</span><span class="op">:</span><span class="dv">90</span>,</a>
<a class="sourceLine" id="cb1249-12" data-line-number="12">                  <span class="dt">ylim =</span> <span class="dv">50</span><span class="op">:</span><span class="dv">270</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1249-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1249-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Subj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">factor</span>(., <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">25</span>))</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-42-1.png" /><!-- --></p>
<p>Especially if you’re new to these kinds of models, it’s easy to get lost in all that code. And for real–the wrangling required for those plots was no joke. The primary difficulty was that we had to convert standardized solutions to unstandardized solutions, which leads to an important distinction. When we used the first method of working with the <code>posterior_samples()</code> and <code>coef()</code> output, we focused on <strong>transforming the model parameters</strong>. In contrast, when we used the second method of working with the <code>fitted()</code> output, we focused instead on <strong>transforming the model predictions and predictor values</strong>. This distinction can be really confusing, at first. Stick with it! There will be times one method is more convenient or intuitive than the other. It’s good to have both methods in your repertoire.</p>
</div>
</div>
<div id="quadratic-trend-and-weighted-data" class="section level2">
<h2><span class="header-section-number">17.4</span> Quadratic trend and weighted data</h2>
<p>Quadratic models follow the general form</p>
<p><span class="math display">\[y = \beta_0 + \beta_1 x + \beta_2 x^2,\]</span></p>
<p>where <span class="math inline">\(\beta_2\)</span> is the quadratic term which, when 0, reduces the results to a simple linear model. That’s right; the linear model is a special case of the quadratic.</p>
<p>This time the data come from the American Community Survey and Puerto Rico Community Survey. Note the <code>comment</code> argument.</p>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1250-1" data-line-number="1">my_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data.R/IncomeFamszState3yr.csv&quot;</span>,</a>
<a class="sourceLine" id="cb1250-2" data-line-number="2">                    <span class="dt">comment =</span> <span class="st">&quot;#&quot;</span>)</a>
<a class="sourceLine" id="cb1250-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1250-4" data-line-number="4"><span class="kw">glimpse</span>(my_data)</a></code></pre></div>
<pre><code>## Observations: 312
## Variables: 4
## $ FamilySize   &lt;dbl&gt; 2, 3, 4, 5, 6, 7, 2, 3, 4, 5, 6, 7, 2, 3, 4, 5, 6, 7, 2, 3, 4, 5, 6, 7, 2, 3…
## $ State        &lt;chr&gt; &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alaska&quot;, …
## $ MedianIncome &lt;dbl&gt; 48177, 53323, 64899, 59417, 54099, 47655, 73966, 82276, 87726, 87216, 84488,…
## $ SampErr      &lt;dbl&gt; 581, 1177, 1170, 2446, 3781, 3561, 1858, 3236, 3722, 6127, 6761, 5754, 590, …</code></pre>
<p>Here we’ll standardize all variables but <code>State</code>, our grouping variable. It’d be silly to try to standardize that.</p>
<div class="sourceCode" id="cb1252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1252-1" data-line-number="1">my_data &lt;-</a>
<a class="sourceLine" id="cb1252-2" data-line-number="2"><span class="st">  </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1252-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">family_size_z   =</span> <span class="kw">standardize</span>(FamilySize),</a>
<a class="sourceLine" id="cb1252-4" data-line-number="4">         <span class="dt">median_income_z =</span> <span class="kw">standardize</span>(MedianIncome),</a>
<a class="sourceLine" id="cb1252-5" data-line-number="5">         <span class="dt">se_z            =</span> SampErr <span class="op">/</span><span class="st"> </span>(<span class="kw">mean</span>(SampErr)))</a>
<a class="sourceLine" id="cb1252-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1252-7" data-line-number="7"><span class="kw">glimpse</span>(my_data)</a></code></pre></div>
<pre><code>## Observations: 312
## Variables: 7
## $ FamilySize      &lt;dbl&gt; 2, 3, 4, 5, 6, 7, 2, 3, 4, 5, 6, 7, 2, 3, 4, 5, 6, 7, 2, 3, 4, 5, 6, 7, 2…
## $ State           &lt;chr&gt; &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alabama&quot;, &quot;Alaska…
## $ MedianIncome    &lt;dbl&gt; 48177, 53323, 64899, 59417, 54099, 47655, 73966, 82276, 87726, 87216, 844…
## $ SampErr         &lt;dbl&gt; 581, 1177, 1170, 2446, 3781, 3561, 1858, 3236, 3722, 6127, 6761, 5754, 59…
## $ family_size_z   &lt;dbl&gt; -1.4615023, -0.8769014, -0.2923005, 0.2923005, 0.8769014, 1.4615023, -1.4…
## $ median_income_z &lt;dbl&gt; -1.26216763, -0.91386251, -0.13034520, -0.50139236, -0.86133924, -1.29749…
## $ se_z            &lt;dbl&gt; 0.2242541, 0.4542979, 0.4515961, 0.9441060, 1.4593886, 1.3744731, 0.71715…</code></pre>
<p>With <strong>brms</strong>, there are a couple ways to handle measurement error on a variable (e.g., see <a href="https://bookdown.org/content/1850/missing-data-and-other-opportunities.html">Chapter 14 of this <strong>bookdown</strong> project</a>). Here we’ll use the <code>se()</code> syntax, following the form <code>response | se(se_response, sigma = TRUE)</code>. In this form, <code>se</code> stands for standard error, the loose frequentist analogue to the Bayesian posterior <span class="math inline">\(SD\)</span>. Unless you’re fitting a meta-analysis on summary information, make sure to specify <code>sigma = TRUE</code>. Without that you’ll have no estimate for <span class="math inline">\(\sigma\)</span>! For more information on the <code>se()</code> method, go to the <a href="https://cran.r-project.org/web/packages/brms/brms.pdf"><strong>brms</strong> reference manual</a> and find the <em>Additional response information</em> subsection of the <code>brmsformula</code> section.</p>
<div class="sourceCode" id="cb1254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1254-1" data-line-number="1">fit5 &lt;-</a>
<a class="sourceLine" id="cb1254-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb1254-3" data-line-number="3">      <span class="dt">family =</span> student,</a>
<a class="sourceLine" id="cb1254-4" data-line-number="4">      median_income_z <span class="op">|</span><span class="st"> </span><span class="kw">se</span>(se_z, <span class="dt">sigma =</span> <span class="ot">TRUE</span>) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>family_size_z <span class="op">+</span><span class="st">  </span><span class="kw">I</span>(family_size_z<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1254-5" data-line-number="5"><span class="st">        </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>family_size_z <span class="op">+</span><span class="st">  </span><span class="kw">I</span>(family_size_z<span class="op">^</span><span class="dv">2</span>) <span class="op">||</span><span class="st"> </span>State),</a>
<a class="sourceLine" id="cb1254-6" data-line-number="6">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1254-7" data-line-number="7">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),</a>
<a class="sourceLine" id="cb1254-8" data-line-number="8">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma),</a>
<a class="sourceLine" id="cb1254-9" data-line-number="9">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd),</a>
<a class="sourceLine" id="cb1254-10" data-line-number="10">                <span class="kw">prior</span>(<span class="kw">exponential</span>(one_over_twentynine), <span class="dt">class =</span> nu)),</a>
<a class="sourceLine" id="cb1254-11" data-line-number="11">      <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1254-12" data-line-number="12">      <span class="dt">stanvars =</span> <span class="kw">stanvar</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">29</span>, <span class="dt">name =</span> <span class="st">&quot;one_over_twentynine&quot;</span>),</a>
<a class="sourceLine" id="cb1254-13" data-line-number="13">      <span class="dt">seed =</span> <span class="dv">17</span>)</a></code></pre></div>
<p>Did you notice the <code>I(family_size_z^2)</code> part of the <code>formula</code>? The <strong>brms</strong> package follows a typical convention in <strong>R</strong> statistical functions in that if you want to multiply a variable by itself as in a quadratic model, you nest the <code>family_size_z^2</code> part within the <code>I()</code> function.</p>
<p>Take a look at the model summary.</p>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1255-1" data-line-number="1"><span class="kw">print</span>(fit5)</a></code></pre></div>
<pre><code>##  Family: student 
##   Links: mu = identity; sigma = identity; nu = identity 
## Formula: median_income_z | se(se_z, sigma = TRUE) ~ 1 + family_size_z + I(family_size_z^2) + (1 + family_size_z + I(family_size_z^2) || State) 
##    Data: my_data (Number of observations: 312) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~State (Number of levels: 52) 
##                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)            0.75      0.09     0.61     0.94 1.00     1092     2003
## sd(family_size_z)        0.07      0.04     0.00     0.16 1.00      925     1380
## sd(Ifamily_size_zE2)     0.05      0.04     0.00     0.13 1.01      678     1250
## 
## Population-Level Effects: 
##                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept            0.39      0.12     0.16     0.63 1.00      561     1049
## family_size_z        0.12      0.05     0.02     0.23 1.00     3058     2293
## Ifamily_size_zE2    -0.44      0.04    -0.52    -0.36 1.00     3508     2803
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.05      0.04     0.00     0.14 1.00     2345     1872
## nu       68.95     36.56    21.41   160.29 1.00     6386     2542
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Do see that <code>Ifamily_size_zE2</code> row? That’s the summary of our quadratic term.</p>
<div id="results-and-interpretation." class="section level3">
<h3><span class="header-section-number">17.4.1</span> Results and interpretation.</h3>
<p>A new model type requires a different approach to un-standardizing our standardized coefficients. Based on Equation 17.3, we can convert our coefficients using the formulas</p>
<p><span class="math display">\[\begin{align*}
\beta_0 &amp; = \zeta_0 \operatorname{SD}_y + M_y - \frac{\zeta_1 M_x \operatorname{SD}_y}{\operatorname{SD}_x} + \frac{\zeta_2 M^{2}_x \operatorname{SD}_y}{\operatorname{SD}^{2}_x}, \\
\beta_1 &amp; = \frac{\zeta_1 \operatorname{SD}_y}{\operatorname{SD}_x} - \frac{2 \zeta_2 M_x \operatorname{SD}_y}{\operatorname{SD}^{2}_x}, \text{and} \\
\beta_2 &amp; = \frac{\zeta_2 \operatorname{SD}_y}{\operatorname{SD}^{2}_x}.
\end{align*}\]</span></p>
<p>We’ll make new custom functions to use them.</p>
<div class="sourceCode" id="cb1257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1257-1" data-line-number="1">make_beta_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="cf">function</span>(zeta_<span class="dv">0</span>, zeta_<span class="dv">1</span>, zeta_<span class="dv">2</span>, sd_x, sd_y, m_x, m_y) {</a>
<a class="sourceLine" id="cb1257-2" data-line-number="2">  zeta_<span class="dv">0</span> <span class="op">*</span><span class="st"> </span>sd_y <span class="op">+</span><span class="st"> </span>m_y <span class="op">-</span><span class="st"> </span>zeta_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>m_x <span class="op">*</span><span class="st"> </span>sd_y <span class="op">/</span><span class="st"> </span>sd_x <span class="op">+</span><span class="st"> </span>zeta_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>m_x<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sd_y <span class="op">/</span><span class="st"> </span>sd_x<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb1257-3" data-line-number="3">  }</a>
<a class="sourceLine" id="cb1257-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1257-5" data-line-number="5">make_beta_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="cf">function</span>(zeta_<span class="dv">1</span>, zeta_<span class="dv">2</span>, sd_x, sd_y, m_x) {</a>
<a class="sourceLine" id="cb1257-6" data-line-number="6">  zeta_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>sd_y <span class="op">/</span><span class="st"> </span>sd_x <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>zeta_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>m_x <span class="op">*</span><span class="st"> </span>sd_y <span class="op">/</span><span class="st"> </span>sd_x<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb1257-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1257-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1257-9" data-line-number="9">make_beta_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(zeta_<span class="dv">2</span>, sd_x, sd_y) {</a>
<a class="sourceLine" id="cb1257-10" data-line-number="10">  zeta_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sd_y <span class="op">/</span><span class="st"> </span>sd_x<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb1257-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb1257-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1257-13" data-line-number="13"><span class="co"># may as well respecify these, too</span></a>
<a class="sourceLine" id="cb1257-14" data-line-number="14">m_x  &lt;-<span class="st"> </span><span class="kw">mean</span>(my_data<span class="op">$</span>FamilySize)</a>
<a class="sourceLine" id="cb1257-15" data-line-number="15">m_y  &lt;-<span class="st"> </span><span class="kw">mean</span>(my_data<span class="op">$</span>MedianIncome)</a>
<a class="sourceLine" id="cb1257-16" data-line-number="16">sd_x &lt;-<span class="st"> </span><span class="kw">sd</span>(my_data<span class="op">$</span>FamilySize)</a>
<a class="sourceLine" id="cb1257-17" data-line-number="17">sd_y &lt;-<span class="st"> </span><span class="kw">sd</span>(my_data<span class="op">$</span>MedianIncome)</a></code></pre></div>
<p>Now we’ll extract our posterior samples and make the conversions.</p>
<div class="sourceCode" id="cb1258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1258-1" data-line-number="1">post &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1258-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(fit5) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1258-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">b_0 =</span> <span class="kw">make_beta_0</span>(<span class="dt">zeta_0 =</span> b_Intercept,</a>
<a class="sourceLine" id="cb1258-4" data-line-number="4">                              <span class="dt">zeta_1 =</span> b_family_size_z,</a>
<a class="sourceLine" id="cb1258-5" data-line-number="5">                              <span class="dt">zeta_2 =</span> b_Ifamily_size_zE2,</a>
<a class="sourceLine" id="cb1258-6" data-line-number="6">                              <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1258-7" data-line-number="7">                              <span class="dt">sd_y   =</span> sd_y,</a>
<a class="sourceLine" id="cb1258-8" data-line-number="8">                              <span class="dt">m_x    =</span> m_x,</a>
<a class="sourceLine" id="cb1258-9" data-line-number="9">                              <span class="dt">m_y    =</span> m_y),</a>
<a class="sourceLine" id="cb1258-10" data-line-number="10">            <span class="dt">b_1 =</span> <span class="kw">make_beta_1</span>(<span class="dt">zeta_1 =</span> b_family_size_z,</a>
<a class="sourceLine" id="cb1258-11" data-line-number="11">                              <span class="dt">zeta_2 =</span> b_Ifamily_size_zE2,</a>
<a class="sourceLine" id="cb1258-12" data-line-number="12">                              <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1258-13" data-line-number="13">                              <span class="dt">sd_y   =</span> sd_y,</a>
<a class="sourceLine" id="cb1258-14" data-line-number="14">                              <span class="dt">m_x    =</span> m_x),</a>
<a class="sourceLine" id="cb1258-15" data-line-number="15">            <span class="dt">b_2 =</span> <span class="kw">make_beta_2</span>(<span class="dt">zeta_2 =</span> b_Ifamily_size_zE2,</a>
<a class="sourceLine" id="cb1258-16" data-line-number="16">                              <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1258-17" data-line-number="17">                              <span class="dt">sd_y   =</span> sd_y))</a></code></pre></div>
<p>Our <code>geom_abline()</code> approach from before won’t work with curves. We’ll have to resort to <code>geom_line()</code>. With the <code>geom_line()</code> approach, we’ll need many specific values of model-implied <code>MedianIncome</code> across a densely-packed range of <code>FamilySize</code>. We want to use a lot of <code>FamilySize</code> values, like 30 or 50 or so, to make sure the curves look smooth. Below, we’ll use 50 (i.e., <code>length.out = 50</code>). But if it’s still not clear why, try plugging in a lesser value, like 5 or so. You’ll see.</p>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1259-1" data-line-number="1"><span class="co"># how many posterior lines would you like?</span></a>
<a class="sourceLine" id="cb1259-2" data-line-number="2">n_lines &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb1259-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1259-4" data-line-number="4"><span class="kw">set.seed</span>(<span class="dv">17</span>)</a>
<a class="sourceLine" id="cb1259-5" data-line-number="5">post &lt;-</a>
<a class="sourceLine" id="cb1259-6" data-line-number="6"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1259-7" data-line-number="7"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> n_lines) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1259-8" data-line-number="8"><span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;draw&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1259-9" data-line-number="9"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(draw, b_<span class="dv">0</span>, b_<span class="dv">1</span>, b_<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1259-10" data-line-number="10">         <span class="dt">FamilySize =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> <span class="dv">9</span>, <span class="dt">length.out =</span> <span class="dv">50</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1259-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">MedianIncome =</span> b_<span class="dv">0</span> <span class="op">+</span><span class="st"> </span>b_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>FamilySize <span class="op">+</span><span class="st"> </span>b_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>FamilySize<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1259-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1259-13" data-line-number="13"><span class="kw">head</span>(post)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   draw     b_0    b_1    b_2 FamilySize MedianIncome
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
## 1 1     25517. 19003. -1947.       1          42574.
## 2 1     25517. 19003. -1947.       1.16       44989.
## 3 1     25517. 19003. -1947.       1.33       47300.
## 4 1     25517. 19003. -1947.       1.49       49507.
## 5 1     25517. 19003. -1947.       1.65       51611.
## 6 1     25517. 19003. -1947.       1.82       53611.</code></pre>
<p>Now we’re ready to make the top panel of Figure 17.7.</p>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1261-1" data-line-number="1">my_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1261-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FamilySize, <span class="dt">y =</span> MedianIncome)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1261-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> post,</a>
<a class="sourceLine" id="cb1261-4" data-line-number="4">            <span class="kw">aes</span>(<span class="dt">group =</span> draw),</a>
<a class="sourceLine" id="cb1261-5" data-line-number="5">            <span class="dt">size  =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">color =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1261-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> State),</a>
<a class="sourceLine" id="cb1261-7" data-line-number="7">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1261-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1261-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_color_viridis_c</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1261-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Family size&quot;</span>, <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1261-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>,</a>
<a class="sourceLine" id="cb1261-12" data-line-number="12">                  <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">150000</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1261-13" data-line-number="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;All states&quot;</span>,</a>
<a class="sourceLine" id="cb1261-14" data-line-number="14">       <span class="dt">y     =</span> <span class="st">&quot;Median income&quot;</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-49-1.png" /><!-- --></p>
<p>Like before, we’ll extract the group-level coefficients (i.e., those specific to the <code>State</code>s) with the <code>coef()</code> function. And also like before, the <code>coef()</code> output will require a little wrangling.</p>
<div class="sourceCode" id="cb1262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1262-1" data-line-number="1">c &lt;-</a>
<a class="sourceLine" id="cb1262-2" data-line-number="2"><span class="st">  </span><span class="co"># collect the `State`-level intercepts</span></a>
<a class="sourceLine" id="cb1262-3" data-line-number="3"><span class="st">  </span><span class="kw">coef</span>(fit5, <span class="dt">summary =</span> F)<span class="op">$</span>State[, , <span class="st">&quot;Intercept&quot;</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-4" data-line-number="4"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-5" data-line-number="5"><span class="st">  </span><span class="kw">gather</span>(State, Intercept) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-6" data-line-number="6"><span class="st">  </span><span class="co"># add the `State`-level `family_size_z` slopes</span></a>
<a class="sourceLine" id="cb1262-7" data-line-number="7"><span class="st">  </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb1262-8" data-line-number="8">    <span class="kw">coef</span>(fit5, <span class="dt">summary =</span> F)<span class="op">$</span>State[, , <span class="st">&quot;family_size_z&quot;</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-9" data-line-number="9"><span class="st">      </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-10" data-line-number="10"><span class="st">      </span><span class="kw">gather</span>(Subj, family_size_z) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-11" data-line-number="11"><span class="st">      </span><span class="kw">select</span>(family_size_z)</a>
<a class="sourceLine" id="cb1262-12" data-line-number="12">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-13" data-line-number="13"><span class="st">  </span><span class="co"># add the `State`-level `Ifamily_size_zE2` slopes</span></a>
<a class="sourceLine" id="cb1262-14" data-line-number="14"><span class="st">  </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb1262-15" data-line-number="15">    <span class="kw">coef</span>(fit5, <span class="dt">summary =</span> F)<span class="op">$</span>State[, , <span class="st">&quot;Ifamily_size_zE2&quot;</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-16" data-line-number="16"><span class="st">      </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-17" data-line-number="17"><span class="st">      </span><span class="kw">gather</span>(Subj, Ifamily_size_zE2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-18" data-line-number="18"><span class="st">      </span><span class="kw">select</span>(Ifamily_size_zE2)</a>
<a class="sourceLine" id="cb1262-19" data-line-number="19">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-20" data-line-number="20"><span class="st">  </span><span class="co"># let&#39;s go ahead and make the standardized-to-unstandardized conversions, here</span></a>
<a class="sourceLine" id="cb1262-21" data-line-number="21"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">b_0 =</span> <span class="kw">make_beta_0</span>(<span class="dt">zeta_0 =</span> Intercept,</a>
<a class="sourceLine" id="cb1262-22" data-line-number="22">                           <span class="dt">zeta_1 =</span> family_size_z,</a>
<a class="sourceLine" id="cb1262-23" data-line-number="23">                           <span class="dt">zeta_2 =</span> Ifamily_size_zE2,</a>
<a class="sourceLine" id="cb1262-24" data-line-number="24">                           <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1262-25" data-line-number="25">                           <span class="dt">sd_y   =</span> sd_y,</a>
<a class="sourceLine" id="cb1262-26" data-line-number="26">                           <span class="dt">m_x    =</span> m_x,</a>
<a class="sourceLine" id="cb1262-27" data-line-number="27">                           <span class="dt">m_y    =</span> m_y),</a>
<a class="sourceLine" id="cb1262-28" data-line-number="28">         <span class="dt">b_1 =</span> <span class="kw">make_beta_1</span>(<span class="dt">zeta_1 =</span> family_size_z,</a>
<a class="sourceLine" id="cb1262-29" data-line-number="29">                           <span class="dt">zeta_2 =</span> Ifamily_size_zE2,</a>
<a class="sourceLine" id="cb1262-30" data-line-number="30">                           <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1262-31" data-line-number="31">                           <span class="dt">sd_y   =</span> sd_y,</a>
<a class="sourceLine" id="cb1262-32" data-line-number="32">                           <span class="dt">m_x    =</span> m_x),</a>
<a class="sourceLine" id="cb1262-33" data-line-number="33">         <span class="dt">b_2 =</span> <span class="kw">make_beta_2</span>(<span class="dt">zeta_2 =</span> Ifamily_size_zE2,</a>
<a class="sourceLine" id="cb1262-34" data-line-number="34">                           <span class="dt">sd_x   =</span> sd_x,</a>
<a class="sourceLine" id="cb1262-35" data-line-number="35">                           <span class="dt">sd_y   =</span> sd_y)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1262-36" data-line-number="36"><span class="st">  </span><span class="co"># We just want the first 25 states, from Alabama through Mississippi, so we&#39;ll `filter()`</span></a>
<a class="sourceLine" id="cb1262-37" data-line-number="37"><span class="st">  </span><span class="kw">filter</span>(State <span class="op">&lt;=</span><span class="st"> &quot;Mississippi&quot;</span>)</a>
<a class="sourceLine" id="cb1262-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1262-39" data-line-number="39"><span class="kw">str</span>(c)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    100000 obs. of  7 variables:
##  $ State           : chr  &quot;Alabama&quot; &quot;Alabama&quot; &quot;Alabama&quot; &quot;Alabama&quot; ...
##  $ Intercept       : num  -0.1123 -0.181 0.0925 -0.308 -0.434 ...
##  $ family_size_z   : num  -0.0423 0.0359 0.1572 0.1319 0.1026 ...
##  $ Ifamily_size_zE2: num  -0.487 -0.45 -0.488 -0.377 -0.251 ...
##  $ b_0             : num  17051 16740 12164 18649 30718 ...
##  $ b_1             : num  21750 20761 23544 18250 12311 ...
##  $ b_2             : num  -2457 -2272 -2465 -1901 -1270 ...</code></pre>
<p>Now we’ll subset by <code>n_lines</code>, <code>expand()</code> by <code>FamilySize</code>, and use the model formula to compute the expected <code>MedianIncome</code> values.</p>
<div class="sourceCode" id="cb1264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1264-1" data-line-number="1"><span class="co"># how many posterior lines would you like?</span></a>
<a class="sourceLine" id="cb1264-2" data-line-number="2">n_lines &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb1264-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1264-4" data-line-number="4"><span class="kw">set.seed</span>(<span class="dv">17</span>)</a>
<a class="sourceLine" id="cb1264-5" data-line-number="5">c &lt;-</a>
<a class="sourceLine" id="cb1264-6" data-line-number="6"><span class="st">  </span>c <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1264-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1264-8" data-line-number="8"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> n_lines) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1264-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">draw =</span> <span class="dv">1</span><span class="op">:</span>n_lines) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1264-10" data-line-number="10"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(draw, State, b_<span class="dv">0</span>, b_<span class="dv">1</span>, b_<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1264-11" data-line-number="11">         <span class="dt">FamilySize =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> <span class="dv">9</span>, <span class="dt">length.out =</span> <span class="dv">50</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1264-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">MedianIncome =</span> b_<span class="dv">0</span> <span class="op">+</span><span class="st"> </span>b_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>FamilySize <span class="op">+</span><span class="st"> </span>b_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>FamilySize<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1264-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1264-14" data-line-number="14"><span class="kw">head</span>(c)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
## # Groups:   State [1]
##    draw State      b_0    b_1    b_2 FamilySize MedianIncome
##   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
## 1     1 Alabama 15959. 21584. -1941.       1          35602.
## 2     1 Alabama 15959. 21584. -1941.       1.16       38440.
## 3     1 Alabama 15959. 21584. -1941.       1.33       41175.
## 4     1 Alabama 15959. 21584. -1941.       1.49       43807.
## 5     1 Alabama 15959. 21584. -1941.       1.65       46335.
## 6     1 Alabama 15959. 21584. -1941.       1.82       48759.</code></pre>
<p>Finally, we’re ready for the <code>State</code>-specific miniatures in Figure 17.7.</p>
<div class="sourceCode" id="cb1266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1266-1" data-line-number="1">my_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1266-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(State <span class="op">&lt;=</span><span class="st"> &quot;Mississippi&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1266-3" data-line-number="3"><span class="st"> </span></a>
<a class="sourceLine" id="cb1266-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> FamilySize, <span class="dt">y =</span> MedianIncome)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1266-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> c,</a>
<a class="sourceLine" id="cb1266-6" data-line-number="6">            <span class="kw">aes</span>(<span class="dt">group =</span> draw),</a>
<a class="sourceLine" id="cb1266-7" data-line-number="7">            <span class="dt">size  =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">color =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1266-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> State)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1266-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> State)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1266-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1266-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1266-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>,</a>
<a class="sourceLine" id="cb1266-13" data-line-number="13">                  <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">150000</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1266-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Each State now has its own bundle of credible regression curves.&quot;</span>,</a>
<a class="sourceLine" id="cb1266-15" data-line-number="15">       <span class="dt">x =</span> <span class="st">&quot;Family size&quot;</span>,</a>
<a class="sourceLine" id="cb1266-16" data-line-number="16">       <span class="dt">y =</span> <span class="st">&quot;Median income&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1266-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1266-18" data-line-number="18"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>State)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-52-1.png" /><!-- --></p>
<p>Magic! As our model coefficients proliferate, the <code>fitted()</code> approach from above starts to look more and more appetizing. Check it out for yourself.</p>
<p>Although “almost all of the posterior distribution [was] below <span class="math inline">\(\nu = 4\)</span>” in the text (p. 500), the bulk of our <span class="math inline">\(\nu\)</span> distribution spanned across much larger values.</p>
<div class="sourceCode" id="cb1267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1267-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit5) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1267-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> nu)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1267-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>,</a>
<a class="sourceLine" id="cb1267-4" data-line-number="4">                 <span class="dt">size =</span> <span class="fl">.2</span>, <span class="dt">bins =</span> <span class="dv">40</span>, <span class="dt">boundary =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1267-5" data-line-number="5"><span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb1267-6" data-line-number="6">                      <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1267-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1267-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Our big &quot;</span>, nu)),</a>
<a class="sourceLine" id="cb1267-9" data-line-number="9">       <span class="dt">x     =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<p><img src="17_files/figure-gfm/unnamed-chunk-53-1.png" /><!-- --></p>
<p>I’m guessing the distinction in our <span class="math inline">\(\nu\)</span> distribution and that in the text is our use of the <code>se()</code> syntax in the <code>brm()</code> <code>formula</code>. If you have a better explanation, <a href="https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse/issues">share it</a>.</p>
</div>
<div id="further-extensions." class="section level3">
<h3><span class="header-section-number">17.4.2</span> Further extensions.</h3>
<p>Kruschke discussed the ease with which users of Bayesian software might specify nonlinear models. Check out Bürkner’s vignette, <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_nonlinear.html"><em>Estimating Non-Linear Models with brms</em></a> for more on the topic. Though I haven’t used it, I believe it is also possible to use the <span class="math inline">\(t\)</span> distribution to model group-level variation in <strong>brms</strong> (see <a href="https://github.com/paul-buerkner/brms/issues/231">this GitHub discussion</a> for details).</p>
</div>
</div>
<div id="procedure-and-perils-for-expanding-a-model" class="section level2">
<h2><span class="header-section-number">17.5</span> Procedure and perils for expanding a model</h2>
<p>Across several chapters, we’ve already dipped our toes into posterior predictive checks. For more on the PPC “double dipping” issue, check out Gelman’s <a href="http://andrewgelman.com/2014/08/11/discussion-sander-greenland-posterior-predictive-checks/"><em>Discussion with Sander Greenland on posterior predictive checks</em></a> or Simpson’s <a href="http://andrewgelman.com/2017/09/07/touch-want-feel-data/"><em>Touch me, I want to feel your data</em></a>, which is itself connected to Gabry and colleagues’ <a href="https://arxiv.org/abs/1709.01449"><em>Visualization in Bayesian workflow</em></a>.</p>
</div>
<div id="reference-14" class="section level2 unnumbered">
<h2>Reference</h2>
<p><a href="https://sites.google.com/site/doingbayesiandataanalysis/">Kruschke, J. K. (2015). <em>Doing Bayesian data analysis, Second Edition: A tutorial with R, JAGS, and Stan.</em> Burlington, MA: Academic Press/Elsevier.</a></p>
</div>
<div id="session-info-16" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb1268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1268-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.0 (2019-04-26)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] bayesplot_1.7.0 tidybayes_1.1.0 brms_2.10.3     Rcpp_1.0.2      forcats_0.4.0   stringr_1.4.0  
##  [7] dplyr_0.8.3     purrr_0.3.3     readr_1.3.1     tidyr_1.0.0     tibble_2.1.3    ggplot2_3.2.1  
## [13] tidyverse_1.2.1
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.4-1          ellipsis_0.3.0            ggridges_0.5.1           
##   [4] rsconnect_0.8.15          ggstance_0.3.2            markdown_1.1             
##   [7] base64enc_0.1-3           rstudioapi_0.10           rstan_2.19.2             
##  [10] svUnit_0.7-12             DT_0.9                    fansi_0.4.0              
##  [13] lubridate_1.7.4           xml2_1.2.0                bridgesampling_0.7-2     
##  [16] knitr_1.23                shinythemes_1.1.2         zeallot_0.1.0            
##  [19] jsonlite_1.6              broom_0.5.2               shiny_1.3.2              
##  [22] compiler_3.6.0            httr_1.4.0                backports_1.1.5          
##  [25] assertthat_0.2.1          Matrix_1.2-17             lazyeval_0.2.2           
##  [28] cli_1.1.0                 later_1.0.0               htmltools_0.4.0          
##  [31] prettyunits_1.0.2         tools_3.6.0               igraph_1.2.4.1           
##  [34] coda_0.19-3               gtable_0.3.0              glue_1.3.1.9000          
##  [37] reshape2_1.4.3            cellranger_1.1.0          vctrs_0.2.0              
##  [40] nlme_3.1-139              crosstalk_1.0.0           xfun_0.10                
##  [43] ps_1.3.0                  rvest_0.3.4               mime_0.7                 
##  [46] miniUI_0.1.1.1            lifecycle_0.1.0           gtools_3.8.1             
##  [49] MASS_7.3-51.4             zoo_1.8-6                 scales_1.0.0             
##  [52] colourpicker_1.0          hms_0.4.2                 promises_1.1.0           
##  [55] Brobdingnag_1.2-6         parallel_3.6.0            inline_0.3.15            
##  [58] shinystan_2.5.0           yaml_2.2.0                gridExtra_2.3            
##  [61] loo_2.1.0                 StanHeaders_2.19.0        stringi_1.4.3            
##  [64] dygraphs_1.1.1.6          pkgbuild_1.0.5            rlang_0.4.1              
##  [67] pkgconfig_2.0.3           matrixStats_0.55.0        HDInterval_0.2.0         
##  [70] evaluate_0.14             lattice_0.20-38           rstantools_2.0.0         
##  [73] htmlwidgets_1.5           labeling_0.3              tidyselect_0.2.5         
##  [76] processx_3.4.1            plyr_1.8.4                magrittr_1.5             
##  [79] R6_2.4.0                  generics_0.0.2            pillar_1.4.2             
##  [82] haven_2.1.0               withr_2.1.2               xts_0.11-2               
##  [85] abind_1.4-5               modelr_0.1.4              crayon_1.3.4             
##  [88] arrayhelpers_1.0-20160527 utf8_1.1.4                rmarkdown_1.13           
##  [91] grid_3.6.0                readxl_1.3.1              callr_3.3.2              
##  [94] threejs_0.3.1             digest_0.6.21             xtable_1.8-4             
##  [97] httpuv_1.5.2              stats4_3.6.0              munsell_0.5.0            
## [100] viridisLite_0.3.0         shinyjs_1.0</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="metric-predicted-variable-on-one-or-two-groups.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="metric-predicted-variable-with-multiple-metric-predictors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
